"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[17325],{17325(C,E,u){var y,p;y=[u(39259),u(29930),u(91749),u(49897),u(52473)],p=(function(A,x,w,m,g){const e={};let t,n;e.init=function(i){t||(e.tid=i,e.cid=ajaxify.data.cid,e.current=ajaxify.data.crossposts,a())};function a(){const i=(()=>{const o={icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"};if(ajaxify.data.cid>0)return ajaxify.data.crossposts.length?o:ajaxify.data.category;switch(ajaxify.data.crossposts.length){case 0:return;case 1:return ajaxify.data.crossposts[0].category;default:return o}})();app.parseAndTranslate("modals/crosspost-topic",{selectedCategory:i},function(o){t=o,$("body").append(t),t.find('[component="category-selector"]').addClass("dropup");const b=[...ajaxify.data.crossposts.map(j=>j.cid)];ajaxify.data.cid>0&&b.unshift(ajaxify.data.cid),A.init($('[component="category/dropdown"]'),{onHidden:l,hideAll:!0,hideUncategorized:!0,localOnly:!0,selectedCids:Array.from(new Set(b))}),t.find("#crosspost_thread_commit").on("click",h),t.find("#crosspost_topic_cancel").on("click",f)})}function l(i){n=i.selectedCids.filter(o=>utils.isNumber(o)&&o>0),i.changed&&t.find("#crosspost_thread_commit").prop("disabled",!1)}function h(){const i=t.find("#crosspost_thread_commit");if(!i.prop("disabled")){i.prop("disabled",!0);const o={tid:e.tid,cids:n};r(o)}}function r(i){w.fire("action:topic.crosspost",i);const o=i.cids.map(d=>parseInt(d,10));o.includes(e.cid)||o.unshift(e.cid);const v=[e.cid,...e.current.map(d=>parseInt(d.cid,10))],b=o.filter(d=>!v.includes(d)),j=v.filter(d=>!o.includes(d)),D=[...b.map(d=>m.post(`/topics/${i.tid}/crossposts`,{cid:d})),...j.map(d=>m.del(`/topics/${i.tid}/crossposts`,{cid:d}))];Promise.all(D).then(async()=>{const d=g.get("topic/stats");s("progress");const{crossposts:L}=await m.get(`/topics/${i.tid}/crossposts`);ajaxify.data.crossposts=L;const S=await app.parseAndTranslate("partials/topic/stats",ajaxify.data);d.html(S),s("success")}).catch(d=>{s("error"),x.error(d)})}const c=new Map(Object.entries({initial:["d-none"],progress:["fa-spinner","text-secondary","fa-spin"],error:["fa-times","text-error"],success:["fa-check","text-success"]}));function s(i){if(t){const o=document.getElementById("crosspost_topic_spinner"),v=[...c.get("initial"),...c.get("progress"),...c.get("error"),...c.get("success")];o.classList.remove(...v),o.classList.add(...c.get(i)),i!=="initial"&&setTimeout(()=>{s("initial")},2500)}}function f(){t&&(t.remove(),t=null)}return e}).apply(E,y),p!==void 0&&(C.exports=p)},39259(C,E,u){var y,p;y=[u(96349),u(49897),u(91749)],p=(function(A,x,w){const m={};m.init=function(e,t){if(!e||!e.length)return;t=t||{},t.states=t.states||["watching","tracking","notwatching","ignoring"],t.template=t.template||"partials/category/filter-dropdown-left",w.fire("action:category.filter.options",{el:e,options:t}),A.init(e,t);let n=[],a=[];Array.isArray(t.selectedCids)?n=t.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(n=ajaxify.data.selectedCids.map(String)),a=n.slice(),e.on("hidden.bs.dropdown",function(){let l=a.length!==n.length;if(a.forEach(function(h,r){h!==n[r]&&(l=!0)}),a=n.slice(),l&&(t.updateButton?t.updateButton({el:e,changed:l,selectedCids:n.slice()}):t.updateButton!==!1&&g(e,n)),t.onHidden){t.onHidden({changed:l,selectedCids:n.slice()});return}if(l){let h=window.location.pathname;const r=utils.params();n.length?r.cid=n:delete r.cid,delete r.page,Object.keys(r).length&&(h+="?"+$.param(r)),ajaxify.go(h)}}),e.on("click",'[component="category/list"] [data-cid]',function(l){const h=e.find('[component="category/list"]'),r=$(this),c=r.find("a").attr("href");if(c&&c!=="#"&&c.length){l.stopPropagation();return}const s=r.attr("data-cid"),f=r.find('[component="category/select/icon"]');return s!=="all"?(n.includes(s)?n.splice(n.indexOf(s),1):n.push(s),n.sort(function(i,o){return i-o}),f.toggleClass("invisible"),h.find('[data-cid="all"] i').toggleClass("invisible",!!n.length)):(e.find('[component="category/select/icon"]').addClass("invisible"),h.find('[data-cid="all"] i').removeClass("invisible"),n=[]),t.selectedCids=n,t.onSelect&&t.onSelect({cid:s,selectedCids:n.slice()}),!1})};function g(e,t){t.length>1?n({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):t.length===1?x.get(`/categories/${t[0]}`,{}).then(n):n();function n(a){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:a},function(l){e.find("button").replaceWith($("<div/>").html(l).find("button"))})}}return m}).apply(E,y),p!==void 0&&(C.exports=p)},96349(C,E,u){var y,p;y=[u(29930),u(89336),u(49897)],p=(function(A,x,w){const m={};return m.init=function(g,e){let t=e.defaultCategories||null;e=e||{},e.privilege=e.privilege||"topics:read",e.states=e.states||["watching","tracking","notwatching","ignoring"],e.cacheList=e.hasOwnProperty("cacheList")?e.cacheList:!0;let n=[];Array.isArray(e.localCategories)&&(n=e.localCategories.map(c=>({...c})),t&&(t=[...n,...t])),e.selectedCids=e.selectedCids||ajaxify.data.selectedCids||[];const a=g.find('[component="category-selector-search"]');if(!a.length)return;const l=a.parents('[component="category/dropdown"]').length>0||a.parents('[component="category-selector"]').length>0;g.on("show.bs.dropdown",function(){l&&a.removeClass("hidden");function c(){const s=a.find("input").val();s.length>1||!s&&!t?h(s,function(f){t=e.cacheList&&(t||f),r(f)}):!s&&t&&r(t)}a.on("click",function(s){s.preventDefault(),s.stopPropagation()}),a.find("input").val("").on("keyup",utils.debounce(c,300)),c()}),g.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||a.find("input").focus()}),g.on("hide.bs.dropdown",function(){l&&a.addClass("hidden"),a.off("click"),a.find("input").off("keyup")});function h(c,s){w.get("/search/categories",{search:c,query:utils.params(),parentCid:e.parentCid||0,selectedCids:e.selectedCids,privilege:e.privilege,states:e.states,showLinks:e.showLinks,localOnly:e.localOnly,hideUncategorized:e.hideUncategorized},function(f,{categories:i}){if(f)return A.error(f);s(n.concat(i))})}function r(c){const s=e.selectedCids.map(String);c.forEach(function(f){f.selected=s.includes(String(f.cid))}),app.parseAndTranslate(e.template,{categoryItems:c.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl,hideAll:e.hideAll},function(f){g.find('[component="category/list"]').html(f.find('[component="category/list"]').html()),g.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!c.length);const i=x.Dropdown.getInstance(g.find(".dropdown-toggle").get(0));i&&i.update()})}},m}).apply(E,y),p!==void 0&&(C.exports=p)}}]);
