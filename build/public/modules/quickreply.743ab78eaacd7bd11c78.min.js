"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,13417,18314,33085,34271,34405,49897,87212,99127],{34405(b,x,m){var D,y;D=[m(49897),m(29930),m(36e3),m(9787),m(35786)],y=(function(u,f,{Textcomplete:t},{TextareaEditor:i},{ContenteditableEditor:p}){const o={},l={delay:200,appendTo:null};o.init=s=>{const c={...l,...s},{input:a,onSelect:e}=c;app.loadJQueryUI(function(){a.autocomplete({...c,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(r,n){g(a,e,r,n)}})})},o.user=function(s,c,a){typeof c=="function"&&(a=c,c={}),c=c||{},o.init({input:s,onSelect:a,source:(e,r)=>{c.query=e.term,u.get("/api/users",c,function(n,v){if(n)return f.error(n);if(v&&v.users){const h=v.users.map(function(d){const E=$("<div></div>").html(d.username).text();return d&&{label:E,value:E,user:{uid:d.uid,name:d.username,slug:d.userslug,username:d.username,userslug:d.userslug,displayname:d.displayname,picture:d.picture,banned:d.banned,"icon:text":d["icon:text"],"icon:bgColor":d["icon:bgColor"]}}});r(h)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},o.group=function(s,c){o.init({input:s,onSelect:c,source:(a,e)=>{socket.emit("groups.search",{query:a.term},function(r,n){if(r)return f.error(r);if(n&&n.length){const v=n.map(function(h){return h&&{label:h.name,value:h.name,group:h}});e(v)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},o.tag=function(s,c){o.init({input:s,onSelect:c,delay:100,source:(a,e)=>{socket.emit("topics.autocompleteTags",{query:a.term,cid:ajaxify.data.cid||0},function(r,n){if(r)return f.error(r);n&&e(n),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function g(s,c,a,e){c=c||function(){};const r=jQuery.Event("keypress");r.which=13,r.keyCode=13,setTimeout(function(){s.trigger(r)},100),c(a,e)}return o.setup=function({element:s,strategies:c,options:a}){const e=s.get(0);if(e){var r;if(e.nodeName==="TEXTAREA"||e.nodeName==="INPUT"?r=new i(e):e.nodeName==="DIV"&&e.getAttribute("contenteditable")==="true"&&(r=new p(e)),!r)throw new Error("unknown target element type");e.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var n=new t(r,c,{dropdown:a});return n.on("rendered",function(){n.dropdown.items.length&&n.dropdown.items[0].activate()}),n}},o}).apply(x,D),y!==void 0&&(b.exports=y)},43103(b,x,m){var D,y;D=[m(29930)],y=(function(u){const f={};return f.init=function(t){const i=t.uploadFormEl;if(i.length&&(i.attr("action",config.relative_path+t.route),t.dragDropAreaEl&&f.handleDragDrop({container:t.dragDropAreaEl,callback:function(p){f.ajaxSubmit({uploadForm:i,upload:p,callback:t.callback})}}),t.pasteEl&&f.handlePaste({container:t.pasteEl,callback:function(p){f.ajaxSubmit({uploadForm:i,upload:p,callback:t.callback})}}),t.uploadBtnEl)){const p=i.find('input[name="files[]"]');t.uploadBtnEl.on("click",function(){return p.trigger("click"),!1}),p.on("change",function(o){const l=(o.target||{}).files||($(this).val()?[{name:$(this).val(),type:utils.fileMimeType($(this).val())}]:null);l&&f.ajaxSubmit({uploadForm:i,upload:{files:l,fileNames:Array.from(l).map(g=>g.name)},callback:t.callback})})}},f.handleDragDrop=function(t){let i=!1;const p=t.container,o=t.container.find(".imagedrop");p.on("dragenter",function(){i||(o.css("top","0px"),o.css("height",p.height()+"px"),o.css("line-height",p.height()+"px"),o.show(),o.on("dragleave",function(){o.hide(),o.off("dragleave")}))}),o.on("drop",function(s){s.preventDefault();const c=s.originalEvent.dataTransfer.files;if(c.length){let e;if(window.FormData){e=new FormData;for(var a=0;a<c.length;++a)e.append("files[]",c[a],c[a].name)}t.callback({files:c,formData:e})}return o.hide(),!1});function l(g){return g.preventDefault(),!1}$(document).off("dragstart").on("dragstart",function(){i=!0}).off("dragend").on("dragend, mouseup",function(){i=!1}),o.on("dragover",l),o.on("dragenter",l)},f.handlePaste=function(t){t.container.on("paste",function(p){const o=(p.clipboardData||p.originalEvent.clipboardData||{}).items,l=[],g=[];let s=null;window.FormData&&(s=new FormData),[].forEach.call(o,function(c){const a=c.getAsFile();if(a){const e=utils.generateUUID()+"-"+a.name;s&&s.append("files[]",a,e),l.push(a),g.push(e)}}),l.length&&t.callback({files:l,fileNames:g,formData:s})})},f.ajaxSubmit=function(t){const i=[...t.upload.files];for(let o=0;o<i.length;++o){const l=i[o].type.match(/image./);if(l&&!app.user.privileges["upload:post:image"]||!l&&!app.user.privileges["upload:post:file"])return u.error("[[error:no-privileges]]");if(!app.user.isAdmin&&i[o].size>parseInt(config.maximumFileSize,10)*1024)return t.uploadForm[0].reset(),u.error("[[error:file-too-big, "+config.maximumFileSize+"]]")}const p=Date.now();t.uploadForm.off("submit").on("submit",function(){return $(this).ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},resetForm:!0,clearForm:!0,formData:t.upload.formData,error:function(o){let l=o.responseJSON&&(o.responseJSON.error||o.responseJSON.status&&o.responseJSON.status.message)||"[[error:parse-error]]";o&&o.status===413&&(l=o.statusText||"Request Entity Too Large"),u.error(l),u.remove(p)},uploadProgress:function(o,l,g,s){u.alert({alert_id:p,message:"[[modules:composer.uploading, "+s+"%]]"})},success:function(o){const l=o.response.images;if(l&&l.length)for(var g=0;g<l.length;++g)l[g].filename=i[g].name,l[g].isImage=/image./.test(i[g].type);t.callback(l)},complete:function(){t.uploadForm[0].reset(),setTimeout(u.remove,100,p)}}),!1}),t.uploadForm.submit()},f}).apply(x,D),y!==void 0&&(b.exports=y)},49897(b,x,m){m.r(x),m.d(x,{del:()=>a,get:()=>o,head:()=>l,patch:()=>s,post:()=>g,put:()=>c});var D=m(91749),y=m.n(D),u=m(33530),f=m.n(u);const t=config.relative_path+"/api/v3";async function i(e,r){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:t+e.url,typeof r=="function"){p(e).then(n=>r(null,n),n=>r(n));return}try{return await p(e)}catch(n){if(n.message==="A valid login session was not found. Please log in and try again."){const{url:v}=await(0,D.fire)("filter:admin.reauth",{url:"login"});return(0,u.confirm)("[[error:api.reauth-required]]",h=>{h&&ajaxify.go(v)})}throw n}}async function p(e){const{url:r}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,D.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const n=await fetch(r,e),{headers:v}=n;if(v.get("x-redirect"))return p({url:v.get("x-redirect"),...e});const h=v.get("content-type"),d=h&&h.startsWith("application/json");let E;if(e.method!=="HEAD"&&(d?E=await n.json():E=await n.text()),!n.ok)throw E?new Error(d?E.status.message:E):new Error(n.statusText);return d&&E&&E.hasOwnProperty("status")&&E.hasOwnProperty("response")?E.response:E}function o(e,r,n){return i({url:e+(r&&Object.keys(r).length?"?"+$.param(r):"")},n)}function l(e,r,n){return i({url:e+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"HEAD"},n)}function g(e,r,n){return i({url:e,method:"POST",data:r,headers:{"x-csrf-token":config.csrf_token}},n)}function s(e,r,n){return i({url:e,method:"PATCH",data:r,headers:{"x-csrf-token":config.csrf_token}},n)}function c(e,r,n){return i({url:e,method:"PUT",data:r,headers:{"x-csrf-token":config.csrf_token}},n)}function a(e,r,n){return i({url:e,method:"DELETE",data:r,headers:{"x-csrf-token":config.csrf_token}},n)}},68636(b,x,m){var D;D=(function(){function y(){this._store={},this._keys=[]}y.prototype.isMock=!0,y.prototype.setItem=function(t,i){t=String(t),this._keys.indexOf(t)===-1&&this._keys.push(t),this._store[t]=i},y.prototype.getItem=function(t){return t=String(t),this._keys.indexOf(t)===-1?null:this._store[t]},y.prototype.removeItem=function(t){t=String(t),this._keys=this._keys.filter(function(i){return i!==t}),this._store[t]=null},y.prototype.clear=function(){this._keys=[],this._store={}},y.prototype.key=function(t){return t=parseInt(t,10)||0,this._keys[t]},Object.defineProperty&&Object.defineProperty(y.prototype,"length",{get:function(){return this._keys.length}});let u;const f=Date.now().toString();try{if(u=window.localStorage,u.setItem(f,f),u.getItem(f)!==f)throw Error("localStorage behaved unexpectedly");return u.removeItem(f),u}catch(t){console.warn(t),console.warn("localStorage failed, falling back on sessionStorage");try{if(u=window.sessionStorage,u.setItem(f,f),u.getItem(f)!==f)throw Error("sessionStorage behaved unexpectedly");return u.removeItem(f),u}catch(i){return console.warn(i),console.warn("sessionStorage failed, falling back on memory storage"),new y}}}).call(x,m,x,b),D!==void 0&&(b.exports=D)},95692(b,x,m){var D,y;D=[m(52473),m(34405),m(49897),m(29930),m(43103),m(6411),m(68636),m(91749)],y=(function(u,f,t,i,p,o,l,g){const s={_autocomplete:null};s.init=function(){const a=u.get("topic/quickreply/text"),e=`qr:draft:tid:${ajaxify.data.tid}`,r={element:a,strategies:[],options:{style:{"z-index":100}}};c(),$(window).one("action:ajaxify.start",()=>{c()}),$(window).trigger("composer:autocomplete:init",r),s._autocomplete=f.setup(r),o.bind("ctrl+return",h=>{h.target===a.get(0)&&u.get("topic/quickreply/button").get(0).click()}),p.init({uploadBtnEl:$('[component="topic/quickreply/upload/button"]'),dragDropAreaEl:$('[component="topic/quickreply/container"] .quickreply-message'),pasteEl:a,uploadFormEl:$('[component="topic/quickreply/upload"]'),inputEl:a,route:"/api/post/upload",callback:function(h){let d=a.val();h.forEach(E=>{d=d+(d?`
`:"")+(E.isImage?"!":"")+`[${E.filename}](${E.url})`}),a.val(d)}});let n=!0;u.get("topic/quickreply/button").on("click",function(h){if(h.preventDefault(),!n)return;const d=a.val(),E={tid:ajaxify.data.tid,handle:void 0,content:d},k=d.length;if(k<parseInt(config.minimumPostLength,10))return i.error("[[error:content-too-short, "+config.minimumPostLength+"]]");if(k>parseInt(config.maximumPostLength,10))return i.error("[[error:content-too-long, "+config.maximumPostLength+"]]");n=!1,a.val(""),t.post(`/topics/${ajaxify.data.tid}`,E,function(I,A){if(n=!0,I)return a.val(d),i.error(I);A&&A.queued&&i.alert({type:"success",title:"[[global:alert.success]]",message:A.message,timeout:1e4,clickfn:function(){ajaxify.go(`/post-queue/${A.id}`)}}),a.val(""),l.removeItem(e),s._autocomplete.hide(),g.fire("action:quickreply.success",{data:A})})});const v=l.getItem(e);v&&a.val(v),a.on("keyup",utils.debounce(function(){const h=a.val();h?l.setItem(e,h):l.removeItem(e)},1e3)),u.get("topic/quickreply/expand").on("click",h=>{h.preventDefault(),l.removeItem(e);const d=u.get("topic/quickreply/text");g.fire("action:composer.post.new",{tid:ajaxify.data.tid,title:ajaxify.data.titleRaw,body:d.val()}),d.val("")})};function c(){s._autocomplete&&(s._autocomplete.destroy(),s._autocomplete=null)}return s}).apply(x,D),y!==void 0&&(b.exports=y)}}]);
