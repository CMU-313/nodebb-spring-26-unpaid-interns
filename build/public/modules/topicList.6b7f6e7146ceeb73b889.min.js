"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8981,14526,42619,90954],{25955(F,B,l){var L,x;L=[l(91749),l(29930),l(89336)],x=(function(T,D,g){const E={};E.init=function(e,i){if(!e||!e.length)return;i=i||{},i.template="partials/tags/filter-dropdown-left",T.fire("action:tag.filter.options",{el:e,options:i});const o=e.find('[component="tag/filter/search"]');i.selectedTags=i.selectedTags||ajaxify.data.selectedTags||[];let d=null,n=[],r=[];Array.isArray(i.selectedTags)?n=i.selectedTags.map(String):Array.isArray(ajaxify.data.selectedTags)&&(n=ajaxify.data.selectedTags.map(String)),r=n.slice();const y=o.parents('[component="tag/filter"]').length&&app.user.privileges["search:tags"];e.on("show.bs.dropdown",function(){y&&o.removeClass("hidden");function p(){const h=o.find("input").val();h.length>1||!h&&!d?a(h,function(C){d=d||C,m(C)}):!h&&d&&m(d)}o.on("click",function(h){h.preventDefault(),h.stopPropagation()}),o.find("input").val("").on("keyup",utils.debounce(p,300)),p()}),e.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||o.find("input").focus()}),e.on("hidden.bs.dropdown",function(){y&&o.addClass("hidden"),o.off("click"),o.find("input").off("keyup");let p=r.length!==n.length;if(r.forEach(function(h,C){h!==n[C]&&(p=!0)}),r=n.slice(),p&&(i.updateButton?i.updateButton({el:e,changed:p,selectedTags:n.slice()}):i.updateButton!==!1&&w(e,n)),i.onHidden){i.onHidden({changed:p,selectedTags:n.slice()});return}if(p){let h=window.location.pathname;const C=utils.params();n.length?C.tag=n.length?n:void 0:delete C.tag,delete C.page,Object.keys(C).length&&(h+="?"+$.param(C)),ajaxify.go(h)}}),e.on("click",'[component="tag/filter/list"] [data-tag]',function(){const p=e.find('[component="tag/filter/list"]'),h=$(this),C=h.find("a").attr("href");if(C&&C!=="#"&&C.length)return;const P=h.attr("data-tag"),M=h.find('[component="tag/select/icon"]');return P!==""?(n.includes(P)?n.splice(n.indexOf(P),1):n.push(P),n.sort(function(R,b){return R-b}),M.toggleClass("invisible")):(e.find('[component="tag/select/icon"]').addClass("invisible"),n=[]),p.find('[data-tag=""] i').toggleClass("invisible",!!n.length),i.selectedTags=n,i.onSelect&&i.onSelect({tag:P,selectedTags:n.slice()}),!1});function a(p,h){let C=null;ajaxify.data.template.category||ajaxify.data.template.world?C=[ajaxify.data.cid]:Array.isArray(ajaxify.data.selectedCids)&&ajaxify.data.selectedCids.length&&(C=ajaxify.data.selectedCids),socket.emit("topics.tagFilterSearch",{query:p,cids:C},function(P,M){if(P)return D.error(P);h(M)})}function m(p){const h=i.selectedTags;p.forEach(function(C){C.selected=h.includes(C.value)}),app.parseAndTranslate(i.template,{tagItems:p.slice(0,200),selectedTag:ajaxify.data.selectedTag},function(C){e.find('[component="tag/filter/list"]').html(C.find('[component="tag/filter/list"]').html());const P=g.Dropdown.getInstance(e.find(".dropdown-toggle").get(0));P&&P.update()})}};function w(e,i){i.length>0?o({label:i.join(", ")}):o();function o(d){app.parseAndTranslate("partials/tags/filter-dropdown-content",{selectedTag:d},function(n){e.find("button").replaceWith($("<div/>").html(n).find("button"))})}}return E}).apply(B,L),x!==void 0&&(F.exports=x)},39259(F,B,l){var L,x;L=[l(96349),l(49897),l(91749)],x=(function(T,D,g){const E={};E.init=function(e,i){if(!e||!e.length)return;i=i||{},i.states=i.states||["watching","tracking","notwatching","ignoring"],i.template=i.template||"partials/category/filter-dropdown-left",g.fire("action:category.filter.options",{el:e,options:i}),T.init(e,i);let o=[],d=[];Array.isArray(i.selectedCids)?o=i.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(o=ajaxify.data.selectedCids.map(String)),d=o.slice(),e.on("hidden.bs.dropdown",function(){let n=d.length!==o.length;if(d.forEach(function(r,y){r!==o[y]&&(n=!0)}),d=o.slice(),n&&(i.updateButton?i.updateButton({el:e,changed:n,selectedCids:o.slice()}):i.updateButton!==!1&&w(e,o)),i.onHidden){i.onHidden({changed:n,selectedCids:o.slice()});return}if(n){let r=window.location.pathname;const y=utils.params();o.length?y.cid=o:delete y.cid,delete y.page,Object.keys(y).length&&(r+="?"+$.param(y)),ajaxify.go(r)}}),e.on("click",'[component="category/list"] [data-cid]',function(n){const r=e.find('[component="category/list"]'),y=$(this),a=y.find("a").attr("href");if(a&&a!=="#"&&a.length){n.stopPropagation();return}const m=y.attr("data-cid"),p=y.find('[component="category/select/icon"]');return m!=="all"?(o.includes(m)?o.splice(o.indexOf(m),1):o.push(m),o.sort(function(h,C){return h-C}),p.toggleClass("invisible"),r.find('[data-cid="all"] i').toggleClass("invisible",!!o.length)):(e.find('[component="category/select/icon"]').addClass("invisible"),r.find('[data-cid="all"] i').removeClass("invisible"),o=[]),i.selectedCids=o,i.onSelect&&i.onSelect({cid:m,selectedCids:o.slice()}),!1})};function w(e,i){i.length>1?o({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):i.length===1?D.get(`/categories/${i[0]}`,{}).then(o):o();function o(d){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:d},function(n){e.find("button").replaceWith($("<div/>").html(n).find("button"))})}}return E}).apply(B,L),x!==void 0&&(F.exports=x)},47682(F,B,l){var L,x;L=[l(22410),l(60644),l(70550),l(39259),l(25955),l(71131),l(91749)],x=(function(T,D,g,E,w,e,i){const o={};let d="",n=0,r=0,y,a;const m=[];$(window).on("action:ajaxify.start",function(){o.removeListeners(),e.removeListeners()}),o.init=function(u,f){a=p(),d=u,y=f||R,e.init(),o.watchForNewPosts();const A=["watching","tracking"];ajaxify.data.selectedFilter&&ajaxify.data.selectedFilter.filter==="watched"?A.push("notwatching","ignoring"):u!=="unread"&&A.push("notwatching"),E.init($('[component="category/dropdown"]'),{states:A}),w.init($('[component="tag/filter"]')),config.usePagination||T.init(o.loadMoreTopics),D.init(function(k,t){y(k,1,function(c,s){N(d,c,ajaxify.data.showSelect,1,function(){t(),s()})})}),$("body").height()<=$(window).height()&&a.children().length>=20&&$("#load-more-btn").show(),$("#load-more-btn").on("click",function(){o.loadMoreTopics(1)}),i.fire("action:topics.loaded",{topics:ajaxify.data.topics})};function p(){return $('[component="category"]').filter(function(u,f){return!$(f).parents("[widget-area],[data-widget-area]").length})}o.watchForNewPosts=function(){r=0,n=0,o.removeListeners(),socket.on("event:new_topic",h),socket.on("event:new_post",C)},o.removeListeners=function(){socket.removeListener("event:new_topic",h),socket.removeListener("event:new_post",C)};function h(u){const f=ajaxify.data,A=f.selectedCids&&f.selectedCids.length&&f.selectedCids.indexOf(parseInt(u.cid,10))===-1,k=f.selectedFilter&&f.selectedFilter.filter==="watched",t=f.template.category&&parseInt(f.cid,10)!==parseInt(u.cid,10),c=!!(A||k||t||m.includes(u.tid));i.fire("filter:topicList.onNewTopic",{topic:u,preventAlert:c}).then(s=>{s.preventAlert||(u.scheduled&&u.tid&&m.push(u.tid),n+=1,P())})}function C(u){const f=u.posts[0];if(!f||!f.topic||f.topic.isFollowing)return;const A=ajaxify.data,k=parseInt(f.topic.mainPid,10)===parseInt(f.pid,10),t=A.selectedCids&&A.selectedCids.length&&A.selectedCids.indexOf(parseInt(f.topic.cid,10))===-1,c=A.selectedFilter&&A.selectedFilter.filter==="new",s=A.selectedFilter&&A.selectedFilter.filter==="watched"&&!f.topic.isFollowing,v=A.template.category&&parseInt(A.cid,10)!==parseInt(f.topic.cid,10),j=!!(k||t||c||s||v);i.fire("filter:topicList.onNewPost",{post:f,preventAlert:j}).then(S=>{S.preventAlert||(r+=1,P())})}function P(){(n>0||r>0)&&($("#new-topics-alert").removeClass("hide").fadeIn("slow"),$("#category-no-topics").addClass("hide"))}o.loadMoreTopics=function(u){if(!a.length||!a.children().length)return;const f=a.find('[component="category/topic"]'),A=u>0?f.last():f.first(),k=(parseInt(A.attr("data-index"),10)||0)+(u>0?1:0);!utils.isNumber(k)||k===0&&a.find('[component="category/topic"][data-index="0"]').length||y(k,u,function(t,c){N(d,t,ajaxify.data.showSelect,u,c)})};function M(u,f){return Math.floor(u/config.topicsPerPage)+(f>0?1:0)}function R(u,f,A){A=A||function(){};const k=utils.params();k.page=M(u,f),T.loadMoreXhr(k,A)}function b(u){return u.filter(function(f){return!a.find('[component="category/topic"][data-tid="'+f.tid+'"]').length})}function N(u,f,A,k,t){let{topics:c}=f;if(!c||!c.length||(c=b(c),!c.length))return $("#load-more-btn").hide(),t();let s,v;const j=a.find('[component="category/topic"]');k>0&&c.length?s=j.last():k<0&&c.length&&(v=j.first());const S={topics:c,showSelect:A,"reputation:disabled":f["reputation:disabled"],template:{name:u,[u]:!0}};ajaxify.data.cid&&(S.cid=ajaxify.data.cid),i.fire("action:topics.loading",{topics:c,after:s,before:v}),app.parseAndTranslate(u,"topics",S,function(I){if(a.removeClass("hidden"),$("#category-no-topics").remove(),s&&s.length)I.insertAfter(s);else if(v&&v.length){const K=$(document).height(),W=$(window).scrollTop();I.insertBefore(v),$(window).scrollTop(W+($(document).height()-K))}else a.append(I);g.getSelectedTids().length||T.removeExtra(a.find('[component="category/topic"]'),k,Math.max(60,config.topicsPerPage*3)),I.find(".timeago").timeago(),i.fire("action:topics.loaded",{topics:c,template:u}),t()})}return o}).apply(B,L),x!==void 0&&(F.exports=x)},70550(F,B,l){var L,x;L=[l(52473)],x=(function(T){const D={};let g,E;D.init=function(n){E=$('[component="category"]'),E.on("selectstart",'[component="topic/select"]',function(r){r.preventDefault()}),E.on("click",'[component="topic/select"]',function(r){const a=$(this).parents('[component="category/topic"]');if(r.shiftKey)return i(a.attr("data-tid")),g=a,!1;const m=a.hasClass("selected");w(a,!m),g=a,typeof n=="function"&&n()})};function w(n,r){const y=n.find('[component="topic/select"]');y.toggleClass("fa-check-square-o",r),y.toggleClass("fa-square-o",!r),y.parents('[component="category/topic"]').toggleClass("selected",r),e()}function e(){const n=$('[component="topic/selected/badge"]');if(n.length){const r=E.find('[component="category/topic"].selected').length;n.text(r>0?r:"")}}D.getSelectedTids=function(){const n=[];return E&&E.find('[component="category/topic"].selected').each(function(){n.push($(this).attr("data-tid"))}),n},D.unselectAll=function(){E&&(E.find('[component="category/topic"].selected').removeClass("selected"),E.find('[component="topic/select"]').toggleClass("fa-check-square-o",!1).toggleClass("fa-square-o",!0),e())};function i(n){g||(g=$('[component="category/topic"]').first());const r=T.get("category/topic","tid",n).hasClass("selected"),y=d(n),a=d(g.attr("data-tid"));o(y,a,!r)}function o(n,r,y){if(n>r){const a=n;n=r,r=a}for(let a=n;a<=r;a+=1){const m=$('[component="category/topic"]').eq(a);w(m,y)}}function d(n){return T.get("category/topic","tid",n).index('[component="category/topic"]')}return D}).apply(B,L),x!==void 0&&(F.exports=x)},71131(F,B,l){var L,x;L=[l(70550),l(60984),l(52473),l(49897),l(33530),l(29930)],x=(function(T,D,g,E,w,e){const i={};i.init=function(){T.init(a),k(),$('[component="category/topic"]').each((t,c)=>{D.observeTopicLabels($(c).find('[component="topic/labels"]'))}),g.get("topic/delete").on("click",function(){return o("del","/state","delete",r),!1}),g.get("topic/restore").on("click",function(){return o("put","/state","restore",r),!1}),g.get("topic/purge").on("click",function(){return o("del","","purge",y),!1}),g.get("topic/lock").on("click",function(){return o("put","/lock","lock",n),!1}),g.get("topic/unlock").on("click",function(){return o("del","/lock","unlock",n),!1}),g.get("topic/pin").on("click",function(){return o("put","/pin","pin",n),!1}),g.get("topic/unpin").on("click",function(){return o("del","/pin","unpin",n),!1}),g.get("topic/mark-unread-for-all").on("click",function(){const t=T.getSelectedTids();return t.length?(socket.emit("topics.markAsUnreadForAll",t,function(c){if(c)return e.error(c);e.success("[[topic:markAsUnreadForAll.success]]"),t.forEach(function(s){$('[component="category/topic"][data-tid="'+s+'"]').addClass("unread")}),n()}),!1):e.error("[[error:no-topics-selected]]")}),g.get("topic/move").on("click",function(){return l.e(28310).then(function(){var t=[l(28310)];(function(c){const s=T.getSelectedTids();if(!s.length)return e.error("[[error:no-topics-selected]]");c.init(s,null,n)}).apply(null,t)}).catch(l.oe),!1}),g.get("topic/move-all").on("click",function(){const t=ajaxify.data.cid;if(!ajaxify.data.template.category)return e.error("[[error:invalid-data]]");l.e(28310).then(function(){var c=[l(28310)];(function(s){s.init(null,t,function(v){if(v)return e.error(v);ajaxify.refresh()})}).apply(null,c)}).catch(l.oe)}),g.get("topic/merge").on("click",function(){const t=T.getSelectedTids();l.e(2403).then(function(){var c=[l(2403)];(function(s){s.init(function(){t.length&&t.forEach(function(v){s.addTopic(v)})})}).apply(null,c)}).catch(l.oe)}),g.get("topic/tag").on("click",async function(){const t=T.getSelectedTids();if(!t.length)return e.error("[[error:no-topics-selected]]");const c=await Promise.all(t.map(s=>E.get(`/topics/${s}`)));Promise.all([l.e(20056),l.e(63)]).then(function(){var s=[l(63)];(function(v){v.init(c,ajaxify.data.tagWhitelist,n)}).apply(null,s)}).catch(l.oe)}),i.removeListeners(),socket.on("event:topic_deleted",b),socket.on("event:topic_restored",b),socket.on("event:topic_purged",A),socket.on("event:topic_locked",u),socket.on("event:topic_unlocked",u),socket.on("event:topic_pinned",N),socket.on("event:topic_unpinned",N),socket.on("event:topic_moved",f)};function o(t,c,s,v){v||(v=function(){});const j=T.getSelectedTids(),S={},I=function(K){K&&Promise.all(j.map(W=>E[t](`/topics/${W}${c}`,S))).then(v).catch(e.error)};if(!j.length)return e.error("[[error:no-topics-selected]]");switch(s){case"delete":case"restore":case"purge":w.confirm(`[[topic:thread-tools.${s}-confirm]]`,I);break;case"pin":D.requestPinExpiry(S,I.bind(null,!0));break;default:I(!0);break}}i.removeListeners=function(){socket.removeListener("event:topic_deleted",b),socket.removeListener("event:topic_restored",b),socket.removeListener("event:topic_purged",A),socket.removeListener("event:topic_locked",u),socket.removeListener("event:topic_unlocked",u),socket.removeListener("event:topic_pinned",N),socket.removeListener("event:topic_unpinned",N),socket.removeListener("event:topic_moved",f)};function d(){$(".thread-tools .show").removeClass("show")}function n(){d(),T.unselectAll()}function r(){d(),a()}function y(){d(),T.unselectAll(),a()}function a(){const t=T.getSelectedTids(),c=m(h,t),s=p(h,t),v=m(P,t),j=m(C,t),S=m(M,t),I=p(M,t);g.get("topic/delete").toggleClass("hidden",c),g.get("topic/restore").toggleClass("hidden",S||!c),g.get("topic/purge").toggleClass("hidden",!s||!t.length),g.get("topic/lock").toggleClass("hidden",j),g.get("topic/unlock").toggleClass("hidden",!j),g.get("topic/pin").toggleClass("hidden",I||v),g.get("topic/unpin").toggleClass("hidden",I||!v),g.get("topic/merge").toggleClass("hidden",S)}function m(t,c){for(let s=0;s<c.length;s+=1)if(t(c[s]))return!0;return!1}function p(t,c){for(let s=0;s<c.length;s+=1)if(!t(c[s]))return!1;return!0}function h(t){return R(t).hasClass("deleted")}function C(t){return R(t).hasClass("locked")}function P(t){return R(t).hasClass("pinned")}function M(t){return R(t).hasClass("scheduled")}function R(t){return g.get("category/topic","tid",t)}function b(t){const c=R(t.tid);c.toggleClass("deleted",t.isDeleted),c.find('[component="topic/locked"]').toggleClass("hidden",!t.isDeleted)}function N(t){const c=R(t.tid);c.toggleClass("pinned",t.isPinned),c.find('[component="topic/pinned"]').toggleClass("hidden",!t.isPinned),ajaxify.refresh()}function u(t){const c=R(t.tid);c.toggleClass("locked",t.isLocked),c.find('[component="topic/locked"]').toggleClass("hidden",!t.isLocked)}async function f(t){if(ajaxify.data.template.category||String(t.toCid)==="-1")R(t.tid).remove();else{const c=await E.get(`/categories/${t.toCid}`),s=await app.parseAndTranslate("partials/topics_list",{topics:[{...t,category:c}]}),v=`[component="category/topic"][data-tid="${t.tid}"] [component="topic/category"]`;$(v).replaceWith(s.find(v))}}function A(t){R(t.tid).remove()}function k(){if(!ajaxify.data.topics||!ajaxify.data.template.category)return;const t=ajaxify.data.topics.filter(c=>c.pinned).length;!app.user.isAdmin&&!app.user.isMod||t<2||app.loadJQueryUI(function(){const c=$('[component="category"]').filter(function(v,j){return!$(j).parents("[widget-area],[data-widget-area]").length});let s=0;c.sortable({axis:"y",handle:'[component="topic/pinned"]',items:'[component="category/topic"].pinned',start:function(){s=parseInt(c.find('[component="category/topic"].pinned').first().attr("data-index"),10)},update:function(v,j){const S=j.item.attr("data-tid"),I=c.find('[component="category/topic"].pinned');let K=0;I.each((W,U)=>{if($(U).attr("data-tid")===S)return K=W,!1}),socket.emit("topics.orderPinnedTopics",{tid:S,order:s+K},function(W){if(W)return e.error(W);I.each((U,O)=>{$(O).attr("data-index",s+U)})})}})})}return i}).apply(B,L),x!==void 0&&(F.exports=x)},96349(F,B,l){var L,x;L=[l(29930),l(89336),l(49897)],x=(function(T,D,g){const E={};return E.init=function(w,e){let i=e.defaultCategories||null;e=e||{},e.privilege=e.privilege||"topics:read",e.states=e.states||["watching","tracking","notwatching","ignoring"],e.cacheList=e.hasOwnProperty("cacheList")?e.cacheList:!0;let o=[];Array.isArray(e.localCategories)&&(o=e.localCategories.map(a=>({...a})),i&&(i=[...o,...i])),e.selectedCids=e.selectedCids||ajaxify.data.selectedCids||[];const d=w.find('[component="category-selector-search"]');if(!d.length)return;const n=d.parents('[component="category/dropdown"]').length>0||d.parents('[component="category-selector"]').length>0;w.on("show.bs.dropdown",function(){n&&d.removeClass("hidden");function a(){const m=d.find("input").val();m.length>1||!m&&!i?r(m,function(p){i=e.cacheList&&(i||p),y(p)}):!m&&i&&y(i)}d.on("click",function(m){m.preventDefault(),m.stopPropagation()}),d.find("input").val("").on("keyup",utils.debounce(a,300)),a()}),w.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||d.find("input").focus()}),w.on("hide.bs.dropdown",function(){n&&d.addClass("hidden"),d.off("click"),d.find("input").off("keyup")});function r(a,m){g.get("/search/categories",{search:a,query:utils.params(),parentCid:e.parentCid||0,selectedCids:e.selectedCids,privilege:e.privilege,states:e.states,showLinks:e.showLinks,localOnly:e.localOnly,hideUncategorized:e.hideUncategorized},function(p,{categories:h}){if(p)return T.error(p);m(o.concat(h))})}function y(a){const m=e.selectedCids.map(String);a.forEach(function(p){p.selected=m.includes(String(p.cid))}),app.parseAndTranslate(e.template,{categoryItems:a.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl,hideAll:e.hideAll},function(p){w.find('[component="category/list"]').html(p.find('[component="category/list"]').html()),w.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!a.length);const h=D.Dropdown.getInstance(w.find(".dropdown-toggle").get(0));h&&h.update()})}},E}).apply(B,L),x!==void 0&&(F.exports=x)}}]);
