"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[69749,87212,92717],{68636(w,b,p){var x;x=(function(){function h(){this._store={},this._keys=[]}h.prototype.isMock=!0,h.prototype.setItem=function(r,m){r=String(r),this._keys.indexOf(r)===-1&&this._keys.push(r),this._store[r]=m},h.prototype.getItem=function(r){return r=String(r),this._keys.indexOf(r)===-1?null:this._store[r]},h.prototype.removeItem=function(r){r=String(r),this._keys=this._keys.filter(function(m){return m!==r}),this._store[r]=null},h.prototype.clear=function(){this._keys=[],this._store={}},h.prototype.key=function(r){return r=parseInt(r,10)||0,this._keys[r]},Object.defineProperty&&Object.defineProperty(h.prototype,"length",{get:function(){return this._keys.length}});let u;const l=Date.now().toString();try{if(u=window.localStorage,u.setItem(l,l),u.getItem(l)!==l)throw Error("localStorage behaved unexpectedly");return u.removeItem(l),u}catch(r){console.warn(r),console.warn("localStorage failed, falling back on sessionStorage");try{if(u=window.sessionStorage,u.setItem(l,l),u.getItem(l)!==l)throw Error("sessionStorage behaved unexpectedly");return u.removeItem(l),u}catch(m){return console.warn(m),console.warn("sessionStorage failed, falling back on memory storage"),new h}}}).call(b,p,b,w),x!==void 0&&(w.exports=x)},69749(w,b,p){var x,h;x=[p(17459),p(68636),p(91749),p(29930),p(89336),p(77918)],h=(function(u,l,r,m,q){const c={current:{}};c.saveToHistory=function(e){if(!e||e.length<2)return;let i=JSON.parse(localStorage.getItem("searchHistory")||"[]");i=i.filter(n=>n!==e),i.unshift(e),i=i.slice(0,8),l.setItem("searchHistory",JSON.stringify(i))},c.getHistory=function(){try{return JSON.parse(localStorage.getItem("searchHistory")||"[]")}catch(e){return console.error("Error reading search history:",e),[]}},c.clearHistory=function(){localStorage.removeItem("searchHistory")},c.displayHistory=function(e,i){const n=c.getHistory();if(!n||n.length===0){e.addClass("hidden").empty();return}let t='<div class="search-history-container">';t+='<div class="search-history-items">',n.forEach(function(s){t+='<div class="search-history-item" data-term="'+utils.escapeHTML(s)+'">',t+='<svg class="search-history-icon" width ="16" height="16" viewBox="0 0 24 24" fill="none" stroke = "currentColor" stroke-width="2">',t+='<circle cx="12" cy="12" r="10"></circle>',t+='<polyline points="12 6 12 12 16 14"></polyline>',t+="</svg>",t+='<span class="search-history-text">'+utils.escapeHTML(s)+"</span>",t+="</div>"}),t+="</div>",t+='<div class="search-history-clear">',t+='<button class="clear-history-btn">Clear search history</button>',t+="</div>",t+="</div>",e.removeClass("hidden").html(t),e.find(".search-history-item").on("click",function(){const s=$(this).data("term");i.val(s),i.closest("form").trigger("submit")}),e.find(".clear-history-btn").on("click",function(s){s.preventDefault(),s.stopPropagation(),c.clearHistory(),e.addClass("hidden"),i.trigger("focus")})},c.init=function(e){if(!config.searchEnabled)return;e=e||{in:config.searchDefaultInQuick||"titles"},$('[component="search/form"]').each((n,t)=>{I($(t),e)}),$(document).on("focus",'[component="search/fields"] input[name="query"]',function(){var n=$(this),t=n.closest('[component="search/fields"]').find("#quick-search-container"),s=n.val();(!s||s.length===0)&&(c.displayHistory(t,n),t.css({display:"block",visibility:"visible"}))})},c.showHistoryDropdown=function(e,i,n){c.displayHistory(e,i)};function I(e,i){const n=e.find('[component="search/button"]'),t=e.find('[component="search/fields"]'),s=t.find('input[name="query"]'),g=t.find("#quick-search-container"),v=t.hasClass("hidden"),f=/^(@|acct:)?[\w-]+@.+$/;v&&t.off("focusout").on("focusout",function(){setTimeout(function(){t.find(":focus").length||(t.addClass("hidden"),n.removeClass("hidden"))},200)}),s.off("focus");const C={inputEl:s,resultEl:g};c.enableQuickSearch({searchOptions:i,searchElements:C}),n.off("click").on("click",function(y){return!config.loggedIn&&!app.user.privileges["search:content"]?(m.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(y.stopPropagation(),c.showAndFocusInput(e),!1)}),e.off("submit").on("submit",function(){const y=$(this).find('input[name="query"]'),d=c.getSearchPreferences();return d.term=y.val(),d.in=i.in,c.saveToHistory(d.term),f.test(d.term)&&(d.in="users"),r.fire("action:search.submit",{searchOptions:d,searchElements:C}),c.query(d,function(){y.val(""),s.trigger("blur")}),!1})}c.enableQuickSearch=function(e){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const i=Object.assign({in:config.searchDefaultInQuick||"titles"},e.searchOptions),n=e.searchElements.resultEl,t=e.searchElements.inputEl;let s=t.val();const g=n.find(".filter-category");function v(){ajaxify.data.template.category&&ajaxify.data.cid&&u.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(o){const a=$("<div></div>").html(o).text();g.find(".name").text(a)}),g.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function f(){e.searchOptions=Object.assign({},i),e.searchOptions.term=t.val(),v(),ajaxify.data.template.category&&ajaxify.data.cid&&g.find('input[type="checkbox"]').is(":checked")&&(e.searchOptions.categories=[ajaxify.data.cid],e.searchOptions.searchChildren=!0),e.hideDuringSearch||(n.removeClass("hidden").find(".quick-search-results-container").html(""),n.find(".loading-indicator").removeClass("hidden")),r.fire("action:search.quick.start",e),e.searchOptions.searchOnly=1,c.api(e.searchOptions,function(o){if(n.find(".loading-indicator").addClass("hidden"),e.searchOptions.in==="categories"){if(!o.categories||e.hideOnNoMatches&&!o.categories.length)return n.addClass("hidden").find(".quick-search-results-container").html("");o.dropdown={maxWidth:"400px",maxHeight:"500px",...e.dropdown},app.parseAndTranslate("partials/quick-category-search-results",o,a=>{a.length&&a.find(".timeago").timeago(),n.toggleClass("hidden",!a.length||!t.is(":focus")).find(".quick-search-results-container").html(a.length?a:""),r.fire("action:search.quick.complete",{data:o,options:e})})}else{if(!o.posts||e.hideOnNoMatches&&!o.posts.length)return n.addClass("hidden").find(".quick-search-results-container").html("");o.posts.forEach(function(a){const S=$("<div>"+a.content+"</div>").text(),H=t.val().toLowerCase().replace(/^in:topic-\d+/,""),k=Math.max(0,S.toLowerCase().indexOf(H)-40);a.snippet=utils.escapeHTML((k>0?"...":"")+S.slice(k,k+80)+(S.length-k>80?"...":""))}),o.dropdown={maxWidth:"400px",maxHeight:"500px",...e.dropdown},app.parseAndTranslate("partials/quick-search-results",o,function(a){a.length&&a.find(".timeago").timeago(),n.toggleClass("hidden",!a.length||!t.is(":focus")).find(".quick-search-results-container").html(a.length?a:"");const S=n.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");c.highlightMatches(e.searchOptions.term,S),r.fire("action:search.quick.complete",{data:o,options:e})})}})}n.find('.filter-category input[type="checkbox"]').on("change",function(){t.focus(),f()}),t.off("keyup").on("keyup",utils.debounce(function(){if(t.val().length<3){n.addClass("hidden"),s=t.val();return}if(t.val()!==s){if(s=t.val(),!t.is(":focus"))return n.addClass("hidden");f()}},500)),n.on("mousedown",".quick-search-results > *",function(){$(window).one("mouseup",function(){n.addClass("hidden")})});const C=t.parent(),y=n.parent();C.on("focusout",d),y.on("focusout",d);function d(){setTimeout(function(){!C.find(":focus").length&&!y.find(":focus").length&&!n.hasClass("hidden")&&n.addClass("hidden")},200)}let E=!1;r.on("action:ajaxify.end",function(){ajaxify.isCold()||(E=!0),n.addClass("hidden")}),t.on("focus",function(){console.log("focus on fired event");const o=t.val();if(s=o,!o||o.length===0){c.showHistoryDropdown(n,t,i);return}o&&n.find("#quick-search-results").children().length&&(v(),E?(f(),E=!1):n.removeClass("hidden"),t[0].setSelectionRange(o.startsWith("in:topic")?o.indexOf(" ")+1:0,o.length))}),t.off("refresh").on("refresh",function(){f()})},c.showAndFocusInput=function(e){const i=e.parents(".dropdown-menu");if(i.length){const n=i.siblings("[data-bs-toggle]"),t=q.Dropdown.getOrCreateInstance(n[0]);t&&t.show()}else e.find('[component="search/fields"]').removeClass("hidden"),e.find('[component="search/button"]').addClass("hidden"),e.find('[component="search/fields"] input[name="query"]').trigger("focus")},c.query=function(e,i){i=i||function(){},ajaxify.go("search?"+O(e),i)},c.api=function(e,i){const n=config.relative_path+"/api/search?"+O(e);e.hasOwnProperty("searchOnly")&&delete e.searchOnly;const t=config.relative_path+"/search?"+O(e);$.get(n,function(s){s.url=t,i(s)})};function O(e){const i=e.in||"titles",n=e.term.replace(/^[ ?#]*/,""),t={...e,term:n,in:i};return r.fire("action:search.createQueryString",{query:t,data:e}),$.param(t)}return c.getSearchPreferences=function(){try{return JSON.parse(l.getItem("search-preferences")||"{}")}catch(e){return console.error(e),{}}},c.highlightMatches=function(e,i){if(!e||!i.length)return;e=utils.escapeHTML(e.replace(/^"/,"").replace(/"$/,"").trim());const n=e.split(" ").filter(s=>s.length>1).map(function(s){return utils.escapeRegexChars(s)}).join("|"),t=new RegExp("("+n+")","gi");i.each(function(){const s=$(this),g=[];s.find("*").each(function(){$(this).after("<!-- "+g.length+" -->"),g.push($("<div></div>").append($(this)))}),s.html(s.html().replace(t,function(v,f){return'<strong class="search-match fw-bold text-decoration-underline">'+f+"</strong>"})),g.forEach(function(v,f){s.html(s.html().replace("<!-- "+f+" -->",function(){return v.html()}))})}),$(".search-results .content").find("img:not(.not-responsive)").addClass("img-fluid")},c}).apply(b,x),h!==void 0&&(w.exports=h)}}]);
