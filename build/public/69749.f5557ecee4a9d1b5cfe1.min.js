"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[69749],{69749(q,O,d){var b,v;b=[d(17459),d(68636),d(91749),d(29930),d(89336),d(77918)],v=(function(w,k,g,H,S){const r={current:{}};r.saveToHistory=function(e){if(!e||e.length<2)return;let i=JSON.parse(localStorage.getItem("searchHistory")||"[]");i=i.filter(n=>n!==e),i.unshift(e),i=i.slice(0,8),k.setItem("searchHistory",JSON.stringify(i))},r.getHistory=function(){try{return JSON.parse(localStorage.getItem("searchHistory")||"[]")}catch(e){return console.error("Error reading search history:",e),[]}},r.clearHistory=function(){localStorage.removeItem("searchHistory")},r.displayHistory=function(e,i){const n=r.getHistory();if(!n||n.length===0){e.addClass("hidden").empty();return}let t='<div class="search-history-container">';t+='<div class="search-history-items">',n.forEach(function(s){t+='<div class="search-history-item" data-term="'+utils.escapeHTML(s)+'">',t+='<svg class="search-history-icon" width ="16" height="16" viewBox="0 0 24 24" fill="none" stroke = "currentColor" stroke-width="2">',t+='<circle cx="12" cy="12" r="10"></circle>',t+='<polyline points="12 6 12 12 16 14"></polyline>',t+="</svg>",t+='<span class="search-history-text">'+utils.escapeHTML(s)+"</span>",t+="</div>"}),t+="</div>",t+='<div class="search-history-clear">',t+='<button class="clear-history-btn">Clear search history</button>',t+="</div>",t+="</div>",e.removeClass("hidden").html(t),e.find(".search-history-item").on("click",function(){const s=$(this).data("term");i.val(s),i.closest("form").trigger("submit")}),e.find(".clear-history-btn").on("click",function(s){s.preventDefault(),s.stopPropagation(),r.clearHistory(),e.addClass("hidden"),i.trigger("focus")})},r.init=function(e){if(!config.searchEnabled)return;e=e||{in:config.searchDefaultInQuick||"titles"},$('[component="search/form"]').each((n,t)=>{E($(t),e)}),$(document).on("focus",'[component="search/fields"] input[name="query"]',function(){var n=$(this),t=n.closest('[component="search/fields"]').find("#quick-search-container"),s=n.val();(!s||s.length===0)&&(r.displayHistory(t,n),t.css({display:"block",visibility:"visible"}))})},r.showHistoryDropdown=function(e,i,n){r.displayHistory(e,i)};function E(e,i){const n=e.find('[component="search/button"]'),t=e.find('[component="search/fields"]'),s=t.find('input[name="query"]'),h=t.find("#quick-search-container"),f=t.hasClass("hidden"),o=/^(@|acct:)?[\w-]+@.+$/;f&&t.off("focusout").on("focusout",function(){setTimeout(function(){t.find(":focus").length||(t.addClass("hidden"),n.removeClass("hidden"))},200)}),s.off("focus");const p={inputEl:s,resultEl:h};r.enableQuickSearch({searchOptions:i,searchElements:p}),n.off("click").on("click",function(u){return!config.loggedIn&&!app.user.privileges["search:content"]?(H.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(u.stopPropagation(),r.showAndFocusInput(e),!1)}),e.off("submit").on("submit",function(){const u=$(this).find('input[name="query"]'),l=r.getSearchPreferences();return l.term=u.val(),l.in=i.in,r.saveToHistory(l.term),o.test(l.term)&&(l.in="users"),g.fire("action:search.submit",{searchOptions:l,searchElements:p}),r.query(l,function(){u.val(""),s.trigger("blur")}),!1})}r.enableQuickSearch=function(e){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const i=Object.assign({in:config.searchDefaultInQuick||"titles"},e.searchOptions),n=e.searchElements.resultEl,t=e.searchElements.inputEl;let s=t.val();const h=n.find(".filter-category");function f(){ajaxify.data.template.category&&ajaxify.data.cid&&w.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(c){const a=$("<div></div>").html(c).text();h.find(".name").text(a)}),h.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function o(){e.searchOptions=Object.assign({},i),e.searchOptions.term=t.val(),f(),ajaxify.data.template.category&&ajaxify.data.cid&&h.find('input[type="checkbox"]').is(":checked")&&(e.searchOptions.categories=[ajaxify.data.cid],e.searchOptions.searchChildren=!0),e.hideDuringSearch||(n.removeClass("hidden").find(".quick-search-results-container").html(""),n.find(".loading-indicator").removeClass("hidden")),g.fire("action:search.quick.start",e),e.searchOptions.searchOnly=1,r.api(e.searchOptions,function(c){if(n.find(".loading-indicator").addClass("hidden"),e.searchOptions.in==="categories"){if(!c.categories||e.hideOnNoMatches&&!c.categories.length)return n.addClass("hidden").find(".quick-search-results-container").html("");c.dropdown={maxWidth:"400px",maxHeight:"500px",...e.dropdown},app.parseAndTranslate("partials/quick-category-search-results",c,a=>{a.length&&a.find(".timeago").timeago(),n.toggleClass("hidden",!a.length||!t.is(":focus")).find(".quick-search-results-container").html(a.length?a:""),g.fire("action:search.quick.complete",{data:c,options:e})})}else{if(!c.posts||e.hideOnNoMatches&&!c.posts.length)return n.addClass("hidden").find(".quick-search-results-container").html("");c.posts.forEach(function(a){const y=$("<div>"+a.content+"</div>").text(),j=t.val().toLowerCase().replace(/^in:topic-\d+/,""),m=Math.max(0,y.toLowerCase().indexOf(j)-40);a.snippet=utils.escapeHTML((m>0?"...":"")+y.slice(m,m+80)+(y.length-m>80?"...":""))}),c.dropdown={maxWidth:"400px",maxHeight:"500px",...e.dropdown},app.parseAndTranslate("partials/quick-search-results",c,function(a){a.length&&a.find(".timeago").timeago(),n.toggleClass("hidden",!a.length||!t.is(":focus")).find(".quick-search-results-container").html(a.length?a:"");const y=n.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");r.highlightMatches(e.searchOptions.term,y),g.fire("action:search.quick.complete",{data:c,options:e})})}})}n.find('.filter-category input[type="checkbox"]').on("change",function(){t.focus(),o()}),t.off("keyup").on("keyup",utils.debounce(function(){if(t.val().length<3){n.addClass("hidden"),s=t.val();return}if(t.val()!==s){if(s=t.val(),!t.is(":focus"))return n.addClass("hidden");o()}},500)),n.on("mousedown",".quick-search-results > *",function(){$(window).one("mouseup",function(){n.addClass("hidden")})});const p=t.parent(),u=n.parent();p.on("focusout",l),u.on("focusout",l);function l(){setTimeout(function(){!p.find(":focus").length&&!u.find(":focus").length&&!n.hasClass("hidden")&&n.addClass("hidden")},200)}let C=!1;g.on("action:ajaxify.end",function(){ajaxify.isCold()||(C=!0),n.addClass("hidden")}),t.on("focus",function(){console.log("focus on fired event");const c=t.val();if(s=c,!c||c.length===0){r.showHistoryDropdown(n,t,i);return}c&&n.find("#quick-search-results").children().length&&(f(),C?(o(),C=!1):n.removeClass("hidden"),t[0].setSelectionRange(c.startsWith("in:topic")?c.indexOf(" ")+1:0,c.length))}),t.off("refresh").on("refresh",function(){o()})},r.showAndFocusInput=function(e){const i=e.parents(".dropdown-menu");if(i.length){const n=i.siblings("[data-bs-toggle]"),t=S.Dropdown.getOrCreateInstance(n[0]);t&&t.show()}else e.find('[component="search/fields"]').removeClass("hidden"),e.find('[component="search/button"]').addClass("hidden"),e.find('[component="search/fields"] input[name="query"]').trigger("focus")},r.query=function(e,i){i=i||function(){},ajaxify.go("search?"+x(e),i)},r.api=function(e,i){const n=config.relative_path+"/api/search?"+x(e);e.hasOwnProperty("searchOnly")&&delete e.searchOnly;const t=config.relative_path+"/search?"+x(e);$.get(n,function(s){s.url=t,i(s)})};function x(e){const i=e.in||"titles",n=e.term.replace(/^[ ?#]*/,""),t={...e,term:n,in:i};return g.fire("action:search.createQueryString",{query:t,data:e}),$.param(t)}return r.getSearchPreferences=function(){try{return JSON.parse(k.getItem("search-preferences")||"{}")}catch(e){return console.error(e),{}}},r.highlightMatches=function(e,i){if(!e||!i.length)return;e=utils.escapeHTML(e.replace(/^"/,"").replace(/"$/,"").trim());const n=e.split(" ").filter(s=>s.length>1).map(function(s){return utils.escapeRegexChars(s)}).join("|"),t=new RegExp("("+n+")","gi");i.each(function(){const s=$(this),h=[];s.find("*").each(function(){$(this).after("<!-- "+h.length+" -->"),h.push($("<div></div>").append($(this)))}),s.html(s.html().replace(t,function(f,o){return'<strong class="search-match fw-bold text-decoration-underline">'+o+"</strong>"})),h.forEach(function(f,o){s.html(s.html().replace("<!-- "+o+" -->",function(){return f.html()}))})}),$(".search-results .content").find("img:not(.not-responsive)").addClass("img-fluid")},r}).apply(O,b),v!==void 0&&(q.exports=v)}}]);
