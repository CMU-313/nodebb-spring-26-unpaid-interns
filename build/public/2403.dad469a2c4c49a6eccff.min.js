"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[2403,69749],{2403(O,S,u){var k,v;k=[u(69749),u(29930),u(49897)],v=(function(q,E,m){const h={};let o,c,p={};h.init=function(n){n=n||function(){},!o&&app.parseAndTranslate("modals/merge-topic",{},function(a){o=a,$("body").append(o),c=o.find("#merge_topics_confirm"),o.find("#merge_topics_cancel").on("click",t),$("#content").on("click",'[component="topic/select"]',C),s(),c.on("click",function(){e(c)}),q.enableQuickSearch({searchElements:{inputEl:o.find(".topic-search-input"),resultEl:o.find(".quick-search-container")},searchOptions:{in:"titles"},dropdown:{maxWidth:"400px",maxHeight:"350px"}}),o.on("click","[data-tid]",function(){const r=$(this).attr("data-tid");return r&&h.addTopic(r),!1}),o.on("click","[data-remove-tid]",function(){const r=$(this).attr("data-remove-tid");return r&&h.removeTopic(r),!1}),n()})},h.addTopic=function(n,a){a=a||function(){},m.get(`/topics/${n}`,{}).then(function(r){const d=r?r.title:"No title";p[n]=d,i(),s(),a()}).catch(E.error)},h.removeTopic=function(n){p[n]&&delete p[n],i(),s()};function C(n){if(!o)return;const a=$(this).parents('[component="category/topic"]'),r=a.hasClass("selected"),d=a.attr("data-tid");return r?h.addTopic(d):h.removeTopic(d),n.preventDefault(),n.stopPropagation(),!1}function e(n){n.attr("disabled",!0);const a=Object.keys(p),r={};o.find(".merge-main-topic-radio").is(":checked")?r.mainTid=o.find(".merge-main-topic-select").val():o.find(".merge-new-title-radio").is(":checked")&&(r.newTopicTitle=o.find(".merge-new-title-input").val()),socket.emit("topics.merge",{tids:a,options:r},function(d,x){if(n.removeAttr("disabled"),d)return E.error(d);ajaxify.go("/topic/"+x),t()})}function s(){if(!o)return;const n=Object.keys(p);n.sort(function(r,d){return r-d});const a=n.map(function(r){return{tid:r,title:p[r]}});n.length?app.parseAndTranslate("modals/merge-topic",{config,topics:a},function(r){o.find(".topics-section").html(r.find(".topics-section").html()),o.find(".merge-main-topic-select").html(r.find(".merge-main-topic-select").html())}):(o.find(".topics-section").translateHtml("[[error:no-topics-selected]]"),o.find(".merge-main-topic-select").html(""))}function i(){Object.keys(p).length?c.removeAttr("disabled"):c.attr("disabled",!0)}function t(){o&&(o.remove(),o=null),p={},$("#content").off("click",'[component="topic/select"]',C)}return h}).apply(S,k),v!==void 0&&(O.exports=v)},69749(O,S,u){var k,v;k=[u(17459),u(68636),u(91749),u(29930),u(89336),u(77918)],v=(function(q,E,m,h,o){const c={current:{}};c.saveToHistory=function(e){if(!e||e.length<2)return;let s=JSON.parse(localStorage.getItem("searchHistory")||"[]");s=s.filter(i=>i!==e),s.unshift(e),s=s.slice(0,8),E.setItem("searchHistory",JSON.stringify(s))},c.getHistory=function(){try{return JSON.parse(localStorage.getItem("searchHistory")||"[]")}catch(e){return console.error("Error reading search history:",e),[]}},c.clearHistory=function(){localStorage.removeItem("searchHistory")},c.displayHistory=function(e,s){const i=c.getHistory();if(!i||i.length===0){e.addClass("hidden").empty();return}let t='<div class="search-history-container">';t+='<div class="search-history-items">',i.forEach(function(n){t+='<div class="search-history-item" data-term="'+utils.escapeHTML(n)+'">',t+='<svg class="search-history-icon" width ="16" height="16" viewBox="0 0 24 24" fill="none" stroke = "currentColor" stroke-width="2">',t+='<circle cx="12" cy="12" r="10"></circle>',t+='<polyline points="12 6 12 12 16 14"></polyline>',t+="</svg>",t+='<span class="search-history-text">'+utils.escapeHTML(n)+"</span>",t+="</div>"}),t+="</div>",t+='<div class="search-history-clear">',t+='<button class="clear-history-btn">Clear search history</button>',t+="</div>",t+="</div>",e.removeClass("hidden").html(t),e.find(".search-history-item").on("click",function(){const n=$(this).data("term");s.val(n),s.closest("form").trigger("submit")}),e.find(".clear-history-btn").on("click",function(n){n.preventDefault(),n.stopPropagation(),c.clearHistory(),e.addClass("hidden"),s.trigger("focus")})},c.init=function(e){if(!config.searchEnabled)return;e=e||{in:config.searchDefaultInQuick||"titles"},$('[component="search/form"]').each((i,t)=>{p($(t),e)}),$(document).on("focus",'[component="search/fields"] input[name="query"]',function(){var i=$(this),t=i.closest('[component="search/fields"]').find("#quick-search-container"),n=i.val();(!n||n.length===0)&&(c.displayHistory(t,i),t.css({display:"block",visibility:"visible"}))})},c.showHistoryDropdown=function(e,s,i){c.displayHistory(e,s)};function p(e,s){const i=e.find('[component="search/button"]'),t=e.find('[component="search/fields"]'),n=t.find('input[name="query"]'),a=t.find("#quick-search-container"),r=t.hasClass("hidden"),d=/^(@|acct:)?[\w-]+@.+$/;r&&t.off("focusout").on("focusout",function(){setTimeout(function(){t.find(":focus").length||(t.addClass("hidden"),i.removeClass("hidden"))},200)}),n.off("focus");const x={inputEl:n,resultEl:a};c.enableQuickSearch({searchOptions:s,searchElements:x}),i.off("click").on("click",function(y){return!config.loggedIn&&!app.user.privileges["search:content"]?(h.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(y.stopPropagation(),c.showAndFocusInput(e),!1)}),e.off("submit").on("submit",function(){const y=$(this).find('input[name="query"]'),g=c.getSearchPreferences();return g.term=y.val(),g.in=s.in,c.saveToHistory(g.term),d.test(g.term)&&(g.in="users"),m.fire("action:search.submit",{searchOptions:g,searchElements:x}),c.query(g,function(){y.val(""),n.trigger("blur")}),!1})}c.enableQuickSearch=function(e){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const s=Object.assign({in:config.searchDefaultInQuick||"titles"},e.searchOptions),i=e.searchElements.resultEl,t=e.searchElements.inputEl;let n=t.val();const a=i.find(".filter-category");function r(){ajaxify.data.template.category&&ajaxify.data.cid&&q.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(l){const f=$("<div></div>").html(l).text();a.find(".name").text(f)}),a.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function d(){e.searchOptions=Object.assign({},s),e.searchOptions.term=t.val(),r(),ajaxify.data.template.category&&ajaxify.data.cid&&a.find('input[type="checkbox"]').is(":checked")&&(e.searchOptions.categories=[ajaxify.data.cid],e.searchOptions.searchChildren=!0),e.hideDuringSearch||(i.removeClass("hidden").find(".quick-search-results-container").html(""),i.find(".loading-indicator").removeClass("hidden")),m.fire("action:search.quick.start",e),e.searchOptions.searchOnly=1,c.api(e.searchOptions,function(l){if(i.find(".loading-indicator").addClass("hidden"),e.searchOptions.in==="categories"){if(!l.categories||e.hideOnNoMatches&&!l.categories.length)return i.addClass("hidden").find(".quick-search-results-container").html("");l.dropdown={maxWidth:"400px",maxHeight:"500px",...e.dropdown},app.parseAndTranslate("partials/quick-category-search-results",l,f=>{f.length&&f.find(".timeago").timeago(),i.toggleClass("hidden",!f.length||!t.is(":focus")).find(".quick-search-results-container").html(f.length?f:""),m.fire("action:search.quick.complete",{data:l,options:e})})}else{if(!l.posts||e.hideOnNoMatches&&!l.posts.length)return i.addClass("hidden").find(".quick-search-results-container").html("");l.posts.forEach(function(f){const b=$("<div>"+f.content+"</div>").text(),H=t.val().toLowerCase().replace(/^in:topic-\d+/,""),T=Math.max(0,b.toLowerCase().indexOf(H)-40);f.snippet=utils.escapeHTML((T>0?"...":"")+b.slice(T,T+80)+(b.length-T>80?"...":""))}),l.dropdown={maxWidth:"400px",maxHeight:"500px",...e.dropdown},app.parseAndTranslate("partials/quick-search-results",l,function(f){f.length&&f.find(".timeago").timeago(),i.toggleClass("hidden",!f.length||!t.is(":focus")).find(".quick-search-results-container").html(f.length?f:"");const b=i.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");c.highlightMatches(e.searchOptions.term,b),m.fire("action:search.quick.complete",{data:l,options:e})})}})}i.find('.filter-category input[type="checkbox"]').on("change",function(){t.focus(),d()}),t.off("keyup").on("keyup",utils.debounce(function(){if(t.val().length<3){i.addClass("hidden"),n=t.val();return}if(t.val()!==n){if(n=t.val(),!t.is(":focus"))return i.addClass("hidden");d()}},500)),i.on("mousedown",".quick-search-results > *",function(){$(window).one("mouseup",function(){i.addClass("hidden")})});const x=t.parent(),y=i.parent();x.on("focusout",g),y.on("focusout",g);function g(){setTimeout(function(){!x.find(":focus").length&&!y.find(":focus").length&&!i.hasClass("hidden")&&i.addClass("hidden")},200)}let w=!1;m.on("action:ajaxify.end",function(){ajaxify.isCold()||(w=!0),i.addClass("hidden")}),t.on("focus",function(){console.log("focus on fired event");const l=t.val();if(n=l,!l||l.length===0){c.showHistoryDropdown(i,t,s);return}l&&i.find("#quick-search-results").children().length&&(r(),w?(d(),w=!1):i.removeClass("hidden"),t[0].setSelectionRange(l.startsWith("in:topic")?l.indexOf(" ")+1:0,l.length))}),t.off("refresh").on("refresh",function(){d()})},c.showAndFocusInput=function(e){const s=e.parents(".dropdown-menu");if(s.length){const i=s.siblings("[data-bs-toggle]"),t=o.Dropdown.getOrCreateInstance(i[0]);t&&t.show()}else e.find('[component="search/fields"]').removeClass("hidden"),e.find('[component="search/button"]').addClass("hidden"),e.find('[component="search/fields"] input[name="query"]').trigger("focus")},c.query=function(e,s){s=s||function(){},ajaxify.go("search?"+C(e),s)},c.api=function(e,s){const i=config.relative_path+"/api/search?"+C(e);e.hasOwnProperty("searchOnly")&&delete e.searchOnly;const t=config.relative_path+"/search?"+C(e);$.get(i,function(n){n.url=t,s(n)})};function C(e){const s=e.in||"titles",i=e.term.replace(/^[ ?#]*/,""),t={...e,term:i,in:s};return m.fire("action:search.createQueryString",{query:t,data:e}),$.param(t)}return c.getSearchPreferences=function(){try{return JSON.parse(E.getItem("search-preferences")||"{}")}catch(e){return console.error(e),{}}},c.highlightMatches=function(e,s){if(!e||!s.length)return;e=utils.escapeHTML(e.replace(/^"/,"").replace(/"$/,"").trim());const i=e.split(" ").filter(n=>n.length>1).map(function(n){return utils.escapeRegexChars(n)}).join("|"),t=new RegExp("("+i+")","gi");s.each(function(){const n=$(this),a=[];n.find("*").each(function(){$(this).after("<!-- "+a.length+" -->"),a.push($("<div></div>").append($(this)))}),n.html(n.html().replace(t,function(r,d){return'<strong class="search-match fw-bold text-decoration-underline">'+d+"</strong>"})),a.forEach(function(r,d){n.html(n.html().replace("<!-- "+d+" -->",function(){return r.html()}))})}),$(".search-results .content").find("img:not(.not-responsive)").addClass("img-fluid")},c}).apply(S,k),v!==void 0&&(O.exports=v)}}]);
