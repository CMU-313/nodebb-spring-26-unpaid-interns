"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,10411,17325,34271,49897,51831,69185,99127],{17325(w,E,d){var y,C;y=[d(39259),d(29930),d(91749),d(49897),d(52473)],C=(function(A,v,x,f,h){const t={};let s,i;t.init=function(r){s||(t.tid=r,t.cid=ajaxify.data.cid,t.current=ajaxify.data.crossposts,o())};function o(){const r=(()=>{const c={icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"};if(ajaxify.data.cid>0)return ajaxify.data.crossposts.length?c:ajaxify.data.category;switch(ajaxify.data.crossposts.length){case 0:return;case 1:return ajaxify.data.crossposts[0].category;default:return c}})();app.parseAndTranslate("modals/crosspost-topic",{selectedCategory:r},function(c){s=c,$("body").append(s),s.find('[component="category-selector"]').addClass("dropup");const D=[...ajaxify.data.crossposts.map(j=>j.cid)];ajaxify.data.cid>0&&D.unshift(ajaxify.data.cid),A.init($('[component="category/dropdown"]'),{onHidden:u,hideAll:!0,hideUncategorized:!0,localOnly:!0,selectedCids:Array.from(new Set(D))}),s.find("#crosspost_thread_commit").on("click",m),s.find("#crosspost_topic_cancel").on("click",l)})}function u(r){i=r.selectedCids.filter(c=>utils.isNumber(c)&&c>0),r.changed&&s.find("#crosspost_thread_commit").prop("disabled",!1)}function m(){const r=s.find("#crosspost_thread_commit");if(!r.prop("disabled")){r.prop("disabled",!0);const c={tid:t.tid,cids:i};e(c)}}function e(r){x.fire("action:topic.crosspost",r);const c=r.cids.map(p=>parseInt(p,10));c.includes(t.cid)||c.unshift(t.cid);const g=[t.cid,...t.current.map(p=>parseInt(p.cid,10))],D=c.filter(p=>!g.includes(p)),j=g.filter(p=>!c.includes(p)),P=[...D.map(p=>f.post(`/topics/${r.tid}/crossposts`,{cid:p})),...j.map(p=>f.del(`/topics/${r.tid}/crossposts`,{cid:p}))];Promise.all(P).then(async()=>{const p=h.get("topic/stats");n("progress");const{crossposts:O}=await f.get(`/topics/${r.tid}/crossposts`);ajaxify.data.crossposts=O;const _=await app.parseAndTranslate("partials/topic/stats",ajaxify.data);p.html(_),n("success")}).catch(p=>{n("error"),v.error(p)})}const a=new Map(Object.entries({initial:["d-none"],progress:["fa-spinner","text-secondary","fa-spin"],error:["fa-times","text-error"],success:["fa-check","text-success"]}));function n(r){if(s){const c=document.getElementById("crosspost_topic_spinner"),g=[...a.get("initial"),...a.get("progress"),...a.get("error"),...a.get("success")];c.classList.remove(...g),c.classList.add(...a.get(r)),r!=="initial"&&setTimeout(()=>{n("initial")},2500)}}function l(){s&&(s.remove(),s=null)}return t}).apply(E,y),C!==void 0&&(w.exports=C)},39259(w,E,d){var y,C;y=[d(96349),d(49897),d(91749)],C=(function(A,v,x){const f={};f.init=function(t,s){if(!t||!t.length)return;s=s||{},s.states=s.states||["watching","tracking","notwatching","ignoring"],s.template=s.template||"partials/category/filter-dropdown-left",x.fire("action:category.filter.options",{el:t,options:s}),A.init(t,s);let i=[],o=[];Array.isArray(s.selectedCids)?i=s.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(i=ajaxify.data.selectedCids.map(String)),o=i.slice(),t.on("hidden.bs.dropdown",function(){let u=o.length!==i.length;if(o.forEach(function(m,e){m!==i[e]&&(u=!0)}),o=i.slice(),u&&(s.updateButton?s.updateButton({el:t,changed:u,selectedCids:i.slice()}):s.updateButton!==!1&&h(t,i)),s.onHidden){s.onHidden({changed:u,selectedCids:i.slice()});return}if(u){let m=window.location.pathname;const e=utils.params();i.length?e.cid=i:delete e.cid,delete e.page,Object.keys(e).length&&(m+="?"+$.param(e)),ajaxify.go(m)}}),t.on("click",'[component="category/list"] [data-cid]',function(u){const m=t.find('[component="category/list"]'),e=$(this),a=e.find("a").attr("href");if(a&&a!=="#"&&a.length){u.stopPropagation();return}const n=e.attr("data-cid"),l=e.find('[component="category/select/icon"]');return n!=="all"?(i.includes(n)?i.splice(i.indexOf(n),1):i.push(n),i.sort(function(r,c){return r-c}),l.toggleClass("invisible"),m.find('[data-cid="all"] i').toggleClass("invisible",!!i.length)):(t.find('[component="category/select/icon"]').addClass("invisible"),m.find('[data-cid="all"] i').removeClass("invisible"),i=[]),s.selectedCids=i,s.onSelect&&s.onSelect({cid:n,selectedCids:i.slice()}),!1})};function h(t,s){s.length>1?i({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):s.length===1?v.get(`/categories/${s[0]}`,{}).then(i):i();function i(o){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:o},function(u){t.find("button").replaceWith($("<div/>").html(u).find("button"))})}}return f}).apply(E,y),C!==void 0&&(w.exports=C)},49897(w,E,d){d.r(E),d.d(E,{del:()=>m,get:()=>t,head:()=>s,patch:()=>o,post:()=>i,put:()=>u});var y=d(91749),C=d.n(y),A=d(33530),v=d.n(A);const x=config.relative_path+"/api/v3";async function f(e,a){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:x+e.url,typeof a=="function"){h(e).then(n=>a(null,n),n=>a(n));return}try{return await h(e)}catch(n){if(n.message==="A valid login session was not found. Please log in and try again."){const{url:l}=await(0,y.fire)("filter:admin.reauth",{url:"login"});return(0,A.confirm)("[[error:api.reauth-required]]",r=>{r&&ajaxify.go(l)})}throw n}}async function h(e){const{url:a}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,y.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const n=await fetch(a,e),{headers:l}=n;if(l.get("x-redirect"))return h({url:l.get("x-redirect"),...e});const r=l.get("content-type"),c=r&&r.startsWith("application/json");let g;if(e.method!=="HEAD"&&(c?g=await n.json():g=await n.text()),!n.ok)throw g?new Error(c?g.status.message:g):new Error(n.statusText);return c&&g&&g.hasOwnProperty("status")&&g.hasOwnProperty("response")?g.response:g}function t(e,a,n){return f({url:e+(a&&Object.keys(a).length?"?"+$.param(a):"")},n)}function s(e,a,n){return f({url:e+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"HEAD"},n)}function i(e,a,n){return f({url:e,method:"POST",data:a,headers:{"x-csrf-token":config.csrf_token}},n)}function o(e,a,n){return f({url:e,method:"PATCH",data:a,headers:{"x-csrf-token":config.csrf_token}},n)}function u(e,a,n){return f({url:e,method:"PUT",data:a,headers:{"x-csrf-token":config.csrf_token}},n)}function m(e,a,n){return f({url:e,method:"DELETE",data:a,headers:{"x-csrf-token":config.csrf_token}},n)}},96349(w,E,d){var y,C;y=[d(29930),d(89336),d(49897)],C=(function(A,v,x){const f={};return f.init=function(h,t){let s=t.defaultCategories||null;t=t||{},t.privilege=t.privilege||"topics:read",t.states=t.states||["watching","tracking","notwatching","ignoring"],t.cacheList=t.hasOwnProperty("cacheList")?t.cacheList:!0;let i=[];Array.isArray(t.localCategories)&&(i=t.localCategories.map(a=>({...a})),s&&(s=[...i,...s])),t.selectedCids=t.selectedCids||ajaxify.data.selectedCids||[];const o=h.find('[component="category-selector-search"]');if(!o.length)return;const u=o.parents('[component="category/dropdown"]').length>0||o.parents('[component="category-selector"]').length>0;h.on("show.bs.dropdown",function(){u&&o.removeClass("hidden");function a(){const n=o.find("input").val();n.length>1||!n&&!s?m(n,function(l){s=t.cacheList&&(s||l),e(l)}):!n&&s&&e(s)}o.on("click",function(n){n.preventDefault(),n.stopPropagation()}),o.find("input").val("").on("keyup",utils.debounce(a,300)),a()}),h.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||o.find("input").focus()}),h.on("hide.bs.dropdown",function(){u&&o.addClass("hidden"),o.off("click"),o.find("input").off("keyup")});function m(a,n){x.get("/search/categories",{search:a,query:utils.params(),parentCid:t.parentCid||0,selectedCids:t.selectedCids,privilege:t.privilege,states:t.states,showLinks:t.showLinks,localOnly:t.localOnly,hideUncategorized:t.hideUncategorized},function(l,{categories:r}){if(l)return A.error(l);n(i.concat(r))})}function e(a){const n=t.selectedCids.map(String);a.forEach(function(l){l.selected=n.includes(String(l.cid))}),app.parseAndTranslate(t.template,{categoryItems:a.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl,hideAll:t.hideAll},function(l){h.find('[component="category/list"]').html(l.find('[component="category/list"]').html()),h.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!a.length);const r=v.Dropdown.getInstance(h.find(".dropdown-toggle").get(0));r&&r.update()})}},f}).apply(E,y),C!==void 0&&(w.exports=C)}}]);
