"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[18631,22765,75264,76177],{2269(_,b){var r,S;r=[],S=(function(){const h={},j=/-resized(\.[\w]+)?$/;return h.wrapImagesInLinks=function(A){A.find('[component="post/content"] img:not(.emoji)').each(function(){h.wrapImageInLink($(this))})},h.wrapImageInLink=function(A){let E=A.attr("src")||"";if(E!=="about:blank"&&!A.parent().is("a")){utils.isRelativeUrl(E)&&j.test(E)&&(E=E.replace(j,"$1"));const D=A.attr("alt")||"",y=E.split(".").slice(1).pop(),p=D.split("/").pop(),i=p.split(".").slice(1).pop();A.wrap('<a href="'+E+'" '+(!y&&i?' download="'+utils.escapeHTML(p)+'" ':"")+' target="_blank" rel="noopener">')}},h}).apply(b,r),S!==void 0&&(_.exports=S)},18631(_,b,r){var S,h;S=[r(47536),r(91749),r(29930),r(49897)],h=(function(j,A,E,D){const y={};y.init=function(i){const u=i.closest("[data-pid]"),w=u.data("pid"),n=i.find('[component="post/replies/open"]');n.attr("loading")!=="1"&&n.attr("loaded")!=="1"?(n.attr("loading","1").removeClass("fa-chevron-down").addClass("fa-spin fa-spinner"),D.get(`/posts/${encodeURIComponent(w)}/replies`,{},function(T,{replies:R}){const P=R;if(n.removeAttr("loading").attr("loaded","1").removeClass("fa-spin fa-spinner").addClass("fa-chevron-up"),T)return E.error(T);P.forEach((M,e)=>{M&&(M.index=e)}),j.modifyPostsByPrivileges(P);const O={posts:P,privileges:ajaxify.data.privileges,"downvote:disabled":ajaxify.data["downvote:disabled"],"reputation:disabled":ajaxify.data["reputation:disabled"],loggedIn:!!app.user.uid,hideParent:!0,hideReplies:config.hasOwnProperty("showNestedReplies")?!config.showNestedReplies:!0};app.parseAndTranslate("topic","posts",O,async function(M){const e=$("<ul>",{component:"post/replies",class:"list-unstyled"}).html(M).hide();i.attr("data-target-component")?u.find('[component="'+i.attr("data-target-component")+'"]').html(e):e.insertAfter(i),e.slideDown("fast"),await j.onNewPostsAddedToDom(M),A.fire("action:posts.loaded",{posts:P})})})):n.attr("loaded")==="1"&&(n.removeAttr("loaded").removeAttr("loading").removeClass("fa-spin fa-spinner fa-chevron-up").addClass("fa-chevron-down"),u.find('[component="post/replies"]').slideUp("fast",function(){$(this).remove()}))},y.onNewPost=function(i){const u=i.posts[0];u&&(p(u,1),i.hideReplies=config.hasOwnProperty("showNestedReplies")?!config.showNestedReplies:!0,app.parseAndTranslate("topic","posts",i,async function(w){const n=$('[component="post"][data-pid="'+u.toPid+'"] [component="post/replies"]').first();n.length&&(config.topicPostSort==="newest_to_oldest"?n.prepend(w):n.append(w),await j.onNewPostsAddedToDom(w))}))},y.onPostPurged=function(i){p(i,-1)};function p(i,u){const w=document.querySelector(`[component="post"][data-pid="${i.toPid}"]`);if(!w)return;const n=$('[component="post"][data-pid="'+i.toPid+'"]').find('[component="post/reply-count"]').first(),T=n.find('[component="post/reply-count/text"]'),R=n.find('[component="post/reply-count/avatars"]'),P=Math.max(0,(parseInt(T.attr("data-replies"),10)||0)+u),O=n.find(".timeago").attr("title",i.timestampISO),M=w.getAttribute("data-index"),e=P===1&&Math.abs(i.index-M)===1;T.attr("data-replies",P),n.toggleClass("hidden",P<=0||e),P>1?T.translateText("[[topic:replies-to-this-post, "+P+"]]"):T.translateText("[[topic:one-reply-to-this-post]]"),!R.find('[data-uid="'+i.uid+'"]').length&&P<7&&app.parseAndTranslate("topic","posts",{posts:[{replies:{count:P,hasMore:!1,users:[i.user]}}]},function(l){R.prepend(l.find('[component="post/reply-count/avatars"]').html())}),R.addClass("hasMore"),O.data("timeago",null).timeago()}return y}).apply(b,S),h!==void 0&&(_.exports=h)},22410(_,b,r){var S,h;S=[r(91749),r(29930),r(49897)],h=(function(j,A,E){const D={};let y,p=0,i=!1,u,w=0;D.init=function(e,l){const f=$("body");typeof e=="function"?(y=e,u=f):(y=l,u=e||f),p=$(window).scrollTop(),$(window).off("scroll",n).on("scroll",n),f.height()<=$(window).height()&&(!ajaxify.data.hasOwnProperty("pageCount")||ajaxify.data.pageCount>1)&&y(1)};function n(){w&&clearTimeout(w),w=setTimeout(function(){w=0,T()},60)}function T(){if(R())return;const e=P(),l=O(e.currentScrollTop);M(e)&&y(l),p=e.currentScrollTop}function R(){const e=utils.findBootstrapEnvironment(),l=(e==="xs"||e==="sm")&&$("html").hasClass("composing");return i||l||app.flags._glance}function P(){const e=$(window).scrollTop(),l=$(window).height(),f=u.offset(),d=f?f.top:0,x=u.height()-l,B=x<=0?l:x,W=100*(e-d)/B;return{currentScrollTop:e,viewportHeight:x,scrollPercent:W}}function O(e){return e>p?1:-1}function M(e){const d=e.currentScrollTop<p,x=e.currentScrollTop>p;return!!(e.scrollPercent<15&&d||e.scrollPercent>85&&x||e.scrollPercent<0&&x&&e.viewportHeight<0)}return D.loadMore=function(e,l,f){if(i)return;i=!0;const d={method:e,data:l};j.fire("action:infinitescroll.loadmore",d),(d.method.startsWith("/")?E.get:socket.emit)(d.method,d.data,function(B,W){if(B)return i=!1,A.error(B);f(W,function(){i=!1})})},D.loadMoreXhr=function(e,l){if(i)return;i=!0;const f=config.relative_path+"/api"+location.pathname.replace(new RegExp("^"+config.relative_path),""),d={url:f,data:e};j.fire("action:infinitescroll.loadmore.xhr",d),$.get(f,e,function(x){l(x,function(){i=!1})}).fail(function(x){i=!1,A.error(String(x.responseJSON||"[[error:no-connection]]"))})},D.removeExtra=function(e,l,f){let d=$();if(e.length<=f)return d;const x=e.length-f;if(l>0){const B=$(document).height(),W=$(window).scrollTop();d=e.slice(0,x).remove(),$(window).scrollTop(W+($(document).height()-B))}else d=e.slice(e.length-x).remove();return d},D}).apply(b,S),h!==void 0&&(_.exports=h)},47536(_,b,r){var S,h;S=[r(25967),r(22410),r(8454),r(2269),r(96352),r(52473),r(17459),r(91749),r(30076)],h=(function(j,A,E,D,y,p,i,u,w){const n={};n.signaturesShown={};const T=$(window);n.onNewPost=function(t){!t||!t.posts||!t.posts.length||String(t.posts[0].tid)!==String(ajaxify.data.tid)||(t.loggedIn=!!app.user.uid,t.privileges=ajaxify.data.privileges,t.posts[0].timestamp=t.posts[0].topic.scheduled?t.posts[0].timestamp:Date.now()-1e3,t.posts[0].timestampISO=utils.toISOString(t.posts[0].timestamp),n.modifyPostsByPrivileges(t.posts),P(t.posts),R(t.posts[0]),O(t.posts),ajaxify.data.postcount+=1,E.updatePostCount(ajaxify.data.postcount),config.usePagination?M(t):l(t),r.e(18631).then(function(){var o=[r(18631)];(function(s){s.onNewPost(t)}).apply(null,o)}).catch(r.oe))};function R(t){$(".pagination-block .pagebottom .timeago").timeago("update",t.timestampISO)}n.modifyPostsByPrivileges=function(t){t.forEach(function(o){o.selfPost=!!app.user.uid&&parseInt(o.uid,10)===parseInt(app.user.uid,10),o.topicOwnerPost=parseInt(o.uid,10)===parseInt(ajaxify.data.uid,10),o.display_edit_tools=ajaxify.data.privileges["posts:edit"]&&o.selfPost||ajaxify.data.privileges.isAdminOrMod,o.display_delete_tools=ajaxify.data.privileges["posts:delete"]&&o.selfPost||ajaxify.data.privileges.isAdminOrMod,o.display_moderator_tools=o.display_edit_tools||o.display_delete_tools,o.display_move_tools=ajaxify.data.privileges.isAdminOrMod,o.display_post_menu=ajaxify.data.privileges.isAdminOrMod||o.selfPost&&!ajaxify.data.locked&&!o.deleted||o.selfPost&&o.deleted&&parseInt(o.deleterUid,10)===parseInt(app.user.uid,10)||(app.user.uid||ajaxify.data.postSharing.length)&&!o.deleted})};function P(t){for(let o=0;o<t.length;o+=1){const s=p.get("user/postcount",t[o].uid);s.html(w.formattedNumber(parseInt(s.attr("data-postcount"),10)+1))}}function O(t){config.topicPostSort==="newest_to_oldest"&&(t[0].index=1,p.get("post").not("[data-index=0]").each(function(){const o=parseInt($(this).attr("data-index"),10)+1;$(this).attr("data-index",o)}))}function M(t){function o(){f(t.posts[0])}const s=t.posts;ajaxify.data.pagination.pageCount=Math.max(1,Math.ceil(s[0].topic.postcount/config.postsPerPage));const a=config.topicPostSort==="oldest_to_newest"||config.topicPostSort==="most_votes"?1:-1;if(ajaxify.data.pagination.currentPage===ajaxify.data.pagination.pageCount&&a===1||ajaxify.data.pagination.currentPage===1&&a===-1){const I=$('[component="post"]:not([data-index=0]), [component="topic/event"]');d(t,I,a,!1,o)}else ajaxify.data.scrollToMyPost&&parseInt(s[0].uid,10)===parseInt(app.user.uid,10)?setTimeout(function(){j.loadPage(ajaxify.data.pagination.pageCount,o)},250):e()}function e(){$.get(config.relative_path+"/api/topic/pagination/"+ajaxify.data.tid,{page:ajaxify.data.pagination.currentPage},function(t){app.parseAndTranslate("partials/paginator",t,function(o){$('[component="pagination"]').after(o).remove()})})}function l(t){const o=config.topicPostSort==="oldest_to_newest"||config.topicPostSort==="most_votes"?1:-1,s=$('[component="post"][data-index="'+(t.posts[0].index-1)+'"]').length;if(!s&&(!t.posts[0].selfPost||!ajaxify.data.scrollToMyPost))return;if(!s&&t.posts[0].selfPost)return ajaxify.go("post/"+t.posts[0].pid);const a=$('[component="topic"]>[component="post"]:not([data-index=0]), [component="topic"]>[component="topic/event"]');d(t,a,o,!1,function(c){c&&c.addClass("new"),f(t.posts[0])})}function f(t){t.selfPost&&ajaxify.data.scrollToMyPost&&y.scrollBottom(t.index)}function d(t,o,s,a,c){if(c=c||function(){},!t||t.posts&&!t.posts.length)return c();function I(){const v=$('[component="post"].new');if(v.length===t.posts.length){let C=!0;if(v.each(function(m,F){parseInt($(F).attr("data-pid"),10)!==parseInt(t.posts[m].pid,10)&&(C=!1)}),C){v.each(function(){$(this).removeClass("new")}),t.posts.length=0;return}}v.length&&t.posts.length>1&&t.posts.forEach(function(C){const m=p.get("post","pid",C.pid);m.hasClass("new")&&m.remove()}),t.posts=t.posts.filter(function(C){return C.allowDupe||$('[component="post"][data-pid="'+C.pid+'"]').length===0})}if(I(),!t.posts.length)return c();let g,N;s>0&&o.length?g=o.last():s<0&&o.length&&(N=o.first()),u.fire("action:posts.loading",{posts:t.posts,after:g,before:N}),app.parseAndTranslate("topic","posts",Object.assign({},ajaxify.data,t),async function(v){v=v.filter(function(){const m=$(this),F=m.attr("data-pid"),K=m.attr("data-allow-dupe");return!m.is('[component="post"]')||K||F&&$('[component="post"][data-pid="'+F+'"]').length===0});const C=A.removeExtra($('[component="post"]'),s,Math.max(20,config.postsPerPage*2));if(g)v.insertAfter(g);else if(N){const m=$(document).height(),F=T.scrollTop();v.insertBefore(N),(a||F>0)&&T.scrollTop(F+($(document).height()-m))}else p.get("topic").append(v);await n.onNewPostsAddedToDom(v),W(C),u.fire("action:posts.loaded",{posts:t.posts}),c(v)})}n.loadMorePosts=function(t){if(!p.get("topic").length||y.scrollActive)return;const o=p.get("topic").find(p.get("post").not("[data-index=0]").not(".new")),s=t>0?o.last():o.first(),a=parseInt(s.attr("data-index"),10)||0,c=ajaxify.data.tid;if(!utils.isNumber(a)||t<0&&p.get("post","index",0).length)return;const I=$(".loading-indicator");I.is(":animated")||I.fadeIn(),A.loadMore("topics.loadMore",{tid:c,after:a+(t>0?1:0),count:config.postsPerPage,direction:t,topicPostSort:utils.params().sort||config.topicPostSort},function(g,N){if(I.fadeOut(),g&&g.posts&&g.posts.length){const v=$('[component="post"]:not([data-index=0]):not(.new), [component="topic/event"]');d(g,v,t,!0,N)}else y.update(),N()})},n.onTopicPageLoad=async function(t){L(t),D.wrapImagesInLinks(t),B(t),n.showBottomPostBar(),t.find('[component="post/content"] img:not(.not-responsive)').addClass("img-fluid"),n.addBlockquoteEllipses(t),U(t),await x()},n.addTopicEvents=async function(t){if(config.topicPostSort==="most_votes")return;const o=await Promise.all(t.map(s=>app.parseAndTranslate("partials/topic/event",{...s,privileges:ajaxify.data.privileges})));if(config.topicPostSort==="oldest_to_newest")$('[component="topic"]').append(o);else if(config.topicPostSort==="newest_to_oldest"){const s=$('[component="topic"] [component="post"][data-index="0"]');s.length?s.after(o.reverse()):$('[component="topic"]').prepend(o.reverse())}$('[component="topic/event"] .timeago').timeago()};async function x(){const t=ajaxify.data.necroThreshold*24*60*60*1e3;if(!t||config.topicPostSort!=="newest_to_oldest"&&config.topicPostSort!=="oldest_to_newest")return;const o=T.scrollTop(),s=$('[component="post"]').toArray();await Promise.all(s.map(async function(a){a=$(a);const c=a.prev('[component="post"]');if(a.is(":has(.necro-post)")||!c.length||config.topicPostSort==="newest_to_oldest"&&parseInt(c.attr("data-index"),10)===0)return;const I=a.attr("data-timestamp")-c.attr("data-timestamp");if(Math.abs(I)>=t){const g=["suffixAgo","prefixAgo","suffixFromNow","prefixFromNow"],N={};g.forEach(m=>{N[m]=$.timeago.settings.strings[m],$.timeago.settings.strings[m]=""});const v=(I>0?"[[topic:timeago-later,":"[[topic:timeago-earlier,")+$.timeago.inWords(I)+"]]";g.forEach(m=>{$.timeago.settings.strings[m]=N[m]});const C=await app.parseAndTranslate("partials/topic/necro-post",{text:v});C.attr("data-necro-post-index",c.attr("data-index")),C.insertBefore(a)}})),o>0&&T.scrollTop()<o&&T.scrollTop(o)}function B(t){ajaxify.data["signatures:hideDuplicates"]&&t.each((o,s)=>{const a=$(s).find('[component="post/signature"]'),c=a.attr("data-uid");n.signaturesShown[c]?a.addClass("hidden"):n.signaturesShown[c]=!0})}function W(t){t.each((o,s)=>{$(`[data-necro-post-index="${$(s).attr("data-index")}"]`).remove()})}function L(t){if(app.user.uid||!ajaxify.data.privateUploads)return;const o=document.createElement("a");o.className="login-required",o.href=config.relative_path+"/login",i.translate("[[topic:login-to-view]]",function(s){o.appendChild(document.createTextNode(s)),t.each(function(a,c){$(c).find('[component="post/content"] img').each(function(I,g){g=$(g),g.attr("src").startsWith(config.relative_path+config.upload_url)&&g.replaceWith(o.cloneNode(!0))})})})}n.onNewPostsAddedToDom=async function(t){await n.onTopicPageLoad(t),t.find(".timeago").timeago()},n.showBottomPostBar=function(){const t=p.get("post","index",0),o=$(".post-bar-placeholder"),s=$('[component="post"]');t.length&&s.length>1&&$(".post-bar").length<2&&o.length?($(".post-bar").clone().insertAfter(o),o.remove()):t.length&&s.length<2&&t.find(".post-bar").remove()};function U(t){t.each(function(){$(this).hasClass("deleted")&&E.toggle($(this).attr("data-pid"),!0)})}return n.addBlockquoteEllipses=function(t){t.find('[component="post/content"] blockquote').filter((a,c)=>!$(c).parent().is("blockquote")).find(">blockquote").each(function(){const a=$(this);a.find(":hidden:not(br)").length&&!a.find(".toggle").length&&a.append('<i class="d-inline-block fa fa-angle-down pointer toggle py-1 px-3 border text-bg-light"></i>')})},n}).apply(b,S),h!==void 0&&(_.exports=h)}}]);
