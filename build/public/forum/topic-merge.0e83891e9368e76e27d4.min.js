"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,2403,18593,34271,49897,69749,87212,92717,99127],{2403(S,k,h){var x,p;x=[h(69749),h(29930),h(49897)],p=(function(m,y,a){const u={};let l,c,E={};u.init=function(t){t=t||function(){},!l&&app.parseAndTranslate("modals/merge-topic",{},function(r){l=r,$("body").append(l),c=l.find("#merge_topics_confirm"),l.find("#merge_topics_cancel").on("click",e),$("#content").on("click",'[component="topic/select"]',w),s(),c.on("click",function(){n(c)}),m.enableQuickSearch({searchElements:{inputEl:l.find(".topic-search-input"),resultEl:l.find(".quick-search-container")},searchOptions:{in:"titles"},dropdown:{maxWidth:"400px",maxHeight:"350px"}}),l.on("click","[data-tid]",function(){const o=$(this).attr("data-tid");return o&&u.addTopic(o),!1}),l.on("click","[data-remove-tid]",function(){const o=$(this).attr("data-remove-tid");return o&&u.removeTopic(o),!1}),t()})},u.addTopic=function(t,r){r=r||function(){},a.get(`/topics/${t}`,{}).then(function(o){const f=o?o.title:"No title";E[t]=f,i(),s(),r()}).catch(y.error)},u.removeTopic=function(t){E[t]&&delete E[t],i(),s()};function w(t){if(!l)return;const r=$(this).parents('[component="category/topic"]'),o=r.hasClass("selected"),f=r.attr("data-tid");return o?u.addTopic(f):u.removeTopic(f),t.preventDefault(),t.stopPropagation(),!1}function n(t){t.attr("disabled",!0);const r=Object.keys(E),o={};l.find(".merge-main-topic-radio").is(":checked")?o.mainTid=l.find(".merge-main-topic-select").val():l.find(".merge-new-title-radio").is(":checked")&&(o.newTopicTitle=l.find(".merge-new-title-input").val()),socket.emit("topics.merge",{tids:r,options:o},function(f,C){if(t.removeAttr("disabled"),f)return y.error(f);ajaxify.go("/topic/"+C),e()})}function s(){if(!l)return;const t=Object.keys(E);t.sort(function(o,f){return o-f});const r=t.map(function(o){return{tid:o,title:E[o]}});t.length?app.parseAndTranslate("modals/merge-topic",{config,topics:r},function(o){l.find(".topics-section").html(o.find(".topics-section").html()),l.find(".merge-main-topic-select").html(o.find(".merge-main-topic-select").html())}):(l.find(".topics-section").translateHtml("[[error:no-topics-selected]]"),l.find(".merge-main-topic-select").html(""))}function i(){Object.keys(E).length?c.removeAttr("disabled"):c.attr("disabled",!0)}function e(){l&&(l.remove(),l=null),E={},$("#content").off("click",'[component="topic/select"]',w)}return u}).apply(k,x),p!==void 0&&(S.exports=p)},49897(S,k,h){h.r(k),h.d(k,{del:()=>i,get:()=>c,head:()=>E,patch:()=>n,post:()=>w,put:()=>s});var x=h(91749),p=h.n(x),m=h(33530),y=h.n(m);const a=config.relative_path+"/api/v3";async function u(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:a+e.url,typeof t=="function"){l(e).then(r=>t(null,r),r=>t(r));return}try{return await l(e)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again."){const{url:o}=await(0,x.fire)("filter:admin.reauth",{url:"login"});return(0,m.confirm)("[[error:api.reauth-required]]",f=>{f&&ajaxify.go(o)})}throw r}}async function l(e){const{url:t}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,x.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const r=await fetch(t,e),{headers:o}=r;if(o.get("x-redirect"))return l({url:o.get("x-redirect"),...e});const f=o.get("content-type"),C=f&&f.startsWith("application/json");let g;if(e.method!=="HEAD"&&(C?g=await r.json():g=await r.text()),!r.ok)throw g?new Error(C?g.status.message:g):new Error(r.statusText);return C&&g&&g.hasOwnProperty("status")&&g.hasOwnProperty("response")?g.response:g}function c(e,t,r){return u({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},r)}function E(e,t,r){return u({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},r)}function w(e,t,r){return u({url:e,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function n(e,t,r){return u({url:e,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function s(e,t,r){return u({url:e,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}function i(e,t,r){return u({url:e,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},r)}},68636(S,k,h){var x;x=(function(){function p(){this._store={},this._keys=[]}p.prototype.isMock=!0,p.prototype.setItem=function(a,u){a=String(a),this._keys.indexOf(a)===-1&&this._keys.push(a),this._store[a]=u},p.prototype.getItem=function(a){return a=String(a),this._keys.indexOf(a)===-1?null:this._store[a]},p.prototype.removeItem=function(a){a=String(a),this._keys=this._keys.filter(function(u){return u!==a}),this._store[a]=null},p.prototype.clear=function(){this._keys=[],this._store={}},p.prototype.key=function(a){return a=parseInt(a,10)||0,this._keys[a]},Object.defineProperty&&Object.defineProperty(p.prototype,"length",{get:function(){return this._keys.length}});let m;const y=Date.now().toString();try{if(m=window.localStorage,m.setItem(y,y),m.getItem(y)!==y)throw Error("localStorage behaved unexpectedly");return m.removeItem(y),m}catch(a){console.warn(a),console.warn("localStorage failed, falling back on sessionStorage");try{if(m=window.sessionStorage,m.setItem(y,y),m.getItem(y)!==y)throw Error("sessionStorage behaved unexpectedly");return m.removeItem(y),m}catch(u){return console.warn(u),console.warn("sessionStorage failed, falling back on memory storage"),new p}}}).call(k,h,k,S),x!==void 0&&(S.exports=x)},69749(S,k,h){var x,p;x=[h(17459),h(68636),h(91749),h(29930),h(89336),h(77918)],p=(function(m,y,a,u,l){const c={current:{}};c.saveToHistory=function(n){if(!n||n.length<2)return;let s=JSON.parse(localStorage.getItem("searchHistory")||"[]");s=s.filter(i=>i!==n),s.unshift(n),s=s.slice(0,8),y.setItem("searchHistory",JSON.stringify(s))},c.getHistory=function(){try{return JSON.parse(localStorage.getItem("searchHistory")||"[]")}catch(n){return console.error("Error reading search history:",n),[]}},c.clearHistory=function(){localStorage.removeItem("searchHistory")},c.displayHistory=function(n,s){const i=c.getHistory();if(!i||i.length===0){n.addClass("hidden").empty();return}let e='<div class="search-history-container">';e+='<div class="search-history-items">',i.forEach(function(t){e+='<div class="search-history-item" data-term="'+utils.escapeHTML(t)+'">',e+='<svg class="search-history-icon" width ="16" height="16" viewBox="0 0 24 24" fill="none" stroke = "currentColor" stroke-width="2">',e+='<circle cx="12" cy="12" r="10"></circle>',e+='<polyline points="12 6 12 12 16 14"></polyline>',e+="</svg>",e+='<span class="search-history-text">'+utils.escapeHTML(t)+"</span>",e+="</div>"}),e+="</div>",e+='<div class="search-history-clear">',e+='<button class="clear-history-btn">Clear search history</button>',e+="</div>",e+="</div>",n.removeClass("hidden").html(e),n.find(".search-history-item").on("click",function(){const t=$(this).data("term");s.val(t),s.closest("form").trigger("submit")}),n.find(".clear-history-btn").on("click",function(t){t.preventDefault(),t.stopPropagation(),c.clearHistory(),n.addClass("hidden"),s.trigger("focus")})},c.init=function(n){if(!config.searchEnabled)return;n=n||{in:config.searchDefaultInQuick||"titles"},$('[component="search/form"]').each((i,e)=>{E($(e),n)}),$(document).on("focus",'[component="search/fields"] input[name="query"]',function(){var i=$(this),e=i.closest('[component="search/fields"]').find("#quick-search-container"),t=i.val();(!t||t.length===0)&&(c.displayHistory(e,i),e.css({display:"block",visibility:"visible"}))})},c.showHistoryDropdown=function(n,s,i){c.displayHistory(n,s)};function E(n,s){const i=n.find('[component="search/button"]'),e=n.find('[component="search/fields"]'),t=e.find('input[name="query"]'),r=e.find("#quick-search-container"),o=e.hasClass("hidden"),f=/^(@|acct:)?[\w-]+@.+$/;o&&e.off("focusout").on("focusout",function(){setTimeout(function(){e.find(":focus").length||(e.addClass("hidden"),i.removeClass("hidden"))},200)}),t.off("focus");const C={inputEl:t,resultEl:r};c.enableQuickSearch({searchOptions:s,searchElements:C}),i.off("click").on("click",function(g){return!config.loggedIn&&!app.user.privileges["search:content"]?(u.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(g.stopPropagation(),c.showAndFocusInput(n),!1)}),n.off("submit").on("submit",function(){const g=$(this).find('input[name="query"]'),O=c.getSearchPreferences();return O.term=g.val(),O.in=s.in,c.saveToHistory(O.term),f.test(O.term)&&(O.in="users"),a.fire("action:search.submit",{searchOptions:O,searchElements:C}),c.query(O,function(){g.val(""),t.trigger("blur")}),!1})}c.enableQuickSearch=function(n){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const s=Object.assign({in:config.searchDefaultInQuick||"titles"},n.searchOptions),i=n.searchElements.resultEl,e=n.searchElements.inputEl;let t=e.val();const r=i.find(".filter-category");function o(){ajaxify.data.template.category&&ajaxify.data.cid&&m.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(d){const v=$("<div></div>").html(d).text();r.find(".name").text(v)}),r.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function f(){n.searchOptions=Object.assign({},s),n.searchOptions.term=e.val(),o(),ajaxify.data.template.category&&ajaxify.data.cid&&r.find('input[type="checkbox"]').is(":checked")&&(n.searchOptions.categories=[ajaxify.data.cid],n.searchOptions.searchChildren=!0),n.hideDuringSearch||(i.removeClass("hidden").find(".quick-search-results-container").html(""),i.find(".loading-indicator").removeClass("hidden")),a.fire("action:search.quick.start",n),n.searchOptions.searchOnly=1,c.api(n.searchOptions,function(d){if(i.find(".loading-indicator").addClass("hidden"),n.searchOptions.in==="categories"){if(!d.categories||n.hideOnNoMatches&&!d.categories.length)return i.addClass("hidden").find(".quick-search-results-container").html("");d.dropdown={maxWidth:"400px",maxHeight:"500px",...n.dropdown},app.parseAndTranslate("partials/quick-category-search-results",d,v=>{v.length&&v.find(".timeago").timeago(),i.toggleClass("hidden",!v.length||!e.is(":focus")).find(".quick-search-results-container").html(v.length?v:""),a.fire("action:search.quick.complete",{data:d,options:n})})}else{if(!d.posts||n.hideOnNoMatches&&!d.posts.length)return i.addClass("hidden").find(".quick-search-results-container").html("");d.posts.forEach(function(v){const T=$("<div>"+v.content+"</div>").text(),D=e.val().toLowerCase().replace(/^in:topic-\d+/,""),b=Math.max(0,T.toLowerCase().indexOf(D)-40);v.snippet=utils.escapeHTML((b>0?"...":"")+T.slice(b,b+80)+(T.length-b>80?"...":""))}),d.dropdown={maxWidth:"400px",maxHeight:"500px",...n.dropdown},app.parseAndTranslate("partials/quick-search-results",d,function(v){v.length&&v.find(".timeago").timeago(),i.toggleClass("hidden",!v.length||!e.is(":focus")).find(".quick-search-results-container").html(v.length?v:"");const T=i.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");c.highlightMatches(n.searchOptions.term,T),a.fire("action:search.quick.complete",{data:d,options:n})})}})}i.find('.filter-category input[type="checkbox"]').on("change",function(){e.focus(),f()}),e.off("keyup").on("keyup",utils.debounce(function(){if(e.val().length<3){i.addClass("hidden"),t=e.val();return}if(e.val()!==t){if(t=e.val(),!e.is(":focus"))return i.addClass("hidden");f()}},500)),i.on("mousedown",".quick-search-results > *",function(){$(window).one("mouseup",function(){i.addClass("hidden")})});const C=e.parent(),g=i.parent();C.on("focusout",O),g.on("focusout",O);function O(){setTimeout(function(){!C.find(":focus").length&&!g.find(":focus").length&&!i.hasClass("hidden")&&i.addClass("hidden")},200)}let I=!1;a.on("action:ajaxify.end",function(){ajaxify.isCold()||(I=!0),i.addClass("hidden")}),e.on("focus",function(){console.log("focus on fired event");const d=e.val();if(t=d,!d||d.length===0){c.showHistoryDropdown(i,e,s);return}d&&i.find("#quick-search-results").children().length&&(o(),I?(f(),I=!1):i.removeClass("hidden"),e[0].setSelectionRange(d.startsWith("in:topic")?d.indexOf(" ")+1:0,d.length))}),e.off("refresh").on("refresh",function(){f()})},c.showAndFocusInput=function(n){const s=n.parents(".dropdown-menu");if(s.length){const i=s.siblings("[data-bs-toggle]"),e=l.Dropdown.getOrCreateInstance(i[0]);e&&e.show()}else n.find('[component="search/fields"]').removeClass("hidden"),n.find('[component="search/button"]').addClass("hidden"),n.find('[component="search/fields"] input[name="query"]').trigger("focus")},c.query=function(n,s){s=s||function(){},ajaxify.go("search?"+w(n),s)},c.api=function(n,s){const i=config.relative_path+"/api/search?"+w(n);n.hasOwnProperty("searchOnly")&&delete n.searchOnly;const e=config.relative_path+"/search?"+w(n);$.get(i,function(t){t.url=e,s(t)})};function w(n){const s=n.in||"titles",i=n.term.replace(/^[ ?#]*/,""),e={...n,term:i,in:s};return a.fire("action:search.createQueryString",{query:e,data:n}),$.param(e)}return c.getSearchPreferences=function(){try{return JSON.parse(y.getItem("search-preferences")||"{}")}catch(n){return console.error(n),{}}},c.highlightMatches=function(n,s){if(!n||!s.length)return;n=utils.escapeHTML(n.replace(/^"/,"").replace(/"$/,"").trim());const i=n.split(" ").filter(t=>t.length>1).map(function(t){return utils.escapeRegexChars(t)}).join("|"),e=new RegExp("("+i+")","gi");s.each(function(){const t=$(this),r=[];t.find("*").each(function(){$(this).after("<!-- "+r.length+" -->"),r.push($("<div></div>").append($(this)))}),t.html(t.html().replace(e,function(o,f){return'<strong class="search-match fw-bold text-decoration-underline">'+f+"</strong>"})),r.forEach(function(o,f){t.html(t.html().replace("<!-- "+f+" -->",function(){return o.html()}))})}),$(".search-results .content").find("img:not(.not-responsive)").addClass("img-fluid")},c}).apply(k,x),p!==void 0&&(S.exports=p)}}]);
