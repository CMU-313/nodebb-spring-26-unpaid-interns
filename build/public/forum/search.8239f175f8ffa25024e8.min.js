"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,26174,26874,34271,48201,49897,51831,69185,69749,87212,92717,99127],{13230(k,T,u){var C,p,m;(function(v){p=[u(53050)],C=v,m=typeof C=="function"?C.apply(T,p):C,m!==void 0&&(k.exports=m)})(function(v){const d=v("[^\\p{L}\\s\\d\\-_@.]","g"),E=/[^\w\s\d\-_@.]/g,b=/^\s+|\s+$/g,s=/\s+/g,l=/-+/g,f=/-$/g,t=/^-/g,c=/^[\w\d\s.,\-@]+$/;return function(e,n){return e?(e=String(e).replace(b,""),c.test(e)?e=e.replace(E,"-"):e=v.replace(e,d,"-"),e=n?e:e.toLocaleLowerCase(),e=e.replace(s,"-"),e=e.replace(l,"-"),e=e.replace(f,""),e=e.replace(t,""),e):""}})},39259(k,T,u){var C,p;C=[u(96349),u(49897),u(91749)],p=(function(m,v,d){const E={};E.init=function(s,l){if(!s||!s.length)return;l=l||{},l.states=l.states||["watching","tracking","notwatching","ignoring"],l.template=l.template||"partials/category/filter-dropdown-left",d.fire("action:category.filter.options",{el:s,options:l}),m.init(s,l);let f=[],t=[];Array.isArray(l.selectedCids)?f=l.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(f=ajaxify.data.selectedCids.map(String)),t=f.slice(),s.on("hidden.bs.dropdown",function(){let c=t.length!==f.length;if(t.forEach(function(i,e){i!==f[e]&&(c=!0)}),t=f.slice(),c&&(l.updateButton?l.updateButton({el:s,changed:c,selectedCids:f.slice()}):l.updateButton!==!1&&b(s,f)),l.onHidden){l.onHidden({changed:c,selectedCids:f.slice()});return}if(c){let i=window.location.pathname;const e=utils.params();f.length?e.cid=f:delete e.cid,delete e.page,Object.keys(e).length&&(i+="?"+$.param(e)),ajaxify.go(i)}}),s.on("click",'[component="category/list"] [data-cid]',function(c){const i=s.find('[component="category/list"]'),e=$(this),n=e.find("a").attr("href");if(n&&n!=="#"&&n.length){c.stopPropagation();return}const r=e.attr("data-cid"),h=e.find('[component="category/select/icon"]');return r!=="all"?(f.includes(r)?f.splice(f.indexOf(r),1):f.push(r),f.sort(function(y,w){return y-w}),h.toggleClass("invisible"),i.find('[data-cid="all"] i').toggleClass("invisible",!!f.length)):(s.find('[component="category/select/icon"]').addClass("invisible"),i.find('[data-cid="all"] i').removeClass("invisible"),f=[]),l.selectedCids=f,l.onSelect&&l.onSelect({cid:r,selectedCids:f.slice()}),!1})};function b(s,l){l.length>1?f({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):l.length===1?v.get(`/categories/${l[0]}`,{}).then(f):f();function f(t){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:t},function(c){s.find("button").replaceWith($("<div/>").html(c).find("button"))})}}return E}).apply(T,C),p!==void 0&&(k.exports=p)},49897(k,T,u){u.r(T),u.d(T,{del:()=>i,get:()=>s,head:()=>l,patch:()=>t,post:()=>f,put:()=>c});var C=u(91749),p=u.n(C),m=u(33530),v=u.n(m);const d=config.relative_path+"/api/v3";async function E(e,n){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:d+e.url,typeof n=="function"){b(e).then(r=>n(null,r),r=>n(r));return}try{return await b(e)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again."){const{url:h}=await(0,C.fire)("filter:admin.reauth",{url:"login"});return(0,m.confirm)("[[error:api.reauth-required]]",y=>{y&&ajaxify.go(h)})}throw r}}async function b(e){const{url:n}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,C.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const r=await fetch(n,e),{headers:h}=r;if(h.get("x-redirect"))return b({url:h.get("x-redirect"),...e});const y=h.get("content-type"),w=y&&y.startsWith("application/json");let x;if(e.method!=="HEAD"&&(w?x=await r.json():x=await r.text()),!r.ok)throw x?new Error(w?x.status.message:x):new Error(r.statusText);return w&&x&&x.hasOwnProperty("status")&&x.hasOwnProperty("response")?x.response:x}function s(e,n,r){return E({url:e+(n&&Object.keys(n).length?"?"+$.param(n):"")},r)}function l(e,n,r){return E({url:e+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"HEAD"},r)}function f(e,n,r){return E({url:e,method:"POST",data:n,headers:{"x-csrf-token":config.csrf_token}},r)}function t(e,n,r){return E({url:e,method:"PATCH",data:n,headers:{"x-csrf-token":config.csrf_token}},r)}function c(e,n,r){return E({url:e,method:"PUT",data:n,headers:{"x-csrf-token":config.csrf_token}},r)}function i(e,n,r){return E({url:e,method:"DELETE",data:n,headers:{"x-csrf-token":config.csrf_token}},r)}},64308(k,T,u){var C,p;C=[u(49897),u(91749),u(13230),u(81335)],p=(function(m,v,d,E){const b={};return b.init=function(s,l){if(!s||!s.length)return;l=l||{};let f,t=[];l.selectedUsers&&(t=l.selectedUsers.map(n=>({...n}))),v.fire("action:user.filter.options",{el:s,options:l});async function c(){const n=l.selectedBlock||"userFilterSelected",r={};if(n.indexOf(".")!==-1){const y=n.split(".");r[y[0]]={},r[y[0]][y[1]]=t}else r[n]=t;const h=await app.parseAndTranslate(l.template,n,r);s.find('[component="user/filter/selected"]').html(h)}async function i(){await c(),l.onSelect&&l.onSelect(t)}async function e(){let n={users:[]};const r=s.find('[component="user/filter/search"]').val();if(r&&r.length>1)if(app.user.privileges["search:users"])n=await m.get("/api/users",{query:r});else try{const w=await m.get(`/api/user/${d(r)}`);n.users.push(w)}catch(w){console.error(w)}if(!n.users.length){s.find('[component="user/filter/results"]').translateHtml("[[users:no-users-found]]");return}n.users=n.users.slice(0,20);const h={};n.users.forEach(w=>{h[w.uid]=w});const y=await app.parseAndTranslate(l.template,"userFilterResults",{userFilterResults:n.users});s.find('[component="user/filter/results"]').html(y),s.find('[component="user/filter/results"] [data-uid]').on("click",async function(){const w=parseInt($(this).attr("data-uid"),10);t.find(x=>x.uid===w)||(t.push(h[w]),await i())})}s.find('[component="user/filter/search"]').on("keyup",()=>{s.find('[component="user/filter/results"]').html(f)}),s.find('[component="user/filter/search"]').on("keyup",utils.debounce(function(){app.user.privileges["search:users"]&&e()},1e3)),s.on("click",'[component="user/filter/delete"]',async function(){const n=$(this).attr("data-uid");t=t.filter(r=>parseInt(r.uid,10)!==parseInt(n,10)),await i()}),s.find('[component="user/filter/search"]').on("keyup",n=>{n.key==="Enter"&&!app.user.privileges["search:users"]&&e()}),s.on("shown.bs.dropdown",function(){s.find('[component="user/filter/search"]').trigger("focus")}),s.on("hidden.bs.dropdown",function(){l.onHidden&&l.onHidden(t)}),E.render(l.placeholderTemplate||"partials/userFilter-placeholders").then(n=>{f=n})},b}).apply(T,C),p!==void 0&&(k.exports=p)},68636(k,T,u){var C;C=(function(){function p(){this._store={},this._keys=[]}p.prototype.isMock=!0,p.prototype.setItem=function(d,E){d=String(d),this._keys.indexOf(d)===-1&&this._keys.push(d),this._store[d]=E},p.prototype.getItem=function(d){return d=String(d),this._keys.indexOf(d)===-1?null:this._store[d]},p.prototype.removeItem=function(d){d=String(d),this._keys=this._keys.filter(function(E){return E!==d}),this._store[d]=null},p.prototype.clear=function(){this._keys=[],this._store={}},p.prototype.key=function(d){return d=parseInt(d,10)||0,this._keys[d]},Object.defineProperty&&Object.defineProperty(p.prototype,"length",{get:function(){return this._keys.length}});let m;const v=Date.now().toString();try{if(m=window.localStorage,m.setItem(v,v),m.getItem(v)!==v)throw Error("localStorage behaved unexpectedly");return m.removeItem(v),m}catch(d){console.warn(d),console.warn("localStorage failed, falling back on sessionStorage");try{if(m=window.sessionStorage,m.setItem(v,v),m.getItem(v)!==v)throw Error("sessionStorage behaved unexpectedly");return m.removeItem(v),m}catch(E){return console.warn(E),console.warn("sessionStorage failed, falling back on memory storage"),new p}}}).call(T,u,T,k),C!==void 0&&(k.exports=C)},69749(k,T,u){var C,p;C=[u(17459),u(68636),u(91749),u(29930),u(89336),u(77918)],p=(function(m,v,d,E,b){const s={current:{}};s.saveToHistory=function(t){if(!t||t.length<2)return;let c=JSON.parse(localStorage.getItem("searchHistory")||"[]");c=c.filter(i=>i!==t),c.unshift(t),c=c.slice(0,8),v.setItem("searchHistory",JSON.stringify(c))},s.getHistory=function(){try{return JSON.parse(localStorage.getItem("searchHistory")||"[]")}catch(t){return console.error("Error reading search history:",t),[]}},s.clearHistory=function(){localStorage.removeItem("searchHistory")},s.displayHistory=function(t,c){const i=s.getHistory();if(!i||i.length===0){t.addClass("hidden").empty();return}let e='<div class="search-history-container">';e+='<div class="search-history-items">',i.forEach(function(n){e+='<div class="search-history-item" data-term="'+utils.escapeHTML(n)+'">',e+='<svg class="search-history-icon" width ="16" height="16" viewBox="0 0 24 24" fill="none" stroke = "currentColor" stroke-width="2">',e+='<circle cx="12" cy="12" r="10"></circle>',e+='<polyline points="12 6 12 12 16 14"></polyline>',e+="</svg>",e+='<span class="search-history-text">'+utils.escapeHTML(n)+"</span>",e+="</div>"}),e+="</div>",e+='<div class="search-history-clear">',e+='<button class="clear-history-btn">Clear search history</button>',e+="</div>",e+="</div>",t.removeClass("hidden").html(e),t.find(".search-history-item").on("click",function(){const n=$(this).data("term");c.val(n),c.closest("form").trigger("submit")}),t.find(".clear-history-btn").on("click",function(n){n.preventDefault(),n.stopPropagation(),s.clearHistory(),t.addClass("hidden"),c.trigger("focus")})},s.init=function(t){if(!config.searchEnabled)return;t=t||{in:config.searchDefaultInQuick||"titles"},$('[component="search/form"]').each((i,e)=>{l($(e),t)}),$(document).on("focus",'[component="search/fields"] input[name="query"]',function(){var i=$(this),e=i.closest('[component="search/fields"]').find("#quick-search-container"),n=i.val();(!n||n.length===0)&&(s.displayHistory(e,i),e.css({display:"block",visibility:"visible"}))})},s.showHistoryDropdown=function(t,c,i){s.displayHistory(t,c)};function l(t,c){const i=t.find('[component="search/button"]'),e=t.find('[component="search/fields"]'),n=e.find('input[name="query"]'),r=e.find("#quick-search-container"),h=e.hasClass("hidden"),y=/^(@|acct:)?[\w-]+@.+$/;h&&e.off("focusout").on("focusout",function(){setTimeout(function(){e.find(":focus").length||(e.addClass("hidden"),i.removeClass("hidden"))},200)}),n.off("focus");const w={inputEl:n,resultEl:r};s.enableQuickSearch({searchOptions:c,searchElements:w}),i.off("click").on("click",function(x){return!config.loggedIn&&!app.user.privileges["search:content"]?(E.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(x.stopPropagation(),s.showAndFocusInput(t),!1)}),t.off("submit").on("submit",function(){const x=$(this).find('input[name="query"]'),F=s.getSearchPreferences();return F.term=x.val(),F.in=c.in,s.saveToHistory(F.term),y.test(F.term)&&(F.in="users"),d.fire("action:search.submit",{searchOptions:F,searchElements:w}),s.query(F,function(){x.val(""),n.trigger("blur")}),!1})}s.enableQuickSearch=function(t){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const c=Object.assign({in:config.searchDefaultInQuick||"titles"},t.searchOptions),i=t.searchElements.resultEl,e=t.searchElements.inputEl;let n=e.val();const r=i.find(".filter-category");function h(){ajaxify.data.template.category&&ajaxify.data.cid&&m.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(A){const D=$("<div></div>").html(A).text();r.find(".name").text(D)}),r.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function y(){t.searchOptions=Object.assign({},c),t.searchOptions.term=e.val(),h(),ajaxify.data.template.category&&ajaxify.data.cid&&r.find('input[type="checkbox"]').is(":checked")&&(t.searchOptions.categories=[ajaxify.data.cid],t.searchOptions.searchChildren=!0),t.hideDuringSearch||(i.removeClass("hidden").find(".quick-search-results-container").html(""),i.find(".loading-indicator").removeClass("hidden")),d.fire("action:search.quick.start",t),t.searchOptions.searchOnly=1,s.api(t.searchOptions,function(A){if(i.find(".loading-indicator").addClass("hidden"),t.searchOptions.in==="categories"){if(!A.categories||t.hideOnNoMatches&&!A.categories.length)return i.addClass("hidden").find(".quick-search-results-container").html("");A.dropdown={maxWidth:"400px",maxHeight:"500px",...t.dropdown},app.parseAndTranslate("partials/quick-category-search-results",A,D=>{D.length&&D.find(".timeago").timeago(),i.toggleClass("hidden",!D.length||!e.is(":focus")).find(".quick-search-results-container").html(D.length?D:""),d.fire("action:search.quick.complete",{data:A,options:t})})}else{if(!A.posts||t.hideOnNoMatches&&!A.posts.length)return i.addClass("hidden").find(".quick-search-results-container").html("");A.posts.forEach(function(D){const P=$("<div>"+D.content+"</div>").text(),L=e.val().toLowerCase().replace(/^in:topic-\d+/,""),o=Math.max(0,P.toLowerCase().indexOf(L)-40);D.snippet=utils.escapeHTML((o>0?"...":"")+P.slice(o,o+80)+(P.length-o>80?"...":""))}),A.dropdown={maxWidth:"400px",maxHeight:"500px",...t.dropdown},app.parseAndTranslate("partials/quick-search-results",A,function(D){D.length&&D.find(".timeago").timeago(),i.toggleClass("hidden",!D.length||!e.is(":focus")).find(".quick-search-results-container").html(D.length?D:"");const P=i.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");s.highlightMatches(t.searchOptions.term,P),d.fire("action:search.quick.complete",{data:A,options:t})})}})}i.find('.filter-category input[type="checkbox"]').on("change",function(){e.focus(),y()}),e.off("keyup").on("keyup",utils.debounce(function(){if(e.val().length<3){i.addClass("hidden"),n=e.val();return}if(e.val()!==n){if(n=e.val(),!e.is(":focus"))return i.addClass("hidden");y()}},500)),i.on("mousedown",".quick-search-results > *",function(){$(window).one("mouseup",function(){i.addClass("hidden")})});const w=e.parent(),x=i.parent();w.on("focusout",F),x.on("focusout",F);function F(){setTimeout(function(){!w.find(":focus").length&&!x.find(":focus").length&&!i.hasClass("hidden")&&i.addClass("hidden")},200)}let R=!1;d.on("action:ajaxify.end",function(){ajaxify.isCold()||(R=!0),i.addClass("hidden")}),e.on("focus",function(){console.log("focus on fired event");const A=e.val();if(n=A,!A||A.length===0){s.showHistoryDropdown(i,e,c);return}A&&i.find("#quick-search-results").children().length&&(h(),R?(y(),R=!1):i.removeClass("hidden"),e[0].setSelectionRange(A.startsWith("in:topic")?A.indexOf(" ")+1:0,A.length))}),e.off("refresh").on("refresh",function(){y()})},s.showAndFocusInput=function(t){const c=t.parents(".dropdown-menu");if(c.length){const i=c.siblings("[data-bs-toggle]"),e=b.Dropdown.getOrCreateInstance(i[0]);e&&e.show()}else t.find('[component="search/fields"]').removeClass("hidden"),t.find('[component="search/button"]').addClass("hidden"),t.find('[component="search/fields"] input[name="query"]').trigger("focus")},s.query=function(t,c){c=c||function(){},ajaxify.go("search?"+f(t),c)},s.api=function(t,c){const i=config.relative_path+"/api/search?"+f(t);t.hasOwnProperty("searchOnly")&&delete t.searchOnly;const e=config.relative_path+"/search?"+f(t);$.get(i,function(n){n.url=e,c(n)})};function f(t){const c=t.in||"titles",i=t.term.replace(/^[ ?#]*/,""),e={...t,term:i,in:c};return d.fire("action:search.createQueryString",{query:e,data:t}),$.param(e)}return s.getSearchPreferences=function(){try{return JSON.parse(v.getItem("search-preferences")||"{}")}catch(t){return console.error(t),{}}},s.highlightMatches=function(t,c){if(!t||!c.length)return;t=utils.escapeHTML(t.replace(/^"/,"").replace(/"$/,"").trim());const i=t.split(" ").filter(n=>n.length>1).map(function(n){return utils.escapeRegexChars(n)}).join("|"),e=new RegExp("("+i+")","gi");c.each(function(){const n=$(this),r=[];n.find("*").each(function(){$(this).after("<!-- "+r.length+" -->"),r.push($("<div></div>").append($(this)))}),n.html(n.html().replace(e,function(h,y){return'<strong class="search-match fw-bold text-decoration-underline">'+y+"</strong>"})),r.forEach(function(h,y){n.html(n.html().replace("<!-- "+y+" -->",function(){return h.html()}))})}),$(".search-results .content").find("img:not(.not-responsive)").addClass("img-fluid")},s}).apply(T,C),p!==void 0&&(k.exports=p)},70187(k,T,u){var C,p;C=[u(69749),u(68636),u(91749),u(29930),u(49897),u(17459),u(39259),u(64308)],p=(function(m,v,d,E,b,s,l,f){const t={};let c=[],i=[],e=[],n={};t.init=function(){const o=$("#search-in");o.on("change",function(){F(o.val())});const g=$("#results").attr("data-search-query");m.highlightMatches(g,$(".search-results .content p, .search-results .topic-title")),$("#advanced-search form").off("submit").on("submit",function(a){return a.preventDefault(),m.query(x()),!1}),A(),D(ajaxify.data.selectedCids),P($('[component="user/filter"]'),ajaxify.data.userFilterSelected),L($('[component="tag/filter"]'),ajaxify.data.tagFilterSelected),$('[component="search/filters"]').on("hidden.bs.dropdown",".dropdown",function(){const a={replies:w,time:h,sort:y,tag:r};a[$(this).attr("data-filter-name")]&&a[$(this).attr("data-filter-name")]();const O=x();JSON.stringify(n)!==JSON.stringify(O)&&(n=O,m.query(n))}),R(),h(),w(),y(),n=x()};function r(){const o=i.length>0;let g="[[search:tags]]";i.length&&(g=s.compile("search:tags-x",i.map(a=>a.value).join(", "))),$('[component="tag/filter/button"]').toggleClass("active-filter",o).find(".filter-label").translateHtml(g)}function h(){const o=$("#post-time-range").val()>0;$("#post-time-button").toggleClass("active-filter",o).find(".filter-label").translateText(o?`[[search:time-${$("#post-time-filter").val()}-than-${$("#post-time-range").val()}]]`:"[[search:time]]")}function y(){const o=$("#post-sort-by").val()!=="relevance"||$("#post-sort-direction").val()!=="desc";$("#sort-by-button").toggleClass("active-filter",o).find(".filter-label").translateText(o?`[[search:sort-by-${$("#post-sort-by").val()}-${$("#post-sort-direction").val()}]]`:"[[search:sort]]")}function w(){const o=$("#reply-count").val()>0;$("#reply-count-button").toggleClass("active-filter",o).find(".filter-label").translateText(o?`[[search:replies-${$("#reply-count-filter").val()}-count, ${$("#reply-count").val()}]]`:"[[search:replies]]")}function x(){const o=$("#advanced-search"),g={in:$("#search-in").val()};return g.term=$("#search-input").val(),["posts","titlesposts","titles","bookmarks"].includes(g.in)&&(g.matchWords=o.find("#match-words-filter").val(),g.by=c.length?c.map(a=>a.username):void 0,g.categories=e.length?e:void 0,g.searchChildren=o.find("#search-children").is(":checked"),g.hasTags=i.length?i.map(a=>a.value):void 0,g.replies=o.find("#reply-count").val(),g.repliesFilter=o.find("#reply-count-filter").val(),g.timeFilter=o.find("#post-time-filter").val(),g.timeRange=o.find("#post-time-range").val(),g.sortBy=o.find("#post-sort-by").val(),g.sortDirection=o.find("#post-sort-direction").val(),g.showAs=o.find("#show-results-as").val()),d.fire("action:search.getSearchDataFromDOM",{form:o,data:g}),g}function F(o){const g=!["posts","titles","bookmarks"].some(a=>o.includes(a));$(".post-search-item").toggleClass("hidden",g)}function R(){const o=utils.params({disableToType:!0}),g=m.getSearchPreferences(),a=utils.merge(g,o);a&&(ajaxify.data.term&&$("#search-input").val(ajaxify.data.term),a.in=a.in||ajaxify.data.searchDefaultIn,$("#search-in").val(a.in),F(a.in),a.matchWords&&$("#match-words-filter").val(a.matchWords),a.showAs&&$("#show-results-as").val(a.showAs),a.by&&(a.by=Array.isArray(a.by)?a.by:[a.by],a.by.forEach(function(O){$("#posted-by-user").tagsinput("add",O)})),a.categories&&$("#posted-in-categories").val(a.categories),a.searchChildren&&$("#search-children").prop("checked",!0),a.hasTags&&(a.hasTags=Array.isArray(a.hasTags)?a.hasTags:[a.hasTags],a.hasTags.forEach(function(O){$("#has-tags").tagsinput("add",O)})),a.replies&&($("#reply-count").val(a.replies),$("#reply-count-filter").val(a.repliesFilter)),a.timeRange&&($("#post-time-range").val(a.timeRange),$("#post-time-filter").val(a.timeFilter)),(a.sortBy||ajaxify.data.searchDefaultSortBy)&&$("#post-sort-by").val(a.sortBy||ajaxify.data.searchDefaultSortBy),$("#post-sort-direction").val(a.sortDirection||"desc"),d.fire("action:search.fillOutForm",{form:a}))}function A(){$("#save-preferences").on("click",function(){const o=x(),g=["matchWords","in","showAs","replies","repliesFilter","timeFilter","timeRange","sortBy","sortDirection"],a={};return g.forEach(O=>{a[O]=o[O]}),v.setItem("search-preferences",JSON.stringify(a)),E.success("[[search:search-preferences-saved]]"),!1}),$("#clear-preferences").on("click",async function(){v.removeItem("search-preferences");const o=await app.parseAndTranslate("partials/search-filters",{});return $('[component="search/filters"]').replaceWith(o),$("#search-in").val(ajaxify.data.searchDefaultIn),$("#post-sort-by").val(ajaxify.data.searchDefaultSortBy),$("#match-words-filter").val("all"),$("#show-results-as").val("posts"),P($('[component="user/filter"]'),[]),L($('[component="tag/filter"]'),[]),D([]),E.success("[[search:search-preferences-cleared]]"),!1})}function D(o){ajaxify.data.allCategoriesUrl="",e=o||[];const g=$('[component="category/filter"]');l.init(g,{selectedCids:o,updateButton:!1,onHidden:async function(a){const O=a.selectedCids.length>0&&a.selectedCids[0]!=="all";let j="[[search:categories]]";if(ajaxify.data.selectedCids=a.selectedCids,e=a.selectedCids,a.selectedCids.length===1&&a.selectedCids[0]==="watched")ajaxify.data.selectedCategory={cid:"watched"},j="[[search:categories-watched-categories]]";else if(a.selectedCids.length===1&&a.selectedCids[0]==="all")ajaxify.data.selectedCategory=null;else if(a.selectedCids.length>0){const S=await b.get(`/categories/${a.selectedCids[0]}`);ajaxify.data.selectedCategory=S,j=`[[search:categories-x, ${S.name}]]`}a.selectedCids.length>1&&(j=`[[search:categories-x, ${a.selectedCids.length}]]`),$('[component="category/filter/button"]').toggleClass("active-filter",O).find(".filter-label").translateText(j)},localCategories:[{cid:"watched",name:"[[category:watched-categories]]",icon:""}]})}function P(o,g){c=g||[],f.init(o,{selectedUsers:g,template:"partials/search-filters",onSelect:function(a){c=a},onHidden:function(a){const O=a.length>0;let j="[[search:posted-by]]";O&&(j=s.compile("search:posted-by-usernames",c.map(S=>S.username).join(", "))),o.find('[component="user/filter/button"]').toggleClass("active-filter",O).find(".filter-label").translateText(j)}})}function L(o,g){i=g;async function a(){const S=await app.parseAndTranslate("partials/search-filters","tagFilterSelected",{tagFilterSelected:i});o.find('[component="tag/filter/selected"]').html(S)}function O(S){const I=utils.escapeHTML(S);return{value:S,valueEscaped:I,valueEncoded:encodeURIComponent(S),class:I.replace(/\s/g,"-")}}async function j(){let S={tags:[]};const I=o.find('[component="tag/filter/search"]').val();if(I&&I.length>1&&(app.user.privileges["search:tags"]?S=await socket.emit("topics.searchAndLoadTags",{query:I}):S={tags:[O(I)]}),!S.tags.length){o.find('[component="tag/filter/results"]').translateHtml("[[tags:no-tags-found]]");return}S.tags=S.tags.slice(0,20);const H={};S.tags.forEach(B=>{H[B.value]=B});const M=await app.parseAndTranslate("partials/search-filters","tagFilterResults",{tagFilterResults:S.tags});o.find('[component="tag/filter/results"]').html(M),o.find('[component="tag/filter/results"] [data-tag]').on("click",async function(){i.push(H[$(this).attr("data-tag")]),a()})}o.find('[component="tag/filter/search"]').on("keyup",utils.debounce(function(){app.user.privileges["search:tags"]&&j()},1e3)),o.on("click",'[component="tag/filter/delete"]',function(){const S=$(this).attr("data-tag");i=i.filter(I=>I.value!==S),a()}),o.find('[component="tag/filter/search"]').on("keyup",S=>{if(S.key==="Enter"&&!app.user.privileges["search:tags"]){const I=o.find('[component="tag/filter/search"]').val();I&&i.every(H=>H.value!==I)&&(i.push(O(I)),a()),o.find('[component="tag/filter/search"]').val("")}}),o.on("shown.bs.dropdown",function(){o.find('[component="tag/filter/search"]').trigger("focus")})}return t}).apply(T,C),p!==void 0&&(k.exports=p)},96349(k,T,u){var C,p;C=[u(29930),u(89336),u(49897)],p=(function(m,v,d){const E={};return E.init=function(b,s){let l=s.defaultCategories||null;s=s||{},s.privilege=s.privilege||"topics:read",s.states=s.states||["watching","tracking","notwatching","ignoring"],s.cacheList=s.hasOwnProperty("cacheList")?s.cacheList:!0;let f=[];Array.isArray(s.localCategories)&&(f=s.localCategories.map(n=>({...n})),l&&(l=[...f,...l])),s.selectedCids=s.selectedCids||ajaxify.data.selectedCids||[];const t=b.find('[component="category-selector-search"]');if(!t.length)return;const c=t.parents('[component="category/dropdown"]').length>0||t.parents('[component="category-selector"]').length>0;b.on("show.bs.dropdown",function(){c&&t.removeClass("hidden");function n(){const r=t.find("input").val();r.length>1||!r&&!l?i(r,function(h){l=s.cacheList&&(l||h),e(h)}):!r&&l&&e(l)}t.on("click",function(r){r.preventDefault(),r.stopPropagation()}),t.find("input").val("").on("keyup",utils.debounce(n,300)),n()}),b.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||t.find("input").focus()}),b.on("hide.bs.dropdown",function(){c&&t.addClass("hidden"),t.off("click"),t.find("input").off("keyup")});function i(n,r){d.get("/search/categories",{search:n,query:utils.params(),parentCid:s.parentCid||0,selectedCids:s.selectedCids,privilege:s.privilege,states:s.states,showLinks:s.showLinks,localOnly:s.localOnly,hideUncategorized:s.hideUncategorized},function(h,{categories:y}){if(h)return m.error(h);r(f.concat(y))})}function e(n){const r=s.selectedCids.map(String);n.forEach(function(h){h.selected=r.includes(String(h.cid))}),app.parseAndTranslate(s.template,{categoryItems:n.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl,hideAll:s.hideAll},function(h){b.find('[component="category/list"]').html(h.find('[component="category/list"]').html()),b.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!n.length);const y=v.Dropdown.getInstance(b.find(".dropdown-toggle").get(0));y&&y.update()})}},E}).apply(T,C),p!==void 0&&(k.exports=p)}}]);
