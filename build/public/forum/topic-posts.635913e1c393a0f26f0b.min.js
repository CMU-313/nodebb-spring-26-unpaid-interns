"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[22765,75264],{2269(B,b){var r,A;r=[],A=(function(){const P={},j=/-resized(\.[\w]+)?$/;return P.wrapImagesInLinks=function(x){x.find('[component="post/content"] img:not(.emoji)').each(function(){P.wrapImageInLink($(this))})},P.wrapImageInLink=function(x){let w=x.attr("src")||"";if(w!=="about:blank"&&!x.parent().is("a")){utils.isRelativeUrl(w)&&j.test(w)&&(w=w.replace(j,"$1"));const E=x.attr("alt")||"",T=w.split(".").slice(1).pop(),l=E.split("/").pop(),m=l.split(".").slice(1).pop();x.wrap('<a href="'+w+'" '+(!T&&m?' download="'+utils.escapeHTML(l)+'" ':"")+' target="_blank" rel="noopener">')}},P}).apply(b,r),A!==void 0&&(B.exports=A)},22410(B,b,r){var A,P;A=[r(91749),r(29930),r(49897)],P=(function(j,x,w){const E={};let T,l=0,m=!1,M,N=0;E.init=function(e,f){const p=$("body");typeof e=="function"?(T=e,M=p):(T=f,M=e||p),l=$(window).scrollTop(),$(window).off("scroll",a).on("scroll",a),p.height()<=$(window).height()&&(!ajaxify.data.hasOwnProperty("pageCount")||ajaxify.data.pageCount>1)&&T(1)};function a(){N&&clearTimeout(N),N=setTimeout(function(){N=0,C()},60)}function C(){if(R())return;const e=O(),f=L(e.currentScrollTop);W(e)&&T(f),l=e.currentScrollTop}function R(){const e=utils.findBootstrapEnvironment(),f=(e==="xs"||e==="sm")&&$("html").hasClass("composing");return m||f||app.flags._glance}function O(){const e=$(window).scrollTop(),f=$(window).height(),p=M.offset(),c=p?p.top:0,g=M.height()-f,I=g<=0?f:g,D=100*(e-c)/I;return{currentScrollTop:e,viewportHeight:g,scrollPercent:D}}function L(e){return e>l?1:-1}function W(e){const c=e.currentScrollTop<l,g=e.currentScrollTop>l;return!!(e.scrollPercent<15&&c||e.scrollPercent>85&&g||e.scrollPercent<0&&g&&e.viewportHeight<0)}return E.loadMore=function(e,f,p){if(m)return;m=!0;const c={method:e,data:f};j.fire("action:infinitescroll.loadmore",c),(c.method.startsWith("/")?w.get:socket.emit)(c.method,c.data,function(I,D){if(I)return m=!1,x.error(I);p(D,function(){m=!1})})},E.loadMoreXhr=function(e,f){if(m)return;m=!0;const p=config.relative_path+"/api"+location.pathname.replace(new RegExp("^"+config.relative_path),""),c={url:p,data:e};j.fire("action:infinitescroll.loadmore.xhr",c),$.get(p,e,function(g){f(g,function(){m=!1})}).fail(function(g){m=!1,x.error(String(g.responseJSON||"[[error:no-connection]]"))})},E.removeExtra=function(e,f,p){let c=$();if(e.length<=p)return c;const g=e.length-p;if(f>0){const I=$(document).height(),D=$(window).scrollTop();c=e.slice(0,g).remove(),$(window).scrollTop(D+($(document).height()-I))}else c=e.slice(e.length-g).remove();return c},E}).apply(b,A),P!==void 0&&(B.exports=P)},47536(B,b,r){var A,P;A=[r(25967),r(22410),r(8454),r(2269),r(96352),r(52473),r(17459),r(91749),r(30076)],P=(function(j,x,w,E,T,l,m,M,N){const a={};a.signaturesShown={};const C=$(window);a.onNewPost=function(t){!t||!t.posts||!t.posts.length||String(t.posts[0].tid)!==String(ajaxify.data.tid)||(t.loggedIn=!!app.user.uid,t.privileges=ajaxify.data.privileges,t.posts[0].timestamp=t.posts[0].topic.scheduled?t.posts[0].timestamp:Date.now()-1e3,t.posts[0].timestampISO=utils.toISOString(t.posts[0].timestamp),a.modifyPostsByPrivileges(t.posts),O(t.posts),R(t.posts[0]),L(t.posts),ajaxify.data.postcount+=1,w.updatePostCount(ajaxify.data.postcount),config.usePagination?W(t):f(t),r.e(18631).then(function(){var o=[r(18631)];(function(n){n.onNewPost(t)}).apply(null,o)}).catch(r.oe))};function R(t){$(".pagination-block .pagebottom .timeago").timeago("update",t.timestampISO)}a.modifyPostsByPrivileges=function(t){t.forEach(function(o){o.selfPost=!!app.user.uid&&parseInt(o.uid,10)===parseInt(app.user.uid,10),o.topicOwnerPost=parseInt(o.uid,10)===parseInt(ajaxify.data.uid,10),o.display_edit_tools=ajaxify.data.privileges["posts:edit"]&&o.selfPost||ajaxify.data.privileges.isAdminOrMod,o.display_delete_tools=ajaxify.data.privileges["posts:delete"]&&o.selfPost||ajaxify.data.privileges.isAdminOrMod,o.display_moderator_tools=o.display_edit_tools||o.display_delete_tools,o.display_move_tools=ajaxify.data.privileges.isAdminOrMod,o.display_post_menu=ajaxify.data.privileges.isAdminOrMod||o.selfPost&&!ajaxify.data.locked&&!o.deleted||o.selfPost&&o.deleted&&parseInt(o.deleterUid,10)===parseInt(app.user.uid,10)||(app.user.uid||ajaxify.data.postSharing.length)&&!o.deleted})};function O(t){for(let o=0;o<t.length;o+=1){const n=l.get("user/postcount",t[o].uid);n.html(N.formattedNumber(parseInt(n.attr("data-postcount"),10)+1))}}function L(t){config.topicPostSort==="newest_to_oldest"&&(t[0].index=1,l.get("post").not("[data-index=0]").each(function(){const o=parseInt($(this).attr("data-index"),10)+1;$(this).attr("data-index",o)}))}function W(t){function o(){p(t.posts[0])}const n=t.posts;ajaxify.data.pagination.pageCount=Math.max(1,Math.ceil(n[0].topic.postcount/config.postsPerPage));const i=config.topicPostSort==="oldest_to_newest"||config.topicPostSort==="most_votes"?1:-1;if(ajaxify.data.pagination.currentPage===ajaxify.data.pagination.pageCount&&i===1||ajaxify.data.pagination.currentPage===1&&i===-1){const y=$('[component="post"]:not([data-index=0]), [component="topic/event"]');c(t,y,i,!1,o)}else ajaxify.data.scrollToMyPost&&parseInt(n[0].uid,10)===parseInt(app.user.uid,10)?setTimeout(function(){j.loadPage(ajaxify.data.pagination.pageCount,o)},250):e()}function e(){$.get(config.relative_path+"/api/topic/pagination/"+ajaxify.data.tid,{page:ajaxify.data.pagination.currentPage},function(t){app.parseAndTranslate("partials/paginator",t,function(o){$('[component="pagination"]').after(o).remove()})})}function f(t){const o=config.topicPostSort==="oldest_to_newest"||config.topicPostSort==="most_votes"?1:-1,n=$('[component="post"][data-index="'+(t.posts[0].index-1)+'"]').length;if(!n&&(!t.posts[0].selfPost||!ajaxify.data.scrollToMyPost))return;if(!n&&t.posts[0].selfPost)return ajaxify.go("post/"+t.posts[0].pid);const i=$('[component="topic"]>[component="post"]:not([data-index=0]), [component="topic"]>[component="topic/event"]');c(t,i,o,!1,function(s){s&&s.addClass("new"),p(t.posts[0])})}function p(t){t.selfPost&&ajaxify.data.scrollToMyPost&&T.scrollBottom(t.index)}function c(t,o,n,i,s){if(s=s||function(){},!t||t.posts&&!t.posts.length)return s();function y(){const h=$('[component="post"].new');if(h.length===t.posts.length){let v=!0;if(h.each(function(u,_){parseInt($(_).attr("data-pid"),10)!==parseInt(t.posts[u].pid,10)&&(v=!1)}),v){h.each(function(){$(this).removeClass("new")}),t.posts.length=0;return}}h.length&&t.posts.length>1&&t.posts.forEach(function(v){const u=l.get("post","pid",v.pid);u.hasClass("new")&&u.remove()}),t.posts=t.posts.filter(function(v){return v.allowDupe||$('[component="post"][data-pid="'+v.pid+'"]').length===0})}if(y(),!t.posts.length)return s();let d,S;n>0&&o.length?d=o.last():n<0&&o.length&&(S=o.first()),M.fire("action:posts.loading",{posts:t.posts,after:d,before:S}),app.parseAndTranslate("topic","posts",Object.assign({},ajaxify.data,t),async function(h){h=h.filter(function(){const u=$(this),_=u.attr("data-pid"),k=u.attr("data-allow-dupe");return!u.is('[component="post"]')||k||_&&$('[component="post"][data-pid="'+_+'"]').length===0});const v=x.removeExtra($('[component="post"]'),n,Math.max(20,config.postsPerPage*2));if(d)h.insertAfter(d);else if(S){const u=$(document).height(),_=C.scrollTop();h.insertBefore(S),(i||_>0)&&C.scrollTop(_+($(document).height()-u))}else l.get("topic").append(h);await a.onNewPostsAddedToDom(h),D(v),M.fire("action:posts.loaded",{posts:t.posts}),s(h)})}a.loadMorePosts=function(t){if(!l.get("topic").length||T.scrollActive)return;const o=l.get("topic").find(l.get("post").not("[data-index=0]").not(".new")),n=t>0?o.last():o.first(),i=parseInt(n.attr("data-index"),10)||0,s=ajaxify.data.tid;if(!utils.isNumber(i)||t<0&&l.get("post","index",0).length)return;const y=$(".loading-indicator");y.is(":animated")||y.fadeIn(),x.loadMore("topics.loadMore",{tid:s,after:i+(t>0?1:0),count:config.postsPerPage,direction:t,topicPostSort:utils.params().sort||config.topicPostSort},function(d,S){if(y.fadeOut(),d&&d.posts&&d.posts.length){const h=$('[component="post"]:not([data-index=0]):not(.new), [component="topic/event"]');c(d,h,t,!0,S)}else T.update(),S()})},a.onTopicPageLoad=async function(t){F(t),E.wrapImagesInLinks(t),I(t),a.showBottomPostBar(),t.find('[component="post/content"] img:not(.not-responsive)').addClass("img-fluid"),a.addBlockquoteEllipses(t),U(t),await g()},a.addTopicEvents=async function(t){if(config.topicPostSort==="most_votes")return;const o=await Promise.all(t.map(n=>app.parseAndTranslate("partials/topic/event",{...n,privileges:ajaxify.data.privileges})));if(config.topicPostSort==="oldest_to_newest")$('[component="topic"]').append(o);else if(config.topicPostSort==="newest_to_oldest"){const n=$('[component="topic"] [component="post"][data-index="0"]');n.length?n.after(o.reverse()):$('[component="topic"]').prepend(o.reverse())}$('[component="topic/event"] .timeago').timeago()};async function g(){const t=ajaxify.data.necroThreshold*24*60*60*1e3;if(!t||config.topicPostSort!=="newest_to_oldest"&&config.topicPostSort!=="oldest_to_newest")return;const o=C.scrollTop(),n=$('[component="post"]').toArray();await Promise.all(n.map(async function(i){i=$(i);const s=i.prev('[component="post"]');if(i.is(":has(.necro-post)")||!s.length||config.topicPostSort==="newest_to_oldest"&&parseInt(s.attr("data-index"),10)===0)return;const y=i.attr("data-timestamp")-s.attr("data-timestamp");if(Math.abs(y)>=t){const d=["suffixAgo","prefixAgo","suffixFromNow","prefixFromNow"],S={};d.forEach(u=>{S[u]=$.timeago.settings.strings[u],$.timeago.settings.strings[u]=""});const h=(y>0?"[[topic:timeago-later,":"[[topic:timeago-earlier,")+$.timeago.inWords(y)+"]]";d.forEach(u=>{$.timeago.settings.strings[u]=S[u]});const v=await app.parseAndTranslate("partials/topic/necro-post",{text:h});v.attr("data-necro-post-index",s.attr("data-index")),v.insertBefore(i)}})),o>0&&C.scrollTop()<o&&C.scrollTop(o)}function I(t){ajaxify.data["signatures:hideDuplicates"]&&t.each((o,n)=>{const i=$(n).find('[component="post/signature"]'),s=i.attr("data-uid");a.signaturesShown[s]?i.addClass("hidden"):a.signaturesShown[s]=!0})}function D(t){t.each((o,n)=>{$(`[data-necro-post-index="${$(n).attr("data-index")}"]`).remove()})}function F(t){if(app.user.uid||!ajaxify.data.privateUploads)return;const o=document.createElement("a");o.className="login-required",o.href=config.relative_path+"/login",m.translate("[[topic:login-to-view]]",function(n){o.appendChild(document.createTextNode(n)),t.each(function(i,s){$(s).find('[component="post/content"] img').each(function(y,d){d=$(d),d.attr("src").startsWith(config.relative_path+config.upload_url)&&d.replaceWith(o.cloneNode(!0))})})})}a.onNewPostsAddedToDom=async function(t){await a.onTopicPageLoad(t),t.find(".timeago").timeago()},a.showBottomPostBar=function(){const t=l.get("post","index",0),o=$(".post-bar-placeholder"),n=$('[component="post"]');t.length&&n.length>1&&$(".post-bar").length<2&&o.length?($(".post-bar").clone().insertAfter(o),o.remove()):t.length&&n.length<2&&t.find(".post-bar").remove()};function U(t){t.each(function(){$(this).hasClass("deleted")&&w.toggle($(this).attr("data-pid"),!0)})}return a.addBlockquoteEllipses=function(t){t.find('[component="post/content"] blockquote').filter((i,s)=>!$(s).parent().is("blockquote")).find(">blockquote").each(function(){const i=$(this);i.find(":hidden:not(br)").length&&!i.find(".toggle").length&&i.append('<i class="d-inline-block fa fa-angle-down pointer toggle py-1 px-3 border text-bg-light"></i>')})},a}).apply(b,A),P!==void 0&&(B.exports=P)}}]);
