"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,28310,34271,49888,49897,69185,86198,99127],{28310(A,C,l){var g,m;g=[l(65348),l(29930),l(91749),l(49897)],m=(function(E,p,v,f){const o={};let e,a;o.init=function(t,n,i){e||(o.tids=t,o.currentCid=n,o.onComplete=i,o.moveAll=!t,d())};function d(){app.parseAndTranslate("modals/move-topic",{},function(t){e=t,$("body").append(e),(o.moveAll||o.tids&&o.tids.length>1)&&e.find(".card-header").translateText("[[topic:move-topics]]");const n=e.find('[component="category-selector"]');n.addClass("dropup"),E.init(n,{onSelect:r,privilege:"moderate",localOnly:!0}),e.find("#move_thread_commit").on("click",u),e.find("#move_topic_cancel").on("click",c)})}function r(t){a=t,e.find("#move_thread_commit").prop("disabled",!1)}function u(){const t=e.find("#move_thread_commit");if(!t.prop("disabled")&&a&&a.cid){t.prop("disabled",!0),c();let n="[[topic:topic-move-success, "+a.name+"]]";o.tids&&o.tids.length>1?n="[[topic:topic-move-multiple-success, "+a.name+"]]":o.tids||(n="[[topic:topic-move-all-success, "+a.name+"]]");const i={tids:o.tids?o.tids.slice():null,cid:a.cid,currentCid:o.currentCid,onComplete:o.onComplete};if(config.undoTimeout>0)return p.alert({alert_id:"tids_move_"+(o.tids?o.tids.join("-"):"all"),title:"[[topic:thread-tools.move]]",message:n,type:"success",timeout:config.undoTimeout,timeoutfn:function(){s(i)},clickfn:function(h,D){delete D.timeoutfn,p.success("[[topic:topic-move-undone]]")}});s(i)}}function s(t){v.fire("action:topic.move",t),t.tids?t.tids.forEach(n=>{f.put(`/topics/${n}/move`,{cid:t.cid}).then(()=>{typeof t.onComplete=="function"&&t.onComplete()}).catch(p.error)}):socket.emit("topics.moveAll",t,function(n){if(n)return p.error(n);typeof t.onComplete=="function"&&t.onComplete()})}function c(){e&&(e.remove(),e=null)}return o}).apply(C,g),m!==void 0&&(A.exports=m)},49897(A,C,l){l.r(C),l.d(C,{del:()=>s,get:()=>e,head:()=>a,patch:()=>r,post:()=>d,put:()=>u});var g=l(91749),m=l.n(g),E=l(33530),p=l.n(E);const v=config.relative_path+"/api/v3";async function f(c,t){if(c.url=c.url.startsWith("/api")?config.relative_path+c.url:v+c.url,typeof t=="function"){o(c).then(n=>t(null,n),n=>t(n));return}try{return await o(c)}catch(n){if(n.message==="A valid login session was not found. Please log in and try again."){const{url:i}=await(0,g.fire)("filter:admin.reauth",{url:"login"});return(0,E.confirm)("[[error:api.reauth-required]]",h=>{h&&ajaxify.go(i)})}throw n}}async function o(c){const{url:t}=c;delete c.url,c.data&&!(c.data instanceof FormData)&&(c.data=JSON.stringify(c.data||{}),c.headers["content-type"]="application/json; charset=utf-8"),{options:c}=await(0,g.fire)("filter:api.options",{options:c}),c.data&&(c.body=c.data,delete c.data);const n=await fetch(t,c),{headers:i}=n;if(i.get("x-redirect"))return o({url:i.get("x-redirect"),...c});const h=i.get("content-type"),D=h&&h.startsWith("application/json");let y;if(c.method!=="HEAD"&&(D?y=await n.json():y=await n.text()),!n.ok)throw y?new Error(D?y.status.message:y):new Error(n.statusText);return D&&y&&y.hasOwnProperty("status")&&y.hasOwnProperty("response")?y.response:y}function e(c,t,n){return f({url:c+(t&&Object.keys(t).length?"?"+$.param(t):"")},n)}function a(c,t,n){return f({url:c+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},n)}function d(c,t,n){return f({url:c,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function r(c,t,n){return f({url:c,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function u(c,t,n){return f({url:c,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function s(c,t,n){return f({url:c,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}},65348(A,C,l){var g,m;g=[l(96349),l(33530),l(91749),l(17459)],m=(function(E,p,v,f){const o={};return o.init=function(e,a){if(!e||!e.length)return;a=a||{};const d=a.onSelect||function(){};a.states=a.states||["watching","tracking","notwatching","ignoring"],a.template=a.template||"partials/category/selector-dropdown-left",v.fire("action:category.selector.options",{el:e,options:a}),E.init(e,a);const r={el:e,selectedCategory:null};e.on("click","[data-cid]",function(){const s=$(this);return s.hasClass("disabled")?!1:(r.selectCategory(s.attr("data-cid")),d(r.selectedCategory))});let u=r.el.find('[component="category-selector-selected"]').html();return f.translate(u,s=>{u=s}),r.selectCategory=function(s){const c=r.el.find('[data-cid="'+s+'"]');r.selectedCategory={cid:s,name:c.attr("data-name")},c.length?r.el.find('[component="category-selector-selected"]').html(c.find('[component="category-markup"]').html()):r.el.find('[component="category-selector-selected"]').html(u)},r.getSelectedCategory=function(){return r.selectedCategory},r.getSelectedCid=function(){return r.selectedCategory?r.selectedCategory.cid:0},a.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(a.template,{selectedCategory:a.selectedCategory},function(s){r.el.find('[component="category-selector-selected"]').html(s.find('[component="category-selector-selected"]').html())}),r},o.modal=function(e){e=e||{},e.onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},function(a){const d=p.dialog({title:e.title||"[[modules:composer.select-category]]",message:a,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:u}}}),r=o.init(d.find('[component="category-selector"]'),e);function u(s){return s.preventDefault(),r.selectedCategory&&(e.onSubmit(r.selectedCategory),d.modal("hide")),!1}e.openOnLoad&&d.on("shown.bs.modal",function(){d.find(".dropdown-toggle").dropdown("toggle")}),d.find("form").on("submit",u)})},o}).apply(C,g),m!==void 0&&(A.exports=m)},96349(A,C,l){var g,m;g=[l(29930),l(89336),l(49897)],m=(function(E,p,v){const f={};return f.init=function(o,e){let a=e.defaultCategories||null;e=e||{},e.privilege=e.privilege||"topics:read",e.states=e.states||["watching","tracking","notwatching","ignoring"],e.cacheList=e.hasOwnProperty("cacheList")?e.cacheList:!0;let d=[];Array.isArray(e.localCategories)&&(d=e.localCategories.map(t=>({...t})),a&&(a=[...d,...a])),e.selectedCids=e.selectedCids||ajaxify.data.selectedCids||[];const r=o.find('[component="category-selector-search"]');if(!r.length)return;const u=r.parents('[component="category/dropdown"]').length>0||r.parents('[component="category-selector"]').length>0;o.on("show.bs.dropdown",function(){u&&r.removeClass("hidden");function t(){const n=r.find("input").val();n.length>1||!n&&!a?s(n,function(i){a=e.cacheList&&(a||i),c(i)}):!n&&a&&c(a)}r.on("click",function(n){n.preventDefault(),n.stopPropagation()}),r.find("input").val("").on("keyup",utils.debounce(t,300)),t()}),o.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||r.find("input").focus()}),o.on("hide.bs.dropdown",function(){u&&r.addClass("hidden"),r.off("click"),r.find("input").off("keyup")});function s(t,n){v.get("/search/categories",{search:t,query:utils.params(),parentCid:e.parentCid||0,selectedCids:e.selectedCids,privilege:e.privilege,states:e.states,showLinks:e.showLinks,localOnly:e.localOnly,hideUncategorized:e.hideUncategorized},function(i,{categories:h}){if(i)return E.error(i);n(d.concat(h))})}function c(t){const n=e.selectedCids.map(String);t.forEach(function(i){i.selected=n.includes(String(i.cid))}),app.parseAndTranslate(e.template,{categoryItems:t.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl,hideAll:e.hideAll},function(i){o.find('[component="category/list"]').html(i.find('[component="category/list"]').html()),o.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!t.length);const h=p.Dropdown.getInstance(o.find(".dropdown-toggle").get(0));h&&h.update()})}},f}).apply(C,g),m!==void 0&&(A.exports=m)}}]);
