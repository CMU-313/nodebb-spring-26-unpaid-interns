"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[25285,27810,33085,34405,98088],{22148(M,N,e){var S,b;S=[e(22410),e(60984),e(8454),e(57642),e(47536),e(96352),e(43349),e(95692),e(52473),e(68636),e(91749),e(49897),e(29930),e(33530),e(57576)],b=(function(A,v,d,h,u,o,p,E,s,r,a,f,y,k,w){const x={};let m="0",T="";$(window).on("action:ajaxify.start",function(i,c){h.removeListeners(),String(c.url).startsWith("topic/")||(o.disable(),s.get("navbar/title").find("span").text("").hide(),y.remove("bookmark"))}),x.init=async function(){const i=m==="0"||String(m)!==String(ajaxify.data.tid);m=String(ajaxify.data.tid),T=ajaxify.currentPage,a.fire("action:topic.loading"),app.enterRoom("topic_"+m),i&&(u.signaturesShown={}),await u.onTopicPageLoad(s.get("post")),o.init('[component="topic"]>[component="post"]',ajaxify.data.postcount,x.toTop,x.toBottom,x.navigatorCallback),d.init(m),v.init(m,$(".topic")),h.init(),p.handleSort("topicPostSort","topic/"+ajaxify.data.slug),config.usePagination||A.init($('[component="topic"]'),u.loadMorePosts),t(),g(),I(),B(),F(),Y(),W(m),L(),Q(),$(window).on("scroll",utils.debounce(P,250)),H(),a.fire("action:topic.loaded",ajaxify.data)};function H(){Promise.resolve().then(function(){var i=[e(6411)];(c=>{config.topicSearchEnabled&&e.e(69749).then(function(){var n=[e(69749)];(function(l){c.bind(["command+f","ctrl+f"],function(C){C.preventDefault();let R=$('[component="navbar"] [component="search/form"]');R.length||(R=$('[component="sidebar/right"] [component="search/form"]')),R.find('[component="search/fields"] input[name="query"]').val("in:topic-"+ajaxify.data.tid+" "),l.showAndFocusInput(R)}),a.onPage("action:ajaxify.cleanup",()=>{c.unbind(["command+f","ctrl+f"])})}).apply(null,n)}).catch(e.oe),c.bind("j",n=>{if(n.target.classList.contains("mousetrap"))return;const l=o.getIndex(),C=o.getCount();l!==C&&o.scrollToIndex(l,!0,0)}),c.bind("k",n=>{if(n.target.classList.contains("mousetrap"))return;const l=o.getIndex();l!==1&&o.scrollToIndex(l-2,!0,0)})}).apply(null,i)}).catch(e.oe)}x.toTop=function(){o.scrollTop(0)},x.toBottom=function(){socket.emit("topics.postcount",ajaxify.data.tid,function(i,c){if(i)return y.error(i);o.scrollBottom(c-1)})};function W(i){if(window.location.hash){const l=$(utils.escapeHTML(window.location.hash));if(l.length){const C=l.parents("[data-pid]");return o.scrollToElement(C,!0,0)}}const c=ajaxify.data.bookmark||r.getItem("topic:"+i+":bookmark"),n=ajaxify.data.postIndex;if(D(n),o.shouldScrollToPost(n))return o.scrollToPostIndex(n-1,!0,0);c&&(!config.usePagination||config.usePagination&&ajaxify.data.pagination.currentPage===1)&&ajaxify.data.postcount>ajaxify.data.bookmarkThreshold&&y.alert({alert_id:"bookmark",message:"[[topic:bookmark-instructions]]",timeout:15e3,type:"info",clickfn:function(){o.scrollToIndex(Math.max(0,parseInt(c,10)-1),!0)},closefn:function(){r.removeItem("topic:"+i+":bookmark")}})}function L(){const i=document.querySelector('[component="topic/thumb/list"]');i&&(i.addEventListener("click",async c=>{const n=c.target.closest("a");if(n){const l=Array.from(n.parentNode.children).indexOf(n);c.stopPropagation(),c.preventDefault();const C=ajaxify.data.thumbs.map(j=>({...j}));C.forEach((j,K)=>{j.selected=K===l});const R=await app.parseAndTranslate("modals/topic-thumbs-view",{src:n.href,thumbs:C});k.dialog({size:"lg",onEscape:!0,backdrop:!0,message:R}).on("click",'[component="topic/thumb/select"]',function(){$('[component="topic/thumb/select"]').removeClass("border-primary"),$(this).addClass("border-primary"),$('[component="topic/thumb/current"]').attr("src",$(this).find("img").attr("src"))})}}),$('[component="topic/thumb/list/expand"]').on("click",function(){const c=$(this);c.parents('[component="topic/thumb/list"]').removeClass("thumbs-collapsed"),c.remove()}))}function t(){s.get("topic").on("click","blockquote .toggle",function(){const i=$(this).parent("blockquote"),c=$(this);i.toggleClass("uncollapsed");const n=!i.hasClass("uncollapsed");c.toggleClass("fa-angle-down",n).toggleClass("fa-angle-up",!n)})}function g(){new w('[component="copy/code/btn"]',{text:function(c){const n=$(c);n.find("i").removeClass("fa-copy").addClass("fa-check"),setTimeout(()=>n.find("i").removeClass("fa-check").addClass("fa-copy"),2e3);const l=n.parent().find("code");return l.attr("data-lines")&&l.find(".hljs-ln-code[data-line-number]").length?l.find(".hljs-ln-code[data-line-number]").map((C,R)=>R.textContent).get().join(`
`):l.text()}});function i(){function c(j){return j.scrollHeight>j.clientHeight}function n(j){if(j.length){if(!j[0].scrollHeight)return setTimeout(n,100,j);c(j.get(0))&&j.parent().parent().find('[component="copy/code/btn"]').css({margin:"0.5rem 1.5rem 0 0"})}}let l=$('[component="topic"] [component="post/content"] code:not([data-button-added])');l=l.filter((j,K)=>$(K).text().includes(`
`));const C=$('<div class="hover-parent position-relative"></div>'),R=$('<button component="copy/code/btn" class="hover-visible position-absolute top-0 btn btn-sm btn-outline-secondary" style="right: 0px; margin: 0.5rem 0.5rem 0 0;"><i class="fa fa-fw fa-copy"></i></button>'),U=l.parent();U.wrap(C).parent().append(R),U.parent().find('[component="copy/code/btn"]').translateAttr("title","[[topic:copy-code]]"),U.each((j,K)=>{n($(K).find("code"))}),l.attr("data-button-added",1)}a.registerPage("action:posts.loaded",i),a.registerPage("action:topic.loaded",i),a.registerPage("action:posts.edited",i)}function I(){function i(c,n){const l=$('[component="topic"]>[component="post"][data-pid="'+n+'"]');if(l.length)return c.preventDefault(),o.scrollToIndex(l.attr("data-index"),!0),!1}s.get("topic").on("click",'[component="post/parent"]',function(c){const n=$(this),l=n.find('[component="post/parent/content"]');if(l.length){const C=n.attr("data-collapsed")==="true";if(n.attr("data-collapsed",C?"false":"true"),l.toggleClass("line-clamp-1"),n.find(".timeago").toggleClass("hidden"),n.toggleClass("flex-column").toggleClass("flex-row"),C)return!1}else return i(c,n.attr("data-topid"))}),s.get("topic").on("click",'[component="post/parent"] .timeago',function(c){return i(c,$(this).parents("[data-parent-pid]").attr("data-parent-pid"))})}function B(){$('[component="topic"]').on("click",'[component="post/reply-count"]',function(){const i=$(this);e.e(18631).then(function(){var c=[e(18631)];(function(n){n.init(i)}).apply(null,c)}).catch(e.oe)})}function F(){if(!ajaxify.data.showPostPreviewsOnHover||utils.isMobile())return;let i=0,c=!1,n=null;const l={};function C(){clearTimeout(i),i=0,$("#post-tooltip").remove(),c=!0}function R(U){$(U.target).closest("#post-tooltip").length||C()}$(window).one("action:ajaxify.start",C),$('[component="topic"]').on("mouseenter",'a[component="post/parent"], [component="post/parent/content"] a,[component="post/content"] a, [component="topic/event"] a',async function(){n=$(this),n.removeAttr("over-tooltip"),n.one("mouseleave",function(){clearTimeout(i),i=0,setTimeout(()=>{!n.attr("over-tooltip")&&!i&&C()},100)}),clearTimeout(i),c=!1,i=setTimeout(async()=>{async function U(O){const z=l[O]||await f.get(`/posts/${encodeURIComponent(O)}/summary`);if($("#post-tooltip").remove(),z&&ajaxify.data.template.topic){l[O]=z;const J=await app.parseAndTranslate("partials/topic/post-preview",{post:z});if(c)return;J.hide().find(".timeago").timeago(),J.appendTo($("body")).fadeIn(300);const tt=n.parents('[component="topic"]').find('[component="post/content"]').first(),ot=tt.offset(),et=tt.width(),{top:X}=n.get(0).getBoundingClientRect(),nt=X>window.innerHeight/2;J.on("mouseenter",function(){n.attr("over-tooltip",1)}),J.one("mouseleave",C),$(window).off("click",R).one("click",R);const G={left:ot.left,width:et};nt?G.bottom=window.innerHeight-X-window.scrollY+5:G.top=X+window.scrollY+30,J.css(G)}}const j=n.attr("href"),K=utils.urlToLocation(j),V=K.pathname,Z=j&&j!=="#"&&window.location.hostname===K.hostname;$("#post-tooltip").remove();const q=Z&&V&&V.match(/\/post\/([\d]+|(?:[\w_.~!$&'()*+,;=:@-]|%[\dA-F]{2})+)/),_=Z&&V&&V.match(/\/topic\/([\da-z-]+)/);if(q){const O=q[1];if(encodeURIComponent(n.parents('[component="post"]').attr("data-pid"))===encodeURIComponent(O))return;U(O)}else if(_){const O=_[1],z=await f.get("/topics/"+O,{});U(z.mainPid)}},300)})}function Q(){const i=document.getElementById("show-crossposts");i&&i.addEventListener("click",async()=>{const{crossposts:c}=ajaxify.data,n=await app.parseAndTranslate("modals/crossposts",{crossposts:c});k.dialog({onEscape:!0,backdrop:!0,title:"[[global:crossposts]]",message:n})})}function Y(){(config.enableQuickReply||config.theme&&config.theme.enableQuickReply)&&E.init()}function P(){const i=s.get("navbar/title").find("span");$(window).scrollTop()>50&&i.hasClass("hidden")?i.html(ajaxify.data.title).removeClass("hidden"):$(window).scrollTop()<=50&&!i.hasClass("hidden")&&i.html("").addClass("hidden"),$(window).scrollTop()>300&&y.remove("bookmark")}x.navigatorCallback=function(i,c){if(!ajaxify.data.template.topic||o.scrollActive)return;const n="topic/"+ajaxify.data.slug+(i>1?"/"+i:"");if(n!==T&&(T=n,i>=c&&app.user.uid&&f.put(`/topics/${ajaxify.data.tid}/read`),D(i),ajaxify.data.updateUrlWithPostIndex&&history.replaceState)){let l=window.location.search||"";config.usePagination||(l=l&&!/^\?page=\d+$/.test(l)?l:""),history.replaceState({url:n+l},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+n+l)}};function D(i){const c="topic:"+ajaxify.data.tid+":bookmark",n=ajaxify.data.bookmark||r.getItem(c);config.topicPostSort==="newest_to_oldest"&&(i=Math.max(1,ajaxify.data.postcount-i+2)),ajaxify.data.postcount>ajaxify.data.bookmarkThreshold&&(!n||parseInt(i,10)>parseInt(n,10)||ajaxify.data.postcount<parseInt(n,10))&&(app.user.uid?(ajaxify.data.bookmark=Math.min(i,ajaxify.data.postcount),socket.emit("topics.bookmark",{tid:ajaxify.data.tid,index:ajaxify.data.bookmark},function(l){if(l)return ajaxify.data.bookmark=n,y.error(l)})):r.setItem(c,i)),(!n||parseInt(i,10)>=parseInt(n,10))&&y.remove("bookmark")}return x}).apply(N,S),b!==void 0&&(M.exports=b)},34405(M,N,e){var S,b;S=[e(49897),e(29930),e(36e3),e(9787),e(35786)],b=(function(A,v,{Textcomplete:d},{TextareaEditor:h},{ContenteditableEditor:u}){const o={},p={delay:200,appendTo:null};o.init=s=>{const r={...p,...s},{input:a,onSelect:f}=r;app.loadJQueryUI(function(){a.autocomplete({...r,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(y,k){E(a,f,y,k)}})})},o.user=function(s,r,a){typeof r=="function"&&(a=r,r={}),r=r||{},o.init({input:s,onSelect:a,source:(f,y)=>{r.query=f.term,A.get("/api/users",r,function(k,w){if(k)return v.error(k);if(w&&w.users){const x=w.users.map(function(m){const T=$("<div></div>").html(m.username).text();return m&&{label:T,value:T,user:{uid:m.uid,name:m.username,slug:m.userslug,username:m.username,userslug:m.userslug,displayname:m.displayname,picture:m.picture,banned:m.banned,"icon:text":m["icon:text"],"icon:bgColor":m["icon:bgColor"]}}});y(x)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},o.group=function(s,r){o.init({input:s,onSelect:r,source:(a,f)=>{socket.emit("groups.search",{query:a.term},function(y,k){if(y)return v.error(y);if(k&&k.length){const w=k.map(function(x){return x&&{label:x.name,value:x.name,group:x}});f(w)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},o.tag=function(s,r){o.init({input:s,onSelect:r,delay:100,source:(a,f)=>{socket.emit("topics.autocompleteTags",{query:a.term,cid:ajaxify.data.cid||0},function(y,k){if(y)return v.error(y);k&&f(k),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function E(s,r,a,f){r=r||function(){};const y=jQuery.Event("keypress");y.which=13,y.keyCode=13,setTimeout(function(){s.trigger(y)},100),r(a,f)}return o.setup=function({element:s,strategies:r,options:a}){const f=s.get(0);if(f){var y;if(f.nodeName==="TEXTAREA"||f.nodeName==="INPUT"?y=new h(f):f.nodeName==="DIV"&&f.getAttribute("contenteditable")==="true"&&(y=new u(f)),!y)throw new Error("unknown target element type");f.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var k=new d(y,r,{dropdown:a});return k.on("rendered",function(){k.dropdown.items.length&&k.dropdown.items[0].activate()}),k}},o}).apply(N,S),b!==void 0&&(M.exports=b)},43103(M,N,e){var S,b;S=[e(29930)],b=(function(A){const v={};return v.init=function(d){const h=d.uploadFormEl;if(h.length&&(h.attr("action",config.relative_path+d.route),d.dragDropAreaEl&&v.handleDragDrop({container:d.dragDropAreaEl,callback:function(u){v.ajaxSubmit({uploadForm:h,upload:u,callback:d.callback})}}),d.pasteEl&&v.handlePaste({container:d.pasteEl,callback:function(u){v.ajaxSubmit({uploadForm:h,upload:u,callback:d.callback})}}),d.uploadBtnEl)){const u=h.find('input[name="files[]"]');d.uploadBtnEl.on("click",function(){return u.trigger("click"),!1}),u.on("change",function(o){const p=(o.target||{}).files||($(this).val()?[{name:$(this).val(),type:utils.fileMimeType($(this).val())}]:null);p&&v.ajaxSubmit({uploadForm:h,upload:{files:p,fileNames:Array.from(p).map(E=>E.name)},callback:d.callback})})}},v.handleDragDrop=function(d){let h=!1;const u=d.container,o=d.container.find(".imagedrop");u.on("dragenter",function(){h||(o.css("top","0px"),o.css("height",u.height()+"px"),o.css("line-height",u.height()+"px"),o.show(),o.on("dragleave",function(){o.hide(),o.off("dragleave")}))}),o.on("drop",function(s){s.preventDefault();const r=s.originalEvent.dataTransfer.files;if(r.length){let f;if(window.FormData){f=new FormData;for(var a=0;a<r.length;++a)f.append("files[]",r[a],r[a].name)}d.callback({files:r,formData:f})}return o.hide(),!1});function p(E){return E.preventDefault(),!1}$(document).off("dragstart").on("dragstart",function(){h=!0}).off("dragend").on("dragend, mouseup",function(){h=!1}),o.on("dragover",p),o.on("dragenter",p)},v.handlePaste=function(d){d.container.on("paste",function(u){const o=(u.clipboardData||u.originalEvent.clipboardData||{}).items,p=[],E=[];let s=null;window.FormData&&(s=new FormData),[].forEach.call(o,function(r){const a=r.getAsFile();if(a){const f=utils.generateUUID()+"-"+a.name;s&&s.append("files[]",a,f),p.push(a),E.push(f)}}),p.length&&d.callback({files:p,fileNames:E,formData:s})})},v.ajaxSubmit=function(d){const h=[...d.upload.files];for(let o=0;o<h.length;++o){const p=h[o].type.match(/image./);if(p&&!app.user.privileges["upload:post:image"]||!p&&!app.user.privileges["upload:post:file"])return A.error("[[error:no-privileges]]");if(!app.user.isAdmin&&h[o].size>parseInt(config.maximumFileSize,10)*1024)return d.uploadForm[0].reset(),A.error("[[error:file-too-big, "+config.maximumFileSize+"]]")}const u=Date.now();d.uploadForm.off("submit").on("submit",function(){return $(this).ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},resetForm:!0,clearForm:!0,formData:d.upload.formData,error:function(o){let p=o.responseJSON&&(o.responseJSON.error||o.responseJSON.status&&o.responseJSON.status.message)||"[[error:parse-error]]";o&&o.status===413&&(p=o.statusText||"Request Entity Too Large"),A.error(p),A.remove(u)},uploadProgress:function(o,p,E,s){A.alert({alert_id:u,message:"[[modules:composer.uploading, "+s+"%]]"})},success:function(o){const p=o.response.images;if(p&&p.length)for(var E=0;E<p.length;++E)p[E].filename=h[E].name,p[E].isImage=/image./.test(h[E].type);d.callback(p)},complete:function(){d.uploadForm[0].reset(),setTimeout(A.remove,100,u)}}),!1}),d.uploadForm.submit()},v}).apply(N,S),b!==void 0&&(M.exports=b)},43349(M,N,e){var S,b;S=[e(52473)],b=(function(A){const v={};return v.handleSort=function(d,h){const u=A.get("thread/sort");u.find("i").removeClass("fa-check");const o=utils.params().sort||config[d];u.find('a[data-sort="'+o+'"]').find("i").addClass("fa-check"),$("body").off("click",'[component="thread/sort"] a[data-sort]').on("click",'[component="thread/sort"] a[data-sort]',function(){const E=$(this).attr("data-sort"),s=utils.params();s.sort=E;const r=$.param(s);ajaxify.go(h+(r?"?"+r:""))})},v}).apply(N,S),b!==void 0&&(M.exports=b)},57642(M,N,e){var S,b;S=[e(8454),e(60984),e(47536),e(2269),e(52473),e(17459),e(91749),e(30076)],b=(function(A,v,d,h,u,o,p,E){const s={},r={"event:user_status_change":a,"event:voted":f,"event:bookmarked":y,"event:topic_deleted":v.setDeleteState,"event:topic_restored":v.setDeleteState,"event:topic_purged":k,"event:topic_locked":v.setLockedState,"event:topic_unlocked":v.setLockedState,"event:topic_pinned":v.setPinnedState,"event:topic_unpinned":v.setPinnedState,"event:topic_moved":w,"event:post_edited":x,"event:post_purged":m,"event:post_deleted":T,"event:post_restored":T,"posts.bookmark":H,"posts.unbookmark":H,"posts.upvote":W,"posts.downvote":W,"posts.unvote":W,"event:new_notification":L,"event:new_post":d.onNewPost};s.init=function(){s.removeListeners();for(const[t,g]of Object.entries(r))socket.on(t,g)},s.removeListeners=function(){for(const[t,g]of Object.entries(r))socket.removeListener(t,g)};function a(t){app.updateUserStatus($('[data-uid="'+t.uid+'"] [component="user/status"]'),t.status)}function f(t){const g=$('[data-pid="'+t.post.pid+'"] [component="post/vote-count"]').filter(function(B,F){return $(F).closest("[data-pid]").attr("data-pid")===String(t.post.pid)}),I=$('.reputation[data-uid="'+t.post.uid+'"]');g.html(t.post.votes).attr("data-votes",t.post.votes),I.html(t.user.reputation).attr("data-reputation",t.user.reputation)}function y(t){$('[data-pid="'+t.post.pid+'"] .bookmarkCount').filter(function(g,I){return $(I).closest("[data-pid]").attr("data-pid")===String(t.post.pid)}).html(t.post.bookmarks).attr("data-bookmarks",t.post.bookmarks)}function k(t){ajaxify.data.category&&ajaxify.data.category.slug&&String(t.tid)===String(ajaxify.data.tid)&&ajaxify.go("category/"+ajaxify.data.category.slug,null,!0)}function w(t){t&&t.slug&&String(t.tid)===String(ajaxify.data.tid)&&ajaxify.go("topic/"+t.slug,null,!0)}function x(t){if(!t||!t.post||String(t.post.tid)!==String(ajaxify.data.tid))return;const g=u.get("post/content",t.post.pid).filter(function(P,D){return String($(D).closest("[data-pid]").attr("data-pid"))===String(t.post.pid)}),I=$(`[data-pid="${t.post.pid}"]`),B=I.find('[component="post/editor"]').filter(function(P,D){return String($(D).closest("[data-pid]").attr("data-pid"))===String(t.post.pid)}),F=u.get("topic/title"),Q=u.get("navbar/title").find("span"),Y=u.get("breadcrumb/current");if(t.topic.rescheduled)return ajaxify.go("topic/"+t.topic.slug,null,!0);if(F.length&&t.topic.title&&t.topic.renamed){ajaxify.data.title=t.topic.title;const P="topic/"+t.topic.slug+(window.location.search?window.location.search:"");history.replaceState({url:P},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+P),F.fadeOut(250,function(){F.html(t.topic.title).fadeIn(250)}),Y.fadeOut(250,function(){Y.html(t.topic.title).fadeIn(250)}),Q.fadeOut(250,function(){Q.html(t.topic.title).fadeIn(250)})}if(t.post.changed){g.fadeOut(250,function(){if(g.html(o.unescape(t.post.content)),g.find("img:not(.not-responsive)").addClass("img-fluid"),h.wrapImagesInLinks(g.parent()),d.addBlockquoteEllipses(g.parent()),g.fadeIn(250),t.post.edited){const D={editor:t.editor,editedISO:utils.toISOString(t.post.edited)};app.parseAndTranslate("partials/topic/post-editor",D,function(i){B.replaceWith(i),I.find('[component="post/edit-indicator"]').removeClass("hidden").translateAttr("title",`[[global:edited-timestamp, ${E.isoTimeToLocaleString(D.editedISO,config.userLang)}]]`),I.find('[component="post/editor"] .timeago').timeago(),p.fire("action:posts.edited",t)})}});const P=$(`[component="post/parent"][data-parent-pid="${t.post.pid}"]`);P.length&&(P.find('[component="post/parent/content"]').html(o.unescape(t.post.content)),P.find("img:not(.not-responsive)").addClass("img-fluid"),P.find('[component="post/parent/content"] img:not(.emoji)').each(function(){h.wrapImageInLink($(this))}))}else p.fire("action:posts.edited",t);t.topic.tags&&t.topic.tagsupdated&&Promise.all([e.e(20056),e.e(63)]).then(function(){var P=[e(63)];(function(D){D.updateTopicTags([t.topic])}).apply(null,P)}).catch(e.oe),t.topic.thumbsupdated&&Promise.all([e.e(23662),e.e(65285),e.e(36159)]).then(function(){var P=[e(36159)];(function(D){D.updateTopicThumbs(t.topic.tid)}).apply(null,P)}).catch(e.oe),A.removeMenu(u.get("post","pid",t.post.pid))}function m(t){!t||String(t.tid)!==String(ajaxify.data.tid)||(u.get("post","pid",t.pid).fadeOut(500,function(){$(this).remove(),d.showBottomPostBar()}),ajaxify.data.postcount-=1,A.updatePostCount(ajaxify.data.postcount),e.e(18631).then(function(){var g=[e(18631)];(function(I){I.onPostPurged(t)}).apply(null,g)}).catch(e.oe),$(`[component="post/parent"][data-parent-pid="${t.pid}"]`).remove())}function T(t){const g=u.get("post","pid",t.pid),{isAdminOrMod:I}=ajaxify.data.privileges,B=String(t.uid)===String(app.user.uid),F=!!t.deleted;g.length&&(g.toggleClass("deleted"),A.toggle(t.pid,F),!I&&!B&&(g.find('[component="post/tools"]').toggleClass("hidden",F),F?g.find('[component="post/content"]').translateHtml("[[topic:post-is-deleted]]"):g.find('[component="post/content"]').html(o.unescape(t.content))));const Q=$(`[component="post/parent"][data-parent-pid="${t.pid}"]`);Q.length&&Q.each((Y,P)=>{const D=$(P);F?D.find('[component="post/parent/content"]').translateHtml("[[topic:post-is-deleted]]"):D.find('[component="post/parent/content"]').html(o.unescape(t.content))})}function H(t){const g=$('[data-pid="'+t.post.pid+'"] [component="post/bookmark"]').filter(function(I,B){return $(B).closest("[data-pid]").attr("data-pid")===String(t.post.pid)});g.length&&(g.attr("data-bookmarked",t.isBookmarked),g.find('[component="post/bookmark/on"]').toggleClass("hidden",!t.isBookmarked),g.find('[component="post/bookmark/off"]').toggleClass("hidden",t.isBookmarked))}function W(t){const g=$('[data-pid="'+t.post.pid+'"]');g.find('[component="post/upvote"]').filter(function(I,B){return $(B).closest("[data-pid]").attr("data-pid")===String(t.post.pid)}).toggleClass("upvoted",t.upvote),g.find('[component="post/downvote"]').filter(function(I,B){return $(B).closest("[data-pid]").attr("data-pid")===String(t.post.pid)}).toggleClass("downvoted",t.downvote)}function L(t){const g=ajaxify.data.tid;t&&t.tid&&String(t.tid)===String(g)&&socket.emit("topics.markTopicNotificationsRead",[g])}return s}).apply(N,S),b!==void 0&&(M.exports=b)},95692(M,N,e){var S,b;S=[e(52473),e(34405),e(49897),e(29930),e(43103),e(6411),e(68636),e(91749)],b=(function(A,v,d,h,u,o,p,E){const s={_autocomplete:null};s.init=function(){const a=A.get("topic/quickreply/text"),f=`qr:draft:tid:${ajaxify.data.tid}`,y={element:a,strategies:[],options:{style:{"z-index":100}}};r(),$(window).one("action:ajaxify.start",()=>{r()}),$(window).trigger("composer:autocomplete:init",y),s._autocomplete=v.setup(y),o.bind("ctrl+return",x=>{x.target===a.get(0)&&A.get("topic/quickreply/button").get(0).click()}),u.init({uploadBtnEl:$('[component="topic/quickreply/upload/button"]'),dragDropAreaEl:$('[component="topic/quickreply/container"] .quickreply-message'),pasteEl:a,uploadFormEl:$('[component="topic/quickreply/upload"]'),inputEl:a,route:"/api/post/upload",callback:function(x){let m=a.val();x.forEach(T=>{m=m+(m?`
`:"")+(T.isImage?"!":"")+`[${T.filename}](${T.url})`}),a.val(m)}});let k=!0;A.get("topic/quickreply/button").on("click",function(x){if(x.preventDefault(),!k)return;const m=a.val(),T={tid:ajaxify.data.tid,handle:void 0,content:m},H=m.length;if(H<parseInt(config.minimumPostLength,10))return h.error("[[error:content-too-short, "+config.minimumPostLength+"]]");if(H>parseInt(config.maximumPostLength,10))return h.error("[[error:content-too-long, "+config.maximumPostLength+"]]");k=!1,a.val(""),d.post(`/topics/${ajaxify.data.tid}`,T,function(W,L){if(k=!0,W)return a.val(m),h.error(W);L&&L.queued&&h.alert({type:"success",title:"[[global:alert.success]]",message:L.message,timeout:1e4,clickfn:function(){ajaxify.go(`/post-queue/${L.id}`)}}),a.val(""),p.removeItem(f),s._autocomplete.hide(),E.fire("action:quickreply.success",{data:L})})});const w=p.getItem(f);w&&a.val(w),a.on("keyup",utils.debounce(function(){const x=a.val();x?p.setItem(f,x):p.removeItem(f)},1e3)),A.get("topic/quickreply/expand").on("click",x=>{x.preventDefault(),p.removeItem(f);const m=A.get("topic/quickreply/text");E.fire("action:composer.post.new",{tid:ajaxify.data.tid,title:ajaxify.data.titleRaw,body:m.val()}),m.val("")})};function r(){s._autocomplete&&(s._autocomplete.destroy(),s._autocomplete=null)}return s}).apply(N,S),b!==void 0&&(M.exports=b)}}]);
