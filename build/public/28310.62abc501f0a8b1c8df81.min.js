"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[28310],{28310(y,h,d){var u,r;u=[d(65348),d(29930),d(91749),d(49897)],r=(function(C,g,v,p){const n={};let e,c;n.init=function(o,i,a){e||(n.tids=o,n.currentCid=i,n.onComplete=a,n.moveAll=!o,s())};function s(){app.parseAndTranslate("modals/move-topic",{},function(o){e=o,$("body").append(e),(n.moveAll||n.tids&&n.tids.length>1)&&e.find(".card-header").translateText("[[topic:move-topics]]");const i=e.find('[component="category-selector"]');i.addClass("dropup"),C.init(i,{onSelect:t,privilege:"moderate",localOnly:!0}),e.find("#move_thread_commit").on("click",f),e.find("#move_topic_cancel").on("click",m)})}function t(o){c=o,e.find("#move_thread_commit").prop("disabled",!1)}function f(){const o=e.find("#move_thread_commit");if(!o.prop("disabled")&&c&&c.cid){o.prop("disabled",!0),m();let i="[[topic:topic-move-success, "+c.name+"]]";n.tids&&n.tids.length>1?i="[[topic:topic-move-multiple-success, "+c.name+"]]":n.tids||(i="[[topic:topic-move-all-success, "+c.name+"]]");const a={tids:n.tids?n.tids.slice():null,cid:c.cid,currentCid:n.currentCid,onComplete:n.onComplete};if(config.undoTimeout>0)return g.alert({alert_id:"tids_move_"+(n.tids?n.tids.join("-"):"all"),title:"[[topic:thread-tools.move]]",message:i,type:"success",timeout:config.undoTimeout,timeoutfn:function(){l(a)},clickfn:function(A,E){delete E.timeoutfn,g.success("[[topic:topic-move-undone]]")}});l(a)}}function l(o){v.fire("action:topic.move",o),o.tids?o.tids.forEach(i=>{p.put(`/topics/${i}/move`,{cid:o.cid}).then(()=>{typeof o.onComplete=="function"&&o.onComplete()}).catch(g.error)}):socket.emit("topics.moveAll",o,function(i){if(i)return g.error(i);typeof o.onComplete=="function"&&o.onComplete()})}function m(){e&&(e.remove(),e=null)}return n}).apply(h,u),r!==void 0&&(y.exports=r)},65348(y,h,d){var u,r;u=[d(96349),d(33530),d(91749),d(17459)],r=(function(C,g,v,p){const n={};return n.init=function(e,c){if(!e||!e.length)return;c=c||{};const s=c.onSelect||function(){};c.states=c.states||["watching","tracking","notwatching","ignoring"],c.template=c.template||"partials/category/selector-dropdown-left",v.fire("action:category.selector.options",{el:e,options:c}),C.init(e,c);const t={el:e,selectedCategory:null};e.on("click","[data-cid]",function(){const l=$(this);return l.hasClass("disabled")?!1:(t.selectCategory(l.attr("data-cid")),s(t.selectedCategory))});let f=t.el.find('[component="category-selector-selected"]').html();return p.translate(f,l=>{f=l}),t.selectCategory=function(l){const m=t.el.find('[data-cid="'+l+'"]');t.selectedCategory={cid:l,name:m.attr("data-name")},m.length?t.el.find('[component="category-selector-selected"]').html(m.find('[component="category-markup"]').html()):t.el.find('[component="category-selector-selected"]').html(f)},t.getSelectedCategory=function(){return t.selectedCategory},t.getSelectedCid=function(){return t.selectedCategory?t.selectedCategory.cid:0},c.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(c.template,{selectedCategory:c.selectedCategory},function(l){t.el.find('[component="category-selector-selected"]').html(l.find('[component="category-selector-selected"]').html())}),t},n.modal=function(e){e=e||{},e.onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},function(c){const s=g.dialog({title:e.title||"[[modules:composer.select-category]]",message:c,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:f}}}),t=n.init(s.find('[component="category-selector"]'),e);function f(l){return l.preventDefault(),t.selectedCategory&&(e.onSubmit(t.selectedCategory),s.modal("hide")),!1}e.openOnLoad&&s.on("shown.bs.modal",function(){s.find(".dropdown-toggle").dropdown("toggle")}),s.find("form").on("submit",f)})},n}).apply(h,u),r!==void 0&&(y.exports=r)},96349(y,h,d){var u,r;u=[d(29930),d(89336),d(49897)],r=(function(C,g,v){const p={};return p.init=function(n,e){let c=e.defaultCategories||null;e=e||{},e.privilege=e.privilege||"topics:read",e.states=e.states||["watching","tracking","notwatching","ignoring"],e.cacheList=e.hasOwnProperty("cacheList")?e.cacheList:!0;let s=[];Array.isArray(e.localCategories)&&(s=e.localCategories.map(o=>({...o})),c&&(c=[...s,...c])),e.selectedCids=e.selectedCids||ajaxify.data.selectedCids||[];const t=n.find('[component="category-selector-search"]');if(!t.length)return;const f=t.parents('[component="category/dropdown"]').length>0||t.parents('[component="category-selector"]').length>0;n.on("show.bs.dropdown",function(){f&&t.removeClass("hidden");function o(){const i=t.find("input").val();i.length>1||!i&&!c?l(i,function(a){c=e.cacheList&&(c||a),m(a)}):!i&&c&&m(c)}t.on("click",function(i){i.preventDefault(),i.stopPropagation()}),t.find("input").val("").on("keyup",utils.debounce(o,300)),o()}),n.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||t.find("input").focus()}),n.on("hide.bs.dropdown",function(){f&&t.addClass("hidden"),t.off("click"),t.find("input").off("keyup")});function l(o,i){v.get("/search/categories",{search:o,query:utils.params(),parentCid:e.parentCid||0,selectedCids:e.selectedCids,privilege:e.privilege,states:e.states,showLinks:e.showLinks,localOnly:e.localOnly,hideUncategorized:e.hideUncategorized},function(a,{categories:A}){if(a)return C.error(a);i(s.concat(A))})}function m(o){const i=e.selectedCids.map(String);o.forEach(function(a){a.selected=i.includes(String(a.cid))}),app.parseAndTranslate(e.template,{categoryItems:o.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl,hideAll:e.hideAll},function(a){n.find('[component="category/list"]').html(a.find('[component="category/list"]').html()),n.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!o.length);const A=g.Dropdown.getInstance(n.find(".dropdown-toggle").get(0));A&&A.update()})}},p}).apply(h,u),r!==void 0&&(y.exports=r)}}]);
