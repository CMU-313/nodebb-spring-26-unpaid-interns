(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[61324],{61324(m,L,v){"use strict";v.r(L),v.d(L,{buildAliasMap:()=>E,capturePaste:()=>I,enhanceCheckbox:()=>x,highlight:()=>A,markExternalLinks:()=>M,prepareFormattingTools:()=>w});function I(s){s.on("paste",function(a){var c=[/^>\s*/,/^\s*\*\s+/,/^\s*\d+\.\s+/,/^\s{4,}/],u=a.target.selectionStart,p=o(s.val(),u),n=c.reduce(function(f,N){return f||(N.test(p)?N:!1)},!1),i=p.match(n);if(i){i=i.shift();var r=a.originalEvent.clipboardData.getData("text"),d=r.replace(/^/gm,i).slice(i.length);setTimeout(function(){var f=s.val().slice(0,u)+d+s.val().slice(u+r.length);s.val(f)},0)}});function o(a,c){var u=a.split(`
`);return u.reduce(function(p,n){return typeof p!="number"?p:c>p+n.length?p+n.length+1:n},0)}}function w(){Promise.all([v.e(23662),v.e(65285),v.e(449),v.e(34670)]).then(function(){var s=[v(449),v(26940),v(17459)];(function(o,a,c){o&&a&&c.getTranslations(window.config.userLang||window.config.defaultLang,"markdown",function(u){function p(n,i,r,d){if(r===d)a.insertIntoTextarea(i,`${n} ${u.heading}`),a.updateTextareaSelection(i,r+n.length+1,r+u.heading.length+n.length+1);else{const f=$(i).val().substring(r,d),N=`${n} ${f}`;a.replaceSelectionInTextareaWith(i,N),a.updateTextareaSelection(i,r+(n.length+1),d+(N.length-f.length))}}o.addButtonDispatch("bold",function(n,i,r){if(i===r){var d=a.getBlockData(n,"**",i);d.in&&d.atEnd?a.updateTextareaSelection(n,i+2,i+2):(a.insertIntoTextarea(n,"**"+u.bold+"**"),a.updateTextareaSelection(n,i+2,i+u.bold.length+2))}else{var f=a.wrapSelectionInTextareaWith(n,"**");a.updateTextareaSelection(n,i+2+f[0],r+2-f[1])}}),o.addButtonDispatch("italic",function(n,i,r){if(i===r){var d=a.getBlockData(n,"*",i);d.in&&d.atEnd?a.updateTextareaSelection(n,i+1,i+1):(a.insertIntoTextarea(n,"*"+u.italic+"*"),a.updateTextareaSelection(n,i+1,i+u.italic.length+1))}else{var f=a.wrapSelectionInTextareaWith(n,"*");a.updateTextareaSelection(n,i+1+f[0],r+1-f[1])}}),[1,2,3,4,5,6].forEach(n=>{o.addButtonDispatch(`heading${n}`,function(i,r,d){p(new Array(n).fill("#").join(""),i,r,d)})}),o.addButtonDispatch("list",function(n,i,r){if(i===r)a.insertIntoTextarea(n,`
* `+u["list-item"]),a.updateTextareaSelection(n,i+3,i+u["list-item"].length+3);else{const d=$(n).val().substring(i,r),f="* "+d.split(`
`).join(`
* `);a.replaceSelectionInTextareaWith(n,f),a.updateTextareaSelection(n,i+2,r+(f.length-d.length))}}),o.addButtonDispatch("strikethrough",function(n,i,r){if(i===r){var d=a.getBlockData(n,"~~",i);d.in&&d.atEnd?a.updateTextareaSelection(n,i+2,i+2):(a.insertIntoTextarea(n,"~~"+u["strikethrough-text"]+"~~"),a.updateTextareaSelection(n,i+2,r+u["strikethrough-text"].length+2))}else{var f=a.wrapSelectionInTextareaWith(n,"~~","~~");a.updateTextareaSelection(n,i+2+f[0],r+2-f[1])}}),o.addButtonDispatch("code",function(n,i,r){if(i===r)a.insertIntoTextarea(n,"```\n"+u["code-text"]+"\n```"),a.updateTextareaSelection(n,i+4,r+u["code-text"].length+4);else{var d=a.wrapSelectionInTextareaWith(n,"```\n","\n```");a.updateTextareaSelection(n,i+4+d[0],r+4-d[1])}}),o.addButtonDispatch("link",function(n,i,r){if(i===r)a.insertIntoTextarea(n,"["+u["link-text"]+"]("+u["link-url"]+")"),a.updateTextareaSelection(n,i+u["link-text"].length+3,r+u["link-text"].length+u["link-url"].length+3);else{var d=a.wrapSelectionInTextareaWith(n,"[","]("+u["link-url"]+")");a.updateTextareaSelection(n,r+3-d[1],r+u["link-url"].length+3-d[1])}}),o.addButtonDispatch("picture-o",function(n,i,r){if(i===r)a.insertIntoTextarea(n,"!["+u["picture-text"]+"]("+u["picture-url"]+")"),a.updateTextareaSelection(n,i+u["picture-text"].length+4,r+u["picture-text"].length+u["picture-url"].length+4);else{var d=a.wrapSelectionInTextareaWith(n,"![","]("+u["picture-url"]+")");a.updateTextareaSelection(n,r+4-d[1],r+u["picture-url"].length+4-d[1])}})})}).apply(null,s)}).catch(v.oe)}function M(){if(!config.markdown.externalMark)return;document.querySelectorAll('[component="post/content"] a').forEach(o=>{const a=o.childElementCount===1&&o.querySelector("img")&&!o.text,c=o.querySelector(".external-link-icon");if(a||c)return;let u;try{u=new URL(o.href,document.location.href)}catch{return}if(u.host!=document.location.host){const p=document.createElement("i");p.classList.add("fa","fa-external-link","small","external-link-icon"),o.append(" ",p)}})}function x(s,o){if(!(!o.posts&&!o.post)){o.hasOwnProperty("post")&&(o.posts=[o.post]);var a,c;o.posts.forEach(function(u){a=!u.display_edit_tools,c=$('.posts li[data-pid="'+u.pid+'"] .content div.plugin-markdown input[type="checkbox"]'),c.on("click",function(p){a&&p.preventDefault();var n=this,i=$(this).parents("li[data-pid]").attr("data-pid"),r=$(this).parents(".content").find('input[type="checkbox"]').toArray().reduce(function(d,f,N){return f===n&&(d=N),d},null);socket.emit("plugins.markdown.checkbox.edit",{pid:i,index:r,state:$(n).prop("checked")})})})}}function A(s){s instanceof jQuery.Event?B($(s.data.selector)):B(s)}const y=new Map;function E(){if(window.hljs){const s=window.hljs;s.listLanguages().forEach(o=>{const{aliases:a}=s.getLanguage(o);a&&Array.isArray(a)&&a.forEach(c=>{y.set(c,o)}),y.set(o,o)})}}async function B(s){if(parseInt(config.markdown.highlight,10)){if(!window.hljs){console.debug("[plugins/markdown] Tryin to highlight without initializing hljs");return}console.debug("[plugins/markdown] Loading support for line numbers"),v(85079),s.each(function(a,c){const u=$(c.parentNode);if(u.hasClass("markdown-highlight"))return;u.addClass("markdown-highlight"),!Array.prototype.some.call(c.classList,n=>n.startsWith("language-"))&&config.markdown.defaultHighlightLanguage&&c.classList.add(`language-${config.markdown.defaultHighlightLanguage}`),window.hljs.highlightElement(c);const p=c.classList.values();for(const n of p)if(n.startsWith("language-")){const i=n.split("-")[1],r=config.markdown.highlightLinesLanguageList;y.has(i)&&r&&r.includes(y.get(i))&&($(c).attr("data-lines",1),window.hljs.lineNumbersBlock(c));break}})}}},85079(){(function(m,L){"use strict";var v="hljs-ln",I="hljs-ln-line",w="hljs-ln-code",M="hljs-ln-numbers",x="hljs-ln-n",A="data-line-number",y=/\r\n|\r|\n/g;m.hljs?(m.hljs.initLineNumbersOnLoad=a,m.hljs.lineNumbersBlock=p,m.hljs.lineNumbersBlockSync=n,m.hljs.lineNumbersValue=i,o()):m.console.error("highlight.js not detected!");function E(e){for(var t=e;t;){if(t.className&&t.className.indexOf("hljs-ln-code")!==-1)return!0;t=t.parentNode}return!1}function B(e){for(var t=e;t.nodeName!=="TABLE";)t=t.parentNode;return t}function s(e){for(var t=e.toString(),l=e.anchorNode;l.nodeName!=="TD";)l=l.parentNode;for(var h=e.focusNode;h.nodeName!=="TD";)h=h.parentNode;var g=parseInt(l.dataset.lineNumber),T=parseInt(h.dataset.lineNumber);if(g!=T){var b=l.textContent,k=h.textContent;if(g>T){var C=g;g=T,T=C,C=b,b=k,k=C}for(;t.indexOf(b)!==0;)b=b.slice(1);for(;t.lastIndexOf(k)===-1;)k=k.slice(0,-1);for(var D=b,V=B(l),O=g+1;O<T;++O){var G=j('.{0}[{1}="{2}"]',[w,A,O]),Q=V.querySelector(G);D+=`
`+Q.textContent}return D+=`
`+k,D}else return t}document.addEventListener("copy",function(e){var t=window.getSelection();if(E(t.anchorNode)){var l;window.navigator.userAgent.indexOf("Edge")!==-1?l=s(t):l=t.toString(),e.clipboardData.setData("text/plain",l),e.preventDefault()}});function o(){var e=L.createElement("style");e.type="text/css",e.innerHTML=j(".{0}{border-collapse:collapse}.{0} td{padding:0}.{1}:before{content:attr({2})}",[v,x,A]),L.getElementsByTagName("head")[0].appendChild(e)}function a(e){L.readyState==="interactive"||L.readyState==="complete"?c(e):m.addEventListener("DOMContentLoaded",function(){c(e)})}function c(e){try{var t=L.querySelectorAll("code.hljs,code.nohighlight");for(var l in t)t.hasOwnProperty(l)&&(u(t[l])||p(t[l],e))}catch(h){m.console.error("LineNumbers error: ",h)}}function u(e){return e.classList.contains("nohljsln")}function p(e,t){typeof e=="object"&&P(function(){e.innerHTML=r(e,t)})}function n(e,t){typeof e=="object"&&(e.innerHTML=r(e,t))}function i(e,t){if(typeof e=="string"){var l=document.createElement("code");return l.innerHTML=e,r(l,t)}}function r(e,t){var l=f(e,t);return S(e),d(e.innerHTML,l)}function d(e,t){var l=F(e);if(l[l.length-1].trim()===""&&l.pop(),l.length>1||t.singleLine){for(var h="",g=0,T=l.length;g<T;g++)h+=j('<tr><td class="{0} {1}" {3}="{5}"><div class="{2}" {3}="{5}"></div></td><td class="{0} {4}" {3}="{5}">{6}</td></tr>',[I,M,x,A,w,g+t.startFrom,l[g].length>0?l[g]:" "]);return j('<table class="{0}">{1}</table>',[v,h])}return e}function f(e,t){return t=t||{},{singleLine:N(t),startFrom:H(e,t)}}function N(e){var t=!1;return e.singleLine?e.singleLine:t}function H(e,t){var l=1,h=l;isFinite(t.startFrom)&&(h=t.startFrom);var g=K(e,"data-ln-start-from");return g!==null&&(h=U(g,l)),h}function S(e){var t=e.childNodes;for(var l in t)if(t.hasOwnProperty(l)){var h=t[l];W(h.textContent)>0&&(h.childNodes.length>0?S(h):R(h.parentNode))}}function R(e){var t=e.className;if(/hljs-/.test(t)){for(var l=F(e.innerHTML),h=0,g="";h<l.length;h++){var T=l[h].length>0?l[h]:" ";g+=j(`<span class="{0}">{1}</span>
`,[t,T])}e.innerHTML=g.trim()}}function F(e){return e.length===0?[]:e.split(y)}function W(e){return(e.trim().match(y)||[]).length}function P(e){m.setTimeout(e,0)}function j(e,t){return e.replace(/\{(\d+)\}/g,function(l,h){return t[h]!==void 0?t[h]:l})}function K(e,t){return e.hasAttribute(t)?e.getAttribute(t):null}function U(e,t){if(!e)return t;var l=Number(e);return isFinite(l)?l:t}})(window,document)}}]);
