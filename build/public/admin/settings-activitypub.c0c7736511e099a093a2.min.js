"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,69185,80651,86198,99127],{49897(v,E,i){i.r(E),i.d(E,{del:()=>s,get:()=>n,head:()=>c,patch:()=>r,post:()=>u,put:()=>l});var m=i(91749),h=i.n(m),p=i(33530),b=i.n(p);const C=config.relative_path+"/api/v3";async function g(t,a){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:C+t.url,typeof a=="function"){d(t).then(e=>a(null,e),e=>a(e));return}try{return await d(t)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:o}=await(0,m.fire)("filter:admin.reauth",{url:"login"});return(0,p.confirm)("[[error:api.reauth-required]]",f=>{f&&ajaxify.go(o)})}throw e}}async function d(t){const{url:a}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,m.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const e=await fetch(a,t),{headers:o}=e;if(o.get("x-redirect"))return d({url:o.get("x-redirect"),...t});const f=o.get("content-type"),w=f&&f.startsWith("application/json");let y;if(t.method!=="HEAD"&&(w?y=await e.json():y=await e.text()),!e.ok)throw y?new Error(w?y.status.message:y):new Error(e.statusText);return w&&y&&y.hasOwnProperty("status")&&y.hasOwnProperty("response")?y.response:y}function n(t,a,e){return g({url:t+(a&&Object.keys(a).length?"?"+$.param(a):"")},e)}function c(t,a,e){return g({url:t+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"HEAD"},e)}function u(t,a,e){return g({url:t,method:"POST",data:a,headers:{"x-csrf-token":config.csrf_token}},e)}function r(t,a,e){return g({url:t,method:"PATCH",data:a,headers:{"x-csrf-token":config.csrf_token}},e)}function l(t,a,e){return g({url:t,method:"PUT",data:a,headers:{"x-csrf-token":config.csrf_token}},e)}function s(t,a,e){return g({url:t,method:"DELETE",data:a,headers:{"x-csrf-token":config.csrf_token}},e)}},65348(v,E,i){var m,h;m=[i(96349),i(33530),i(91749),i(17459)],h=(function(p,b,C,g){const d={};return d.init=function(n,c){if(!n||!n.length)return;c=c||{};const u=c.onSelect||function(){};c.states=c.states||["watching","tracking","notwatching","ignoring"],c.template=c.template||"partials/category/selector-dropdown-left",C.fire("action:category.selector.options",{el:n,options:c}),p.init(n,c);const r={el:n,selectedCategory:null};n.on("click","[data-cid]",function(){const s=$(this);return s.hasClass("disabled")?!1:(r.selectCategory(s.attr("data-cid")),u(r.selectedCategory))});let l=r.el.find('[component="category-selector-selected"]').html();return g.translate(l,s=>{l=s}),r.selectCategory=function(s){const t=r.el.find('[data-cid="'+s+'"]');r.selectedCategory={cid:s,name:t.attr("data-name")},t.length?r.el.find('[component="category-selector-selected"]').html(t.find('[component="category-markup"]').html()):r.el.find('[component="category-selector-selected"]').html(l)},r.getSelectedCategory=function(){return r.selectedCategory},r.getSelectedCid=function(){return r.selectedCategory?r.selectedCategory.cid:0},c.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(c.template,{selectedCategory:c.selectedCategory},function(s){r.el.find('[component="category-selector-selected"]').html(s.find('[component="category-selector-selected"]').html())}),r},d.modal=function(n){n=n||{},n.onSelect=n.onSelect||function(){},n.onSubmit=n.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:n.message},function(c){const u=b.dialog({title:n.title||"[[modules:composer.select-category]]",message:c,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:l}}}),r=d.init(u.find('[component="category-selector"]'),n);function l(s){return s.preventDefault(),r.selectedCategory&&(n.onSubmit(r.selectedCategory),u.modal("hide")),!1}n.openOnLoad&&u.on("shown.bs.modal",function(){u.find(".dropdown-toggle").dropdown("toggle")}),u.find("form").on("submit",l)})},d}).apply(E,m),h!==void 0&&(v.exports=h)},89141(v,E,i){var m,h;m=[i(81335),i(33530),i(65348),i(49897),i(29930),i(17459)],h=(function(p,b,C,g,d,n){const c={};return c.init=function(){const u=document.getElementById("rules");u&&u.addEventListener("click",l=>{const s=l.target.closest("[data-action]");if(s)switch(s.getAttribute("data-action")){case"rules.add":{c.throwRulesModal();break}case"rules.delete":{const a=s.closest("tr").getAttribute("data-rid");g.del(`/admin/activitypub/rules/${a}`,{}).then(async e=>{const o=await p.render("admin/settings/activitypub",{rules:e},"rules"),f=document.querySelector("#rules tbody");f&&(f.innerHTML=o)}).catch(d.error)}}});const r=document.getElementById("relays");r&&r.addEventListener("click",l=>{const s=l.target.closest("[data-action]");if(s)switch(s.getAttribute("data-action")){case"relays.add":{c.throwRelaysModal();break}case"relays.remove":{const a=s.closest("tr").getAttribute("data-url");g.del(`/admin/activitypub/relays/${encodeURIComponent(a)}`,{}).then(async e=>{const o=await app.parseAndTranslate("admin/settings/activitypub","relays",{relays:e}),f=document.querySelector("#relays tbody");f&&$(f).html(o)}).catch(d.error)}}})},c.throwRulesModal=function(){p.render("admin/partials/activitypub/rules",{}).then(function(u){const r=function(){const e=l.find("form").get(0),o=Object.fromEntries(new FormData(e));g.post("/admin/activitypub/rules",o).then(async f=>{const w=await p.render("admin/settings/activitypub",{rules:f},"rules"),y=document.querySelector("#rules tbody");y&&(y.innerHTML=w)}).catch(d.error)},l=b.dialog({title:"[[admin/settings/activitypub:rules.add]]",message:u,buttons:{save:{label:"[[global:save]]",className:"btn-primary",callback:r}}});l.on("shown.bs.modal",function(){l.find("input").focus()});const s=async(e,o)=>{const f=await n.translate(`[[admin/settings/activitypub:rules.help-${e}]]`);o.innerHTML=f},t=l.get(0).querySelector("#help-text"),a=l.get(0).querySelector("#type");s(l.get(0).querySelector("#type option").value,t),a&&t&&a.addEventListener("change",function(){s(this.value,t)}),C.init(l.find('[component="category-selector"]'),{onSelect:function(e){l.find('[name="cid"]').val(e.cid)},cacheList:!1,showLinks:!0,template:"admin/partials/category/selector-dropdown-right"})})},c.throwRelaysModal=function(){p.render("admin/partials/activitypub/relays",{}).then(function(u){const r=function(){const s=l.find("form").get(0),t=Object.fromEntries(new FormData(s));g.post("/admin/activitypub/relays",t).then(async a=>{const e=await app.parseAndTranslate("admin/settings/activitypub","relays",{relays:a}),o=document.querySelector("#relays tbody");o&&$(o).html(e)}).catch(d.error)},l=b.dialog({title:"[[admin/settings/activitypub:relays.add]]",message:u,buttons:{save:{label:"[[global:save]]",className:"btn-primary",callback:r}}});l.on("shown.bs.modal",function(){l.find("input").focus()})})},c}).apply(E,m),h!==void 0&&(v.exports=h)},96349(v,E,i){var m,h;m=[i(29930),i(89336),i(49897)],h=(function(p,b,C){const g={};return g.init=function(d,n){let c=n.defaultCategories||null;n=n||{},n.privilege=n.privilege||"topics:read",n.states=n.states||["watching","tracking","notwatching","ignoring"],n.cacheList=n.hasOwnProperty("cacheList")?n.cacheList:!0;let u=[];Array.isArray(n.localCategories)&&(u=n.localCategories.map(a=>({...a})),c&&(c=[...u,...c])),n.selectedCids=n.selectedCids||ajaxify.data.selectedCids||[];const r=d.find('[component="category-selector-search"]');if(!r.length)return;const l=r.parents('[component="category/dropdown"]').length>0||r.parents('[component="category-selector"]').length>0;d.on("show.bs.dropdown",function(){l&&r.removeClass("hidden");function a(){const e=r.find("input").val();e.length>1||!e&&!c?s(e,function(o){c=n.cacheList&&(c||o),t(o)}):!e&&c&&t(c)}r.on("click",function(e){e.preventDefault(),e.stopPropagation()}),r.find("input").val("").on("keyup",utils.debounce(a,300)),a()}),d.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||r.find("input").focus()}),d.on("hide.bs.dropdown",function(){l&&r.addClass("hidden"),r.off("click"),r.find("input").off("keyup")});function s(a,e){C.get("/search/categories",{search:a,query:utils.params(),parentCid:n.parentCid||0,selectedCids:n.selectedCids,privilege:n.privilege,states:n.states,showLinks:n.showLinks,localOnly:n.localOnly,hideUncategorized:n.hideUncategorized},function(o,{categories:f}){if(o)return p.error(o);e(u.concat(f))})}function t(a){const e=n.selectedCids.map(String);a.forEach(function(o){o.selected=e.includes(String(o.cid))}),app.parseAndTranslate(n.template,{categoryItems:a.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl,hideAll:n.hideAll},function(o){d.find('[component="category/list"]').html(o.find('[component="category/list"]').html()),d.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!a.length);const f=b.Dropdown.getInstance(d.find(".dropdown-toggle").get(0));f&&f.update()})}},g}).apply(E,m),h!==void 0&&(v.exports=h)}}]);
