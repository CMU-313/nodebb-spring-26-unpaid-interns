"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,69185,83931,86198,99127],{49897(w,E,d){d.r(E),d.d(E,{del:()=>s,get:()=>t,head:()=>i,patch:()=>o,post:()=>m,put:()=>u});var y=d(91749),p=d.n(y),b=d(33530),x=d.n(b);const v=config.relative_path+"/api/v3";async function h(r,n){if(r.url=r.url.startsWith("/api")?config.relative_path+r.url:v+r.url,typeof n=="function"){g(r).then(e=>n(null,e),e=>n(e));return}try{return await g(r)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:a}=await(0,y.fire)("filter:admin.reauth",{url:"login"});return(0,b.confirm)("[[error:api.reauth-required]]",c=>{c&&ajaxify.go(a)})}throw e}}async function g(r){const{url:n}=r;delete r.url,r.data&&!(r.data instanceof FormData)&&(r.data=JSON.stringify(r.data||{}),r.headers["content-type"]="application/json; charset=utf-8"),{options:r}=await(0,y.fire)("filter:api.options",{options:r}),r.data&&(r.body=r.data,delete r.data);const e=await fetch(n,r),{headers:a}=e;if(a.get("x-redirect"))return g({url:a.get("x-redirect"),...r});const c=a.get("content-type"),f=c&&c.startsWith("application/json");let l;if(r.method!=="HEAD"&&(f?l=await e.json():l=await e.text()),!e.ok)throw l?new Error(f?l.status.message:l):new Error(e.statusText);return f&&l&&l.hasOwnProperty("status")&&l.hasOwnProperty("response")?l.response:l}function t(r,n,e){return h({url:r+(n&&Object.keys(n).length?"?"+$.param(n):"")},e)}function i(r,n,e){return h({url:r+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"HEAD"},e)}function m(r,n,e){return h({url:r,method:"POST",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function o(r,n,e){return h({url:r,method:"PATCH",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function u(r,n,e){return h({url:r,method:"PUT",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function s(r,n,e){return h({url:r,method:"DELETE",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}},65348(w,E,d){var y,p;y=[d(96349),d(33530),d(91749),d(17459)],p=(function(b,x,v,h){const g={};return g.init=function(t,i){if(!t||!t.length)return;i=i||{};const m=i.onSelect||function(){};i.states=i.states||["watching","tracking","notwatching","ignoring"],i.template=i.template||"partials/category/selector-dropdown-left",v.fire("action:category.selector.options",{el:t,options:i}),b.init(t,i);const o={el:t,selectedCategory:null};t.on("click","[data-cid]",function(){const s=$(this);return s.hasClass("disabled")?!1:(o.selectCategory(s.attr("data-cid")),m(o.selectedCategory))});let u=o.el.find('[component="category-selector-selected"]').html();return h.translate(u,s=>{u=s}),o.selectCategory=function(s){const r=o.el.find('[data-cid="'+s+'"]');o.selectedCategory={cid:s,name:r.attr("data-name")},r.length?o.el.find('[component="category-selector-selected"]').html(r.find('[component="category-markup"]').html()):o.el.find('[component="category-selector-selected"]').html(u)},o.getSelectedCategory=function(){return o.selectedCategory},o.getSelectedCid=function(){return o.selectedCategory?o.selectedCategory.cid:0},i.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(i.template,{selectedCategory:i.selectedCategory},function(s){o.el.find('[component="category-selector-selected"]').html(s.find('[component="category-selector-selected"]').html())}),o},g.modal=function(t){t=t||{},t.onSelect=t.onSelect||function(){},t.onSubmit=t.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:t.message},function(i){const m=x.dialog({title:t.title||"[[modules:composer.select-category]]",message:i,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:u}}}),o=g.init(m.find('[component="category-selector"]'),t);function u(s){return s.preventDefault(),o.selectedCategory&&(t.onSubmit(o.selectedCategory),m.modal("hide")),!1}t.openOnLoad&&m.on("shown.bs.modal",function(){m.find(".dropdown-toggle").dropdown("toggle")}),m.find("form").on("submit",u)})},g}).apply(E,y),p!==void 0&&(w.exports=p)},86871(w,E,d){var y,p;y=[d(24187),d(67308),d(65348),d(81335),d(49897),d(33530),d(29930),d(54222)],p=(function(b,x,v,h,g,t,i,m){const o={};let u={};o.init=function(){const n=$("#category-settings"),e=$('[component="category/preview"]');n.find("select").each(function(){const a=$(this);a.val(a.attr("data-value"))}),v.init($('[component="settings/main/header"] [component="category-selector"]'),{onSelect:function(a){ajaxify.go("admin/manage/categories/"+a.cid)},cacheList:!1,showLinks:!0,template:"admin/partials/category/selector-dropdown-right"}),v.init($('#parent-category-selector [component="category-selector"]'),{onSelect:function(a){const c=$("#parent-cid");c.val(a.cid),s(c[0])},selectedCategory:ajaxify.data.category.parent,localCategories:[{cid:0,name:"[[admin/manage/categories:parent-category-none]]",icon:"fa-list"}],cacheList:!1,showLinks:!0,template:"admin/partials/category/selector-dropdown-right"}),r(),n.find("input, select, textarea").on("change",function(a){s(a.target)}),$('[type="checkbox"]').on("change",function(){s($(this))}),$('[data-name="imageClass"]').on("change",function(){$(".category-preview").css("background-size",$(this).val())}),$('[data-name="bgColor"], [data-name="color"]').on("input",function(){const a=$(this);a.attr("data-name")==="bgColor"?e.css("background-color",a.val()):a.attr("data-name")==="color"&&e.css("color",a.val()),s(a[0])}),$("#save").on("click",function(){const a=$("#tag-whitelist").val()?$("#tag-whitelist").val().split(","):[];if(a.length&&a.length<parseInt($("#cid-min-tags").val(),10))return i.error("[[admin/manage/categories:alert.not-enough-whitelisted-tags]]");const c=ajaxify.data.category.cid;return g.put("/categories/"+c,u).then(()=>{app.flags._unsaved=!1,m.toggleSaveSuccess($("#save")),u={}}).catch(i.error),!1}),$(".purge").on("click",function(a){a.preventDefault(),h.render("admin/partials/categories/purge",{name:ajaxify.data.category.name,topic_count:ajaxify.data.category.topic_count}).then(function(c){const f=t.dialog({title:"[[admin/manage/categories:purge]]",message:c,size:"large",buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){f.find(".modal-footer button").prop("disabled",!0);const l=setInterval(async()=>{if(ajaxify.data.category)try{const{count:C}=await g.get(`/categories/${ajaxify.data.category.cid}/count`);let A=0;ajaxify.data.category.topic_count>0&&(A=Math.max(0,1-C/ajaxify.data.category.topic_count)*100),f.find(".progress-bar").css({width:A+"%"})}catch(C){clearInterval(l),i.error(C)}},1e3);return g.del("/categories/"+ajaxify.data.category.cid).then(()=>{l&&clearInterval(l),f.modal("hide"),i.success("[[admin/manage/categories:alert.purge-success]]"),setTimeout(()=>{ajaxify.go("admin/manage/categories")},2500)}).catch(i.error),!1}}}})})}),$(".copy-settings").on("click",function(){return h.render("admin/partials/categories/copy-settings",{}).then(function(a){let c;const f=t.dialog({title:"[[modules:composer.select-category]]",message:a,buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){if(!(!c||parseInt(c,10)===parseInt(ajaxify.data.category.cid,10)))return socket.emit("admin.categories.copySettingsFrom",{fromCid:c,toCid:ajaxify.data.category.cid,copyParent:f.find("#copyParent").prop("checked")},function(l){if(l)return i.error(l);f.modal("hide"),alert.success("[[admin/manage/categories:alert.copy-success]]"),ajaxify.refresh()}),!1}}}});f.find(".modal-footer button").prop("disabled",!0),v.init(f.find('[component="category-selector"]'),{onSelect:function(l){c=l&&l.cid,c&&f.find(".modal-footer button").prop("disabled",!1)},showLinks:!0})}),!1}),$(".upload-button").on("click",function(){const c=$(this).attr("data-cid");b.show({title:"[[admin/manage/categories:alert.upload-image]]",route:config.relative_path+"/api/admin/category/uploadpicture",params:{cid:c}},function(f){$("#category-image").val(f),e.css("background-image","url("+f+"?"+new Date().getTime()+")"),s($("#category-image"))})}),$("#category-image").on("change",function(){e.css("background-image",$(this).val()?'url("'+$(this).val()+'")':""),s($("#category-image"))}),$(".delete-image").on("click",function(a){a.preventDefault();const c=$("#category-image");c.val(""),e.css("background-image",""),s(c[0])}),e.on("click",function(){x.init($(this).find("i"),s)}),$('button[data-action="toggle"]').on("click",function(){const a=$(this),c=a.attr("data-disabled")==="1";g.put("/categories/"+ajaxify.data.category.cid,{disabled:c?0:1}).then(()=>{a.find(".label").translateText(c?"[[admin/manage/categories:disable]]":"[[admin/manage/categories:enable]]"),a.find("i").toggleClass(["fa-check","text-success"],!c).toggleClass(["fa-ban","text-danger"],c),a.attr("data-disabled",c?0:1)}).catch(i.error)})};function s(n){let e;$(n).is(":checkbox")?e=$(n).is(":checked")?1:0:e=$(n).val();const c=$(n).attr("data-name").match(/[^\][.]+/g);function f(l,C){C!==c.length&&(l[c[C]]=l[c[C]]||{},C===c.length-1&&(l[c[C]]=e),f(l[c[C]],C+1))}c&&c.length&&(c.length===1?u[c[0]]=e:c.length>1&&f(u,0)),app.flags=app.flags||{},app.flags._unsaved=!0}function r(){const n=$("#tag-whitelist");n.tagsinput({tagClass:"badge bg-info",confirmKeys:[13,44],trimValue:!0}),ajaxify.data.category.tagWhitelist.forEach(function(e){n.tagsinput("add",e)}),n.on("itemAdded itemRemoved",function(){s(n)})}return o}).apply(E,y),p!==void 0&&(w.exports=p)},96349(w,E,d){var y,p;y=[d(29930),d(89336),d(49897)],p=(function(b,x,v){const h={};return h.init=function(g,t){let i=t.defaultCategories||null;t=t||{},t.privilege=t.privilege||"topics:read",t.states=t.states||["watching","tracking","notwatching","ignoring"],t.cacheList=t.hasOwnProperty("cacheList")?t.cacheList:!0;let m=[];Array.isArray(t.localCategories)&&(m=t.localCategories.map(n=>({...n})),i&&(i=[...m,...i])),t.selectedCids=t.selectedCids||ajaxify.data.selectedCids||[];const o=g.find('[component="category-selector-search"]');if(!o.length)return;const u=o.parents('[component="category/dropdown"]').length>0||o.parents('[component="category-selector"]').length>0;g.on("show.bs.dropdown",function(){u&&o.removeClass("hidden");function n(){const e=o.find("input").val();e.length>1||!e&&!i?s(e,function(a){i=t.cacheList&&(i||a),r(a)}):!e&&i&&r(i)}o.on("click",function(e){e.preventDefault(),e.stopPropagation()}),o.find("input").val("").on("keyup",utils.debounce(n,300)),n()}),g.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||o.find("input").focus()}),g.on("hide.bs.dropdown",function(){u&&o.addClass("hidden"),o.off("click"),o.find("input").off("keyup")});function s(n,e){v.get("/search/categories",{search:n,query:utils.params(),parentCid:t.parentCid||0,selectedCids:t.selectedCids,privilege:t.privilege,states:t.states,showLinks:t.showLinks,localOnly:t.localOnly,hideUncategorized:t.hideUncategorized},function(a,{categories:c}){if(a)return b.error(a);e(m.concat(c))})}function r(n){const e=t.selectedCids.map(String);n.forEach(function(a){a.selected=e.includes(String(a.cid))}),app.parseAndTranslate(t.template,{categoryItems:n.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl,hideAll:t.hideAll},function(a){g.find('[component="category/list"]').html(a.find('[component="category/list"]').html()),g.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!n.length);const c=x.Dropdown.getInstance(g.find(".dropdown-toggle").get(0));c&&c.update()})}},h}).apply(E,y),p!==void 0&&(w.exports=p)}}]);
