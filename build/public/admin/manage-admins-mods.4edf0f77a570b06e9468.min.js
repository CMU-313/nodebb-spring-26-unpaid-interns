"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,13417,34271,34405,37759,49897,69185,86198,99127],{3665(b,v,s){var y,m;y=[s(34405),s(49897),s(33530),s(29930),s(65348)],m=(function(E,p,A,u,f){const t={};return t.init=function(){E.user($("#admin-search"),function(o,c){socket.emit("admin.user.makeAdmins",[c.item.user.uid],function(n){if(n)return u.error(n);$("#admin-search").val(""),!$('.administrator-area [data-uid="'+c.item.user.uid+'"]').length&&app.parseAndTranslate("admin/manage/admins-mods","admins.members",{admins:{members:[c.item.user]}},function(i){$(".administrator-area").prepend(i)})})}),$(".administrator-area").on("click",".remove-user-icon",function(){const o=$(this).parents("[data-uid]"),c=o.attr("data-uid");if(parseInt(c,10)===parseInt(app.user.uid,10))return u.error("[[admin/manage/users:alerts.no-remove-yourself-admin]]");A.confirm("[[admin/manage/users:alerts.confirm-remove-admin]]",function(n){n&&socket.emit("admin.user.removeAdmins",[c],function(i){if(i)return u.error(i.message);o.remove()})})}),E.user($("#global-mod-search"),function(o,c){p.put("/groups/global-moderators/membership/"+c.item.user.uid).then(()=>{$("#global-mod-search").val(""),!$('.global-moderator-area [data-uid="'+c.item.user.uid+'"]').length&&app.parseAndTranslate("admin/manage/admins-mods","globalMods.members",{globalMods:{members:[c.item.user]}},function(n){$(".global-moderator-area").prepend(n),$("#no-global-mods-warning").addClass("hidden")})}).catch(u.error)}),$(".global-moderator-area").on("click",".remove-user-icon",function(){const o=$(this).parents("[data-uid]"),c=o.attr("data-uid");A.confirm("[[admin/manage/users:alerts.confirm-remove-global-mod]]",function(n){n&&p.del("/groups/global-moderators/membership/"+c).then(()=>{o.remove(),$(".global-moderator-area").children().length||$("#no-global-mods-warning").removeClass("hidden")}).catch(u.error)})}),f.init($('[component="category-selector"]'),{parentCid:ajaxify.data.selectedCategory?ajaxify.data.selectedCategory.cid:0,onSelect:function(o){ajaxify.go("admin/manage/admins-mods"+(o.cid?"?cid="+o.cid:""))},localCategories:[]}),E.user($(".moderator-search"),function(o,c){const n=$(o.target),i=$(o.target).attr("data-cid");p.put(`/categories/${i}/moderator/${c.item.user.uid}`,{},function(d){if(d)return u.error(d);n.val(""),!$('.moderator-area[data-cid="'+i+'"] [data-uid="'+c.item.user.uid+'"]').length&&app.parseAndTranslate("admin/manage/admins-mods","globalMods.members",{globalMods:{members:[c.item.user]}},function(e){$('.moderator-area[data-cid="'+i+'"]').prepend(e),$('.no-moderator-warning[data-cid="'+i+'"]').addClass("hidden")})})}),$(".moderator-area").on("click",".remove-user-icon",function(){const o=$(this).parents("[data-cid]"),c=o.attr("data-cid"),n=$(this).parents("[data-uid]"),i=n.attr("data-uid");A.confirm("[[admin/manage/users:alerts.confirm-remove-moderator]]",function(d){d&&p.del(`/categories/${c}/moderator/${i}`,{},function(e){if(e)return u.error(e);n.remove(),o.children().length||$('.no-moderator-warning[data-cid="'+c+'"]').removeClass("hidden")})})})},t}).apply(v,y),m!==void 0&&(b.exports=m)},34405(b,v,s){var y,m;y=[s(49897),s(29930),s(36e3),s(9787),s(35786)],m=(function(E,p,{Textcomplete:A},{TextareaEditor:u},{ContenteditableEditor:f}){const t={},o={delay:200,appendTo:null};t.init=n=>{const i={...o,...n},{input:d,onSelect:e}=i;app.loadJQueryUI(function(){d.autocomplete({...i,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(r,a){c(d,e,r,a)}})})},t.user=function(n,i,d){typeof i=="function"&&(d=i,i={}),i=i||{},t.init({input:n,onSelect:d,source:(e,r)=>{i.query=e.term,E.get("/api/users",i,function(a,l){if(a)return p.error(a);if(l&&l.users){const g=l.users.map(function(h){const C=$("<div></div>").html(h.username).text();return h&&{label:C,value:C,user:{uid:h.uid,name:h.username,slug:h.userslug,username:h.username,userslug:h.userslug,displayname:h.displayname,picture:h.picture,banned:h.banned,"icon:text":h["icon:text"],"icon:bgColor":h["icon:bgColor"]}}});r(g)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},t.group=function(n,i){t.init({input:n,onSelect:i,source:(d,e)=>{socket.emit("groups.search",{query:d.term},function(r,a){if(r)return p.error(r);if(a&&a.length){const l=a.map(function(g){return g&&{label:g.name,value:g.name,group:g}});e(l)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},t.tag=function(n,i){t.init({input:n,onSelect:i,delay:100,source:(d,e)=>{socket.emit("topics.autocompleteTags",{query:d.term,cid:ajaxify.data.cid||0},function(r,a){if(r)return p.error(r);a&&e(a),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function c(n,i,d,e){i=i||function(){};const r=jQuery.Event("keypress");r.which=13,r.keyCode=13,setTimeout(function(){n.trigger(r)},100),i(d,e)}return t.setup=function({element:n,strategies:i,options:d}){const e=n.get(0);if(e){var r;if(e.nodeName==="TEXTAREA"||e.nodeName==="INPUT"?r=new u(e):e.nodeName==="DIV"&&e.getAttribute("contenteditable")==="true"&&(r=new f(e)),!r)throw new Error("unknown target element type");e.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var a=new A(r,i,{dropdown:d});return a.on("rendered",function(){a.dropdown.items.length&&a.dropdown.items[0].activate()}),a}},t}).apply(v,y),m!==void 0&&(b.exports=m)},49897(b,v,s){s.r(v),s.d(v,{del:()=>d,get:()=>t,head:()=>o,patch:()=>n,post:()=>c,put:()=>i});var y=s(91749),m=s.n(y),E=s(33530),p=s.n(E);const A=config.relative_path+"/api/v3";async function u(e,r){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:A+e.url,typeof r=="function"){f(e).then(a=>r(null,a),a=>r(a));return}try{return await f(e)}catch(a){if(a.message==="A valid login session was not found. Please log in and try again."){const{url:l}=await(0,y.fire)("filter:admin.reauth",{url:"login"});return(0,E.confirm)("[[error:api.reauth-required]]",g=>{g&&ajaxify.go(l)})}throw a}}async function f(e){const{url:r}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,y.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const a=await fetch(r,e),{headers:l}=a;if(l.get("x-redirect"))return f({url:l.get("x-redirect"),...e});const g=l.get("content-type"),h=g&&g.startsWith("application/json");let C;if(e.method!=="HEAD"&&(h?C=await a.json():C=await a.text()),!a.ok)throw C?new Error(h?C.status.message:C):new Error(a.statusText);return h&&C&&C.hasOwnProperty("status")&&C.hasOwnProperty("response")?C.response:C}function t(e,r,a){return u({url:e+(r&&Object.keys(r).length?"?"+$.param(r):"")},a)}function o(e,r,a){return u({url:e+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"HEAD"},a)}function c(e,r,a){return u({url:e,method:"POST",data:r,headers:{"x-csrf-token":config.csrf_token}},a)}function n(e,r,a){return u({url:e,method:"PATCH",data:r,headers:{"x-csrf-token":config.csrf_token}},a)}function i(e,r,a){return u({url:e,method:"PUT",data:r,headers:{"x-csrf-token":config.csrf_token}},a)}function d(e,r,a){return u({url:e,method:"DELETE",data:r,headers:{"x-csrf-token":config.csrf_token}},a)}},65348(b,v,s){var y,m;y=[s(96349),s(33530),s(91749),s(17459)],m=(function(E,p,A,u){const f={};return f.init=function(t,o){if(!t||!t.length)return;o=o||{};const c=o.onSelect||function(){};o.states=o.states||["watching","tracking","notwatching","ignoring"],o.template=o.template||"partials/category/selector-dropdown-left",A.fire("action:category.selector.options",{el:t,options:o}),E.init(t,o);const n={el:t,selectedCategory:null};t.on("click","[data-cid]",function(){const d=$(this);return d.hasClass("disabled")?!1:(n.selectCategory(d.attr("data-cid")),c(n.selectedCategory))});let i=n.el.find('[component="category-selector-selected"]').html();return u.translate(i,d=>{i=d}),n.selectCategory=function(d){const e=n.el.find('[data-cid="'+d+'"]');n.selectedCategory={cid:d,name:e.attr("data-name")},e.length?n.el.find('[component="category-selector-selected"]').html(e.find('[component="category-markup"]').html()):n.el.find('[component="category-selector-selected"]').html(i)},n.getSelectedCategory=function(){return n.selectedCategory},n.getSelectedCid=function(){return n.selectedCategory?n.selectedCategory.cid:0},o.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(o.template,{selectedCategory:o.selectedCategory},function(d){n.el.find('[component="category-selector-selected"]').html(d.find('[component="category-selector-selected"]').html())}),n},f.modal=function(t){t=t||{},t.onSelect=t.onSelect||function(){},t.onSubmit=t.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:t.message},function(o){const c=p.dialog({title:t.title||"[[modules:composer.select-category]]",message:o,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:i}}}),n=f.init(c.find('[component="category-selector"]'),t);function i(d){return d.preventDefault(),n.selectedCategory&&(t.onSubmit(n.selectedCategory),c.modal("hide")),!1}t.openOnLoad&&c.on("shown.bs.modal",function(){c.find(".dropdown-toggle").dropdown("toggle")}),c.find("form").on("submit",i)})},f}).apply(v,y),m!==void 0&&(b.exports=m)},96349(b,v,s){var y,m;y=[s(29930),s(89336),s(49897)],m=(function(E,p,A){const u={};return u.init=function(f,t){let o=t.defaultCategories||null;t=t||{},t.privilege=t.privilege||"topics:read",t.states=t.states||["watching","tracking","notwatching","ignoring"],t.cacheList=t.hasOwnProperty("cacheList")?t.cacheList:!0;let c=[];Array.isArray(t.localCategories)&&(c=t.localCategories.map(r=>({...r})),o&&(o=[...c,...o])),t.selectedCids=t.selectedCids||ajaxify.data.selectedCids||[];const n=f.find('[component="category-selector-search"]');if(!n.length)return;const i=n.parents('[component="category/dropdown"]').length>0||n.parents('[component="category-selector"]').length>0;f.on("show.bs.dropdown",function(){i&&n.removeClass("hidden");function r(){const a=n.find("input").val();a.length>1||!a&&!o?d(a,function(l){o=t.cacheList&&(o||l),e(l)}):!a&&o&&e(o)}n.on("click",function(a){a.preventDefault(),a.stopPropagation()}),n.find("input").val("").on("keyup",utils.debounce(r,300)),r()}),f.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||n.find("input").focus()}),f.on("hide.bs.dropdown",function(){i&&n.addClass("hidden"),n.off("click"),n.find("input").off("keyup")});function d(r,a){A.get("/search/categories",{search:r,query:utils.params(),parentCid:t.parentCid||0,selectedCids:t.selectedCids,privilege:t.privilege,states:t.states,showLinks:t.showLinks,localOnly:t.localOnly,hideUncategorized:t.hideUncategorized},function(l,{categories:g}){if(l)return E.error(l);a(c.concat(g))})}function e(r){const a=t.selectedCids.map(String);r.forEach(function(l){l.selected=a.includes(String(l.cid))}),app.parseAndTranslate(t.template,{categoryItems:r.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl,hideAll:t.hideAll},function(l){f.find('[component="category/list"]').html(l.find('[component="category/list"]').html()),f.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!r.length);const g=p.Dropdown.getInstance(f.find(".dropdown-toggle").get(0));g&&g.update()})}},u}).apply(v,y),m!==void 0&&(b.exports=m)}}]);
